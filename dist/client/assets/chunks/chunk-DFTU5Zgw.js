import{a as e,j as s}from"./chunk-CAff-kf5.js";import{c as t}from"./chunk-BsEC4zEh.js";import{s as a}from"./chunk-DQcwr13S.js";import{s as n}from"./chunk-B_VbuTrp.js";import{L as r,q as i,b as d,o as l,A as o,S as c,j as u}from"../entries/src_pages.8IG4k9ME.js";import"./chunk-BmSI4Fww.js";import"./chunk-ei4kQ0Q2.js";import"./chunk-CVevwmbB.js";import"./chunk-CNpwfz3n.js";import"../entries/entry-client-routing.Bbnd9vHe.js";import"./chunk-VF2LHfxc.js";/* empty css              *//* empty css              */import"./chunk-D3Yr0q6g.js";import"./chunk-CKSHq_s9.js";import"./chunk-GmA6ITIw.js";import"./chunk-DFDIFHTJ.js";import"./chunk-BvVqAYuT.js";import"./chunk-Xgiuglox.js";import"./chunk-CmA2CWkd.js";import"./chunk-Cgv-mfVR.js";import"./chunk-fiALBYsU.js";import"./chunk-DbeWnEfh.js";import"./chunk-BurK_taE.js";import"./chunk-BVvUx4OK.js";import"./chunk-B3S1iNVp.js";import"./chunk-DAUSXQgp.js";import"./chunk-RtNBUybj.js";import"./chunk-CrSVf9D1.js";import"./chunk-Cgo1rCBn.js";/* empty css              */import"./chunk-ITMKy72C.js";import"./chunk-e2Lvd1W2.js";import"./chunk-mrHSz1EB.js";/* empty css              */import"./chunk-CFcfonrM.js";import"./chunk-CblELM-r.js";import"./chunk-CEm4-sWZ.js";import"./chunk-CeuMhN-M.js";/* empty css              */const m=({language:m,user:p,statusOptions:h,paidOptions:j,splitToLines:x,paidStatus:g,itemStatus:v,info:f})=>{const{t:k}=e.useContext(r),D=i(),b=d(),I=l(),[$,y]=e.useState(null),[N,S]=e.useState(!1),[A,C]=e.useState(!1),w=async()=>{var e,s;try{const e=(await t.getAllOrders(m,p._id)).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})).sort((e,s)=>"cancelled"===e.status&&"cancelled"!==s.status?1:"cancelled"!==e.status&&"cancelled"===s.status?-1:s.createdAt.getTime()-e.createdAt.getTime());y(e)}catch(a){(null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.message)?b(u(a.response.data.message,!0,8)):b(u(a.message,!0,8))}};e.useEffect(()=>{p&&(null==p?void 0:p.role)&&(null==p?void 0:p.role)>1&&w()},[p]),e.useEffect(()=>{$&&y($.map(e=>({...e,total:e.items.map(e=>e.price*e.quantity).reduce((e,s)=>e+s,0)})))},[N]);const O=async e=>{C(!0),t.updateOrder(m,e,p._id).then(e=>{e.success&&b(u(`${e.message}`,!1,5)),w(),C(!1)}).catch(e=>{var s,t;(null==(t=null==(s=e.response)?void 0:s.data)?void 0:t.message)?b(u(e.response.data.message,!0,8)):b(u(e.message,!0,8)),C(!1)})};return s.jsx("div",{className:`${a.orders} ${I?a.light:""}`,children:null==$?void 0:$.map((e,r)=>{var i,d,l,I,C,q,L;return s.jsx("div",{className:`${a.order} ${"completed"===e.status?a.completed:"cancelled"===e.status?a.cancelled:"pending"===e.status?a.pending:"in progress"===e.status?a["in-progress"]:""}`,children:s.jsx(o,{language:m,text:`${"completed"===e.status?"[ "+k("OrderCompleted")+" ] ":""}${e.orderID} ${e.info.companyName?`${e.info.name} (${e.info.companyName})`:e.info.name}`,hideBrackets:!0,className:("cancelled"===e.status||"completed"===e.status?"reset":"pending"===e.status?"grayer":"")+" change-status",wrapperClass:a["change-status-main"],showButton:!0,children:s.jsxs(s.Fragment,{children:[s.jsxs("h2",{children:[e.info.name," ",e.info.companyName?`(${e.info.companyName})`:""]}),s.jsxs("div",{className:a["info-wrap"],children:[s.jsx("p",{children:s.jsxs("big",{children:[s.jsxs("strong",{children:[k("OrderID"),": "]}),e.orderID]})}),s.jsxs("p",{children:[s.jsxs("strong",{children:[k("Status"),": "]}),v(e.status)]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[k("PaymentState"),": "]}),g[e.items.every(e=>"full"===e.paid)?"full":e.items.every(e=>"none"===e.paid)?"none":"partial"]]}),s.jsxs("p",{children:[k("Total"),": ",s.jsxs("big",{children:[e.total," € "]})]}),s.jsxs("table",{className:`${a["info-table"]}`,children:[s.jsx("caption",{children:k("Ordered")}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsxs("th",{children:[k("Ordered"),": "]}),s.jsxs("td",{children:[null==(i=e.createdAt)?void 0:i.toLocaleDateString()," ",null==(d=e.createdAt)?void 0:d.toLocaleTimeString()]})]}),s.jsxs("tr",{children:[s.jsxs("th",{children:[k("LastUpdated"),": "]}),s.jsxs("td",{children:[e.updatedAt.toLocaleDateString()," ",null==(l=e.updatedAt)?void 0:l.toLocaleTimeString()]})]})]})]})]}),s.jsx(o,{language:m,text:`${k("Edit")} (${k("Status")})`,hideBrackets:!0,className:"narrow2 change-status",wrapperClass:a["change-status-main"],children:s.jsx(s.Fragment,{children:s.jsxs("form",{className:a["change-status-form"],onSubmit:s=>{s.preventDefault(),O(null==$?void 0:$.find(s=>s.orderID===e.orderID))},children:[s.jsx(c,{language:m,id:`status-${e.orderID}`,className:"status",instructions:"Status",options:h,value:h.find(s=>s.value===e.status),onChange:s=>{y(null==$?void 0:$.map(t=>t.orderID===e.orderID?{...t,status:null==s?void 0:s.value}:t))}}),s.jsx("button",{type:"submit",disabled:A,children:k("Submit")})]})})}),null==(I=e.items)?void 0:I.map(t=>s.jsxs("div",{className:a["item-wrap"],children:[s.jsx("h3",{children:t.name}),s.jsx("p",{children:t.description}),s.jsxs("p",{children:[s.jsxs("strong",{children:[k("Price"),": "]}),"misc-quote"===t.id?t.price+" €":t.price+" x "+t.quantity+" = "+t.quantity*t.price+" €"]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[k("RequestsAndNeeds"),": "]})," ",s.jsx("br",{}),x(t.details)]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[k("Status"),": "]}),v(t.status)," "]}),"misc-quote"===t.id?null:s.jsxs("p",{children:[s.jsxs("strong",{children:[k("PaymentState"),": "]}),g[t.paid]]},t.id),s.jsx(o,{language:m,text:`${k("Edit")}`,hideBrackets:!0,className:"narrow2 change-status",wrapperClass:a["change-status"],children:s.jsx(s.Fragment,{children:s.jsxs("form",{className:a["change-status-form"],onSubmit:s=>{s.preventDefault(),O(null==$?void 0:$.find(s=>s.orderID===e.orderID))},children:[s.jsxs("label",{children:[s.jsx("span",{children:k("Price")}),s.jsx("input",{type:"number",className:"bg",name:`price-${t.id}`,defaultValue:t.price,onChange:s=>{y(null==$?void 0:$.map(a=>a.orderID===e.orderID?{...a,items:a.items.map(e=>e.id===t.id?{...e,price:Number(s.target.value)}:e)}:a)),S(!N)}})]}),s.jsxs("label",{children:[s.jsx("span",{children:k("Quantity")}),s.jsx("input",{type:"number",className:"bg",name:`quantity-${t.id}`,defaultValue:t.quantity,onChange:s=>{y(null==$?void 0:$.map(a=>a.orderID===e.orderID?{...a,items:a.items.map(e=>e.id===t.id?{...e,quantity:Number(s.target.value)}:e)}:a))}})]}),s.jsxs("label",{children:[s.jsx("span",{children:k("Info")}),s.jsx("textarea",{name:`details-${t.id}`,rows:6,defaultValue:t.details,onChange:s=>{y(null==$?void 0:$.map(a=>a.orderID===e.orderID?{...a,items:a.items.map(e=>e.id===t.id?{...e,details:s.target.value}:e)}:a))}})]}),s.jsx(c,{language:m,id:`status-${t.id}`,className:`status ${n.prev2}`,instructions:k("Status"),options:h,value:h.find(e=>e.value===t.status),onChange:s=>{y(null==$?void 0:$.map(a=>a.orderID===e.orderID?{...a,items:a.items.map(e=>e.id===t.id?{...e,status:null==s?void 0:s.value}:e)}:a))}}),s.jsx(c,{language:m,id:`paid-${t.id}`,className:`paid ${n.prev}`,instructions:k("PaymentState"),options:j,value:j.find(e=>e.value===t.paid),onChange:s=>{y(null==$?void 0:$.map(a=>a.orderID===e.orderID?{...a,items:a.items.map(e=>e.id===t.id?{...e,paid:null==s?void 0:s.value}:e)}:a))}}),s.jsx("button",{type:"submit",disabled:A,children:k("Submit")})]})})})]},t.id)),s.jsxs("div",{className:a["info-wrap"],children:[s.jsxs("table",{className:`${a["info-table"]}`,children:[s.jsx("caption",{children:k("Info")}),s.jsx("tbody",{children:Object.keys(e.info).map(t=>{var a;return"_id"===t?null:null!==e.info[t]&&""!==(null==(a=e.info[t])?void 0:a.trim())&&s.jsxs("tr",{children:[s.jsxs("th",{children:[f(t),":"]}),s.jsx("td",{children:e.info[t]})]},t)})})]}),e.extra&&""!==e.extra.trim()&&s.jsxs("p",{children:[s.jsxs("strong",{children:[k("AdditionalInformation"),": "]})," ",s.jsx("br",{}),x(e.extra)]}),s.jsx(o,{language:m,text:`${k("Edit")} (${k("Info")})`,hideBrackets:!0,className:"narrow2 change-status",wrapperClass:a["change-status-info"],children:s.jsx(s.Fragment,{children:s.jsxs("form",{className:a["change-status-form"],onSubmit:s=>{s.preventDefault(),O(null==$?void 0:$.find(s=>s.orderID===e.orderID))},children:[Object.keys(e.info).map((t,a)=>"_id"===t?null:s.jsxs("label",{children:[s.jsx("span",{children:f(t)}),s.jsx("input",{type:"text",className:"bg",name:`info-${t}-${a}`,defaultValue:e.info[t],onChange:s=>{y(null==$?void 0:$.map(a=>a.orderID===e.orderID?{...a,info:{...a.info,[t]:s.target.value}}:a))}})]},`${t}-${a}`)),s.jsxs("label",{children:[s.jsx("span",{children:k("AdditionalInformation")}),s.jsx("textarea",{rows:6,name:`additional-${e.orderID}`,defaultValue:e.extra,onChange:s=>{y(null==$?void 0:$.map(t=>t.orderID===e.orderID?{...t,extra:s.target.value}:t))}})]}),(null==(C=e.items)?void 0:C.every(e=>"full"===e.paid))?s.jsx("button",{onClick:()=>{y(null==$?void 0:$.map(s=>s.orderID===e.orderID?{...s,status:"completed"}:s)),O(null==$?void 0:$.find(s=>s.orderID===e.orderID))},children:k("OrderCompleted")},e.updatedAt.toString()):s.jsxs("div",{children:[k("OrderNotCompleted")," ",s.jsx("br",{}),(null==(q=e.items)?void 0:q.some(e=>"full"!==e.paid))&&k("MissingPayment"),":"," ",s.jsx("ul",{className:"ul",children:null==(L=e.items)?void 0:L.filter(e=>"full"!==e.paid).map((e,t)=>s.jsxs("li",{children:[e.name," (",g[e.paid],")"]},`${e.paid}-${t}`))})]},e.updatedAt.toString()),s.jsx("button",{type:"submit",disabled:A,children:k("Submit")})]})})}),p&&p.role&&p.role>2&&s.jsx("div",{className:`${a["delete-order"]}`,children:s.jsxs("button",{className:"danger delete",onClick:async()=>{await D({message:`${k("AreYouSureYouWantToDelete")} ${e.orderID}?`})&&(async e=>{t.deleteOrder(m,e,p._id).then(()=>{b(u(`${k("Deleted")} ${e}`,!1,5)),w()}).catch(e=>{var s,t;(null==(t=null==(s=e.response)?void 0:s.data)?void 0:t.message)?b(u(e.response.data.message,!0,8)):b(u(e.message,!0,8))})})(e.orderID)},children:[k("Delete"),": ",e.orderID]},e.createdAt.toString())})]})]})})},`${e.orderID}-${r}`)})})};export{m as default};
