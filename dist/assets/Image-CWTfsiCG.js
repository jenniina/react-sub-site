import{r as w,j as e}from"./react-kX_YxI4E.js";import{L as v,u as R,O as g,E as M,e as b,aC as C}from"./index-kanJP55Y.js";import{u as $,g as L}from"./Images-CYqoBzqc.js";import{Q as I,P as q,g as E}from"./poems-DC_djIre.js";import"./dom-to-image-more-CfDXlNbO.js";import"./react-dom-B5MLDbn_.js";import"./scheduler-CzFDRTuY.js";import"./react-redux-BEmJlIGA.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./react-is-DUDD-a5e.js";import"./use-sync-external-store-BPp6CH6k.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-CCb-kr4I.js";import"./react-icons-DF9X557m.js";import"./react-router-dom-StiqOUIT.js";import"./react-router-DUuhLvki.js";import"./@remix-run-DTnHqtaE.js";import"./react-helmet-async-yKbZhP8U.js";import"./react-fast-compare-DeY8XGN4.js";import"./invariant-BxDqUhCT.js";import"./shallowequal-CbQcWkYp.js";const O=({image:o,language:n,handleDownload:j,searchTerm:l,textType:p})=>{const{t:s}=w.useContext(v),h=R(),{tooltip:f,handleMouseMove:m,handleMouseLeave:r}=$(),d=c=>{const t=c.currentTarget.getBoundingClientRect(),i=c.clientX-t.left+10,k=c.clientY-t.top+10;m(i,k)},[x,u]=w.useState({id:0,content:"",originator:{name:"",id:0,description:"",language_code:"en",master_id:0,url:""},tags:[""],url:"",language_code:"en"}),[y,a]=w.useState({title:"",author:"",lines:[],linecount:"0"});return w.useEffect(()=>{if(p==="poem"){const c=Math.floor(Math.random()*5)+1;(async()=>{const i=await E(n,c);a(i[0])})()}else p==="quote"?(async()=>{if(n=M.fi){const t=await L(M.en,l);t.quote?u(t.quote):h(b(t.message??s("Error"),!0,8))}else{const t=await L(n,l);t.quote?u(t.quote):h(b(t.message??s("Error"),!0,8))}})():Math.floor(Math.random()*2)+1===1?(async()=>{const i=Math.floor(Math.random()*5)+1,k=await E(n,i);a(k[0])})():(async()=>{const i=await L(n,l);i.quote?u(i.quote):h(b(i.message??s("Error"),!0,8))})()},[n,l,p]),e.jsxs("div",{onMouseMove:d,onMouseLeave:r,children:[e.jsxs("div",{className:`tooltip-wrap ${g["image-wrap"]} ${g["image-modal"]}`,children:[e.jsxs("button",{onClick:j,className:"reset",children:[e.jsx("img",{src:o.largeImageURL,alt:o.tags,loading:"lazy",style:{width:"100%",height:"auto",borderRadius:"8px",cursor:"pointer",position:"relative"}})," "]}),f.visible&&e.jsx("span",{className:"tooltip narrow",style:{top:f.y,left:f.x,right:"unset"},children:s("ClickToLoadImage")})]}),p==="quote"?e.jsx(I,{quote:x,language:n}):e.jsx(q,{poem:y,language:n})]})},ro=({image:o,language:n,show:j,searchTerm:l,textType:p})=>{const{t:s}=w.useContext(v),h=R(),f=async()=>{if(window.confirm(s("Download")+"?")){const r=await fetch(o.largeImageURL,{mode:"cors"});if(!r.ok)throw new Error("Network response was not ok");try{const d=await r.blob(),x=window.URL.createObjectURL(d),u=o.largeImageURL.match(/\.(jpg|jpeg|png|gif|bmp|webp)$/i),y=u?u[1].toLowerCase():"jpg",a=document.createElement("a");a.href=x,a.download=`${C(`${o.id}`)}-${C(o.user)}.${y}`,a.target="_blank",a.rel="noreferrer",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(x)}catch(d){console.error("Download failed:",d),h(b(`${s("Error")}: ${d}`,!0,5))}}},m=()=>{j({title:o.tags,className:g["image-modal"],children:e.jsx(O,{image:o,language:n,handleDownload:f,searchTerm:l,textType:p})})};return e.jsxs("div",{className:`tooltip-wrap ${g["image-wrap"]}`,children:[e.jsx("button",{type:"button",style:{background:"none",border:"none",padding:0,cursor:"pointer",width:"100%"},"aria-label":s("ClickToOpenLargeImage"),onClick:m,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),m())},children:e.jsx("img",{src:o.webformatURL,alt:o.tags,title:o.tags,loading:"lazy",className:`${g["image-small"]}`,tabIndex:0,style:{width:"100%",height:"auto",borderRadius:"8px",cursor:"pointer"},onClick:m,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&m()}})}),e.jsx("span",{className:"tooltip above narrow2",children:s("ClickToOpenLargeImage")}),e.jsx("p",{children:e.jsx("small",{children:e.jsxs("a",{href:o.pageURL,target:"_blank",rel:"noreferrer",children:[s("ImagePage")," (",s("Author"),": ",o.user,")"]})})})]},o.id)};export{ro as default};
