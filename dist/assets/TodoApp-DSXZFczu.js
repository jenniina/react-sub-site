import{r as f,j as a}from"./react-A9DAvxly.js";import{bA as V,aX as X,a$ as F,bB as G,bC as U,bD as Q,bE as Z,bF as W,bG as ee,H as P,bf as se,bH as Y,R as S,bI as te,bJ as re,bK as q,bL as ne,bM as ae,a8 as oe,bN as B,bO as H,bP as K,bQ as z,bR as ie,bS as le,bT as ce,bU as de,bV as fe,bW as me,bX as pe,bY as ue}from"./index-DZjHXxcK.js";import{a4 as he}from"./react-icons-B_BWYIjI.js";import{a as $}from"./react-redux-CHm9GgGE.js";import{v as ye}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./react-dom-yh0erWL-.js";import"./scheduler-CzFDRTuY.js";import"./@reduxjs-DTZ4pglK.js";import"./immer-BNrqi0cU.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-BimPEqV4.js";import"./react-router-dom-Dz0dtoa0.js";import"./react-router-KETZ66Sq.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./use-sync-external-store-DEc9BFqZ.js";const Te="_form_7mcgs_1",be="_closed_7mcgs_173",ge="_open_7mcgs_189",_e="_modify_7mcgs_173",m={form:Te,"list-wrap":"_list-wrap_7mcgs_31","todo-input-area":"_todo-input-area_7mcgs_37","todo-ul":"_todo-ul_7mcgs_49","drag-handle":"_drag-handle_7mcgs_83","btn-wrap":"_btn-wrap_7mcgs_139",closed:be,"modify-todo":"_modify-todo_7mcgs_173",open:ge,delete:"_delete_7mcgs_243","left-to-do":"_left-to-do_7mcgs_291",modify:_e};function we({todo:e,toggleTodo:i,deleteTodo:o,language:r,modifyTodo:N,isDragging:b,handleUpdate:y,handleDragging:E}){const[k,g]=f.useState((e==null?void 0:e.name)??""),[x,_]=f.useState(!1);function D(){i(e==null?void 0:e.key)}function l(){window.confirm(Q[r]+' "'+(e==null?void 0:e.name)+'"?')&&(g(""),o(e==null?void 0:e.key),_(!1))}const u=c=>{c.preventDefault(),N(e==null?void 0:e.key,k),_(!1)},I=c=>{g(c.target.value)};f.useEffect(()=>{(e==null?void 0:e.name)!==k&&g((e==null?void 0:e.name)||"")},[e]);const O=c=>{const v="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";let J="";for(let L=0;L<c;L++){const R=Math.floor(Math.random()*v.length);J+=v.substring(R,R+1)}return J},h=(c=O(9))=>c.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"-"),A=(c=W[r])=>c.split(" ").length<=4?c:c.split(" ").slice(0,3).join(" ")+" "+Z[r],[w,p]=f.useState(!0),[s,t]=f.useState(!1),n=()=>{p(!0),t(!1)},d=()=>{p(!0)},T=()=>{p(!1)},j=()=>{p(!1),t(!0)},C=()=>{var c;(c=window.getSelection())!=null&&c.toString()?(p(!1),t(!0)):(p(!0),t(!1))},M=c=>{s&&c.preventDefault()};return a.jsxs("li",{className:`${b?"dragging":""}`,draggable:w,onDragStart:c=>{var v;w?(c.dataTransfer.setData("application/my-app",(v=e==null?void 0:e.order)==null?void 0:v.toString()),E(!0)):c.preventDefault()},onDragEnd:()=>E(!1),children:[a.jsxs("span",{onMouseOver:d,onMouseDown:n,className:`${m["drag-handle"]} tooltip-wrap`,children:[a.jsx(he,{}),a.jsx("span",{className:"tooltip narrow2 below right",children:V[r]})]}),a.jsxs("label",{className:`${x?m.open:m.closed}`,onClick:M,children:[a.jsx("input",{type:"checkbox",id:`check_${h(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:D}),a.jsx("span",{onMouseOver:T,onMouseDown:j,onMouseUp:C,children:e==null?void 0:e.name})]}),a.jsxs("div",{className:`${x?m.open:m.closed} ${m["btn-wrap"]}`,children:[a.jsx(X,{language:r,className:`${m["modify-todo"]} modify-todo`,text:F[r],isOpen:x,setIsFormOpen:_,hideBrackets:!1,onClick:()=>{g((e==null?void 0:e.name)??"")},children:a.jsxs("form",{onSubmit:u,className:`${m.modify}`,children:[a.jsxs("label",{children:[a.jsx("textarea",{id:`task_${h(e==null?void 0:e.name)}`,required:!0,name:"task",value:k,onChange:I}),a.jsxs("span",{className:"scr",children:[F[r]," ",A(e==null?void 0:e.name)]})]}),a.jsx("button",{type:"submit",className:"modify",children:G[r]})]})}),a.jsxs("button",{className:`${m.delete}`,onClick:l,"data-label":U[r],children:[a.jsx("span",{children:"Ã—"}),a.jsx("span",{className:"scr",children:U[r]})]})]})]})}function xe({toggleTodo:e,deleteTodo:i,language:o,modifyTodo:r,modifyTodoOrder:N,todosWithIdAndStatus:b,setTodosWithIdAndStatus:y}){var _,D;const{isDragging:E,listItemsByStatus:k,handleUpdate:g,handleDragging:x}=ee(b,["todos"]);return P(),a.jsx("ul",{className:`${m["todo-ul"]} todo-ul`,onDragOver:l=>l.preventDefault(),onDrop:l=>{var A;l.preventDefault();const u=l.dataTransfer.getData("application/my-app"),I=(A=Array.from(l.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:A.reduce((w,p)=>{const s=p.getBoundingClientRect(),t=Math.abs(s.top-l.clientY);return t<w.offset?{offset:t,element:p}:w},{offset:Number.POSITIVE_INFINITY}),O=Array.from(l.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(I.element);if(Number(u)===O)return;const h=g(Number(u),"todos",O);if(Array.isArray(h)){const w=h==null?void 0:h.map((p,s)=>({key:p.key,order:s}));N(w)}else console.error("Order is not an array");x(!1)},children:(D=(_=k.todos)==null?void 0:_.items)==null?void 0:D.slice().sort((l,u)=>l.order??0>(u.order??0)?1:-1).sort((l,u)=>l.complete===u.complete?0:l.complete?1:-1).map(l=>a.jsx(we,{toggleTodo:e,deleteTodo:i,todo:b==null?void 0:b.find(u=>u.key===l.key),language:o,modifyTodo:r,isDragging:E,handleUpdate:g,handleDragging:x},l==null?void 0:l.key))})}function qe({language:e}){const i=P(),o=$(s=>{var t;return(t=s.auth)==null?void 0:t.user});f.useEffect(()=>{i(se())},[]);const r=$(s=>s.todos.todos),N=$(s=>s.todos.status),b=$(s=>s.todos.error),y="ReactTodos",E=r==null?void 0:r.some(s=>s.complete);f.useEffect(()=>{if(r.length===0&&!o){const s=JSON.parse(window.localStorage.getItem(y)||"[]"),t=new Set(r.map(n=>n.key));s.forEach(n=>{t.has(n.key)||i(Y(n))})}},[i,r,o]),f.useEffect(()=>{window.localStorage.setItem(y,JSON.stringify(r))},[r]);const k=s=>{const t=new Set,n=[];return s.forEach(d=>{t.has(d.key)?n.push(d):t.add(d.key)}),n},g=s=>{if(!s){i(S("Error: no key",!0,8));return}if(o!=null&&o._id)i(B(o._id,s));else{i(H(s));const t=r.filter(n=>n.key!==s);window.localStorage.setItem(y,JSON.stringify(t))}};f.useEffect(()=>{const s=k(r),t=new Set;s.forEach(n=>{t.has(n.key)||(g(n.key),t.add(n.key))})},[r]);const[x,_]=f.useState([]);f.useEffect(()=>{const s=r==null?void 0:r.slice().sort((t,n)=>(t.order??0)-(n.order??0)).map(t=>({...t,id:t.order,status:"todos"}));_(s)},[r]),f.useEffect(()=>{N==="failed"&&i(S(`There was an error: ${b}`,!0,8))},[N,b,i]);const[D,l]=f.useState(!1);f.useEffect(()=>{o!=null&&o._id&&!D&&i(te(o._id)).then(()=>{l(!0)})},[o==null?void 0:o._id]);function u(s){const t=r.find(n=>n.key===s);if(t){const n={...t,complete:!t.complete};i(o?K(o._id,s,n):z(n))}}const I=async(s,t)=>{if(!s){i(S("Error: no key",!0,8));return}const n=r.find(d=>d.key===s);if(n){const d={...n,name:t};if(o)await i(K(o._id,s,d)).then(()=>{i(S("Todo updated",!1,3))}).catch(T=>{console.error(T),i(S(`${T}`,!0,8))});else{i(z(d));const T=r.map(j=>j.key===s?d:j);window.localStorage.setItem(y,JSON.stringify(T))}}},O=s=>{if(o)i(async t=>{try{await ie(o._id,s).then(()=>{t(le(o._id))})}catch(n){console.error(n),t(S(`${n}`,!0,8))}});else try{i(ce(s))}catch(t){console.error(t),i(S(`${t}`,!0,8))}finally{window.localStorage.setItem(y,JSON.stringify(r))}},h=f.useRef(null),A=s=>{var j;s.preventDefault();const t=((j=h.current)==null?void 0:j.value)??"";if(t==="")return;const n=ye(),d=r.reduce((C,M)=>M.order>C?M.order:C,0),T={key:n,name:t,complete:!1,order:d+1};o?i(de(o._id,T)):(i(Y(T)),window.localStorage.setItem(y,JSON.stringify([...r,T]))),h.current&&(h.current.value="")};async function w(s){if(s.preventDefault(),window.confirm(fe[e]))if(o)await i(me(o._id));else{i(pe());const t=r.filter(n=>!n.complete);window.localStorage.setItem(y,JSON.stringify(t))}}function p(s){if(!s){i(S("Error: no key",!0,8));return}if(o!=null&&o._id)i(B(o._id,s));else{i(H(s));let t=r.filter(n=>n.key!==s);t=t.map((n,d)=>({...n,order:d+1})),i(ue(t)),window.localStorage.setItem(y,JSON.stringify(t))}}return a.jsxs(a.Fragment,{children:[a.jsx("form",{onSubmit:A,className:m.form,children:a.jsxs("fieldset",{children:[a.jsx("legend",{className:"scr",children:re[e]}),a.jsxs("div",{className:m["todo-input-area"],children:[a.jsx("label",{htmlFor:"taskinput",children:q[e]}),a.jsx("textarea",{ref:h,id:"taskinput",className:"bg",name:"task",required:!0,autoComplete:"off",placeholder:`${W[e]}...`}),a.jsx("button",{id:m["submit-todo"],type:"submit",children:q[e]}),a.jsx("button",{className:"danger",disabled:!E,onClick:s=>w(s),children:ne[e]})]})]})}),a.jsxs("div",{className:m["list-wrap"],children:[a.jsxs("p",{className:m["left-to-do"],children:[r==null?void 0:r.filter(s=>!(s!=null&&s.complete)).length," ",ae[e]]}),a.jsx(xe,{todosWithIdAndStatus:x,setTodosWithIdAndStatus:_,toggleTodo:u,deleteTodo:p,language:e,modifyTodo:I,modifyTodoOrder:O}),N==="loading"&&a.jsxs("p",{children:[oe[e],"..."]})]})]})}export{qe as default};
