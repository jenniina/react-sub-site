import{r as b,j as s}from"./react-kX_YxI4E.js";import{c as S}from"./cart-CgS8CQgD.js";import{u as J,L as K,bf as r,S as I,bn as W,bg as X,bj as v,bk as C,ax as Z,bl as Y,bm as g,bo as w,bp as q,bh as O,az as z,aC as ss,av as ts,bi as T,bq as M,aD as Q,br as es,bs as as,bt as is,bu as ns,o,bv as ls}from"./index-ht7i4Lck.js";import"./dom-to-image-more-CfDXlNbO.js";import"./axios-CCb-kr4I.js";import"./react-dom-B5MLDbn_.js";import"./scheduler-CzFDRTuY.js";import"./react-redux-BEmJlIGA.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./react-is-DUDD-a5e.js";import"./use-sync-external-store-BPp6CH6k.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./react-icons-DhcENkY1.js";import"./react-router-dom-StiqOUIT.js";import"./react-router-DUuhLvki.js";import"./@remix-run-DTnHqtaE.js";const Ss=({language:a,user:m,statusOptions:D,paidOptions:B,splitToLines:L,paidStatus:N,itemStatus:V,info:_})=>{const u=J(),U=K(),[i,h]=b.useState(null),[k,G]=b.useState(!1),[y,E]=b.useState(!1),A=async()=>{var e,d;try{const x=(await S.getAllOrders(a,m._id)).map(j=>({...j,createdAt:new Date(j.createdAt),updatedAt:new Date(j.updatedAt)})).sort((j,f)=>j.status==="cancelled"&&f.status!=="cancelled"?1:j.status!=="cancelled"&&f.status==="cancelled"?-1:f.createdAt.getTime()-j.createdAt.getTime());h(x)}catch(p){(d=(e=p.response)==null?void 0:e.data)!=null&&d.message?u(o(p.response.data.message,!0,8)):u(o(p.message,!0,8))}};b.useEffect(()=>{m&&(m!=null&&m.role)&&(m==null?void 0:m.role)>1&&A()},[m]),b.useEffect(()=>{i&&h(i.map(e=>({...e,total:e.items.map(d=>d.price*d.quantity).reduce((d,p)=>d+p,0)})))},[k]);const H=async e=>{S.deleteOrder(a,e,m._id).then(()=>{u(o(`${ls[a]} ${e}`,!1,5)),A()}).catch(d=>{var p,x;(x=(p=d.response)==null?void 0:p.data)!=null&&x.message?u(o(d.response.data.message,!0,8)):u(o(d.message,!0,8))})},$=async e=>{E(!0),S.updateOrder(a,e,m._id).then(d=>{d.success&&u(o(`${d.message}`,!1,5)),A(),E(!1)}).catch(d=>{var p,x;(x=(p=d.response)==null?void 0:p.data)!=null&&x.message?u(o(d.response.data.message,!0,8)):u(o(d.message,!0,8)),E(!1)})};return s.jsx("div",{className:`${r.orders} ${U?r.light:""}`,children:i==null?void 0:i.map((e,d)=>{var p,x,j,f,F,P,R;return s.jsx("div",{className:`${r.order} ${e.status==="completed"?r.completed:e.status==="cancelled"?r.cancelled:e.status==="pending"?r.pending:e.status==="in progress"?r["in-progress"]:""}`,children:s.jsx(I,{language:a,text:`${e.status==="completed"?"[ "+W[a]+" ] ":""}${e.orderID} ${e.info.companyName?`${e.info.name} (${e.info.companyName})`:e.info.name}`,hideBrackets:!0,className:`${e.status==="cancelled"||e.status==="completed"?"reset":e.status==="pending"?"grayer":""} change-status`,wrapperClass:r["change-status-main"],showButton:!0,children:s.jsxs(s.Fragment,{children:[s.jsxs("h2",{children:[e.info.name," ",e.info.companyName?`(${e.info.companyName})`:""]}),s.jsxs("div",{className:r["info-wrap"],children:[s.jsx("p",{children:s.jsxs("big",{children:[s.jsxs("strong",{children:[X[a],": "]}),e.orderID]})}),s.jsxs("p",{children:[s.jsxs("strong",{children:[v[a],": "]}),V(e.status)]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[C[a],": "]}),N[e.items.every(t=>t.paid==="full")?"full":e.items.every(t=>t.paid==="none")?"none":"partial"]]}),s.jsxs("p",{children:[Z[a],": ",s.jsxs("big",{children:[e.total," € "]})]}),s.jsxs("table",{className:`${r["info-table"]}`,children:[s.jsx("caption",{children:Y[a]}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsxs("th",{children:[Y[a],": "]}),s.jsxs("td",{children:[(p=e.createdAt)==null?void 0:p.toLocaleDateString()," ",(x=e.createdAt)==null?void 0:x.toLocaleTimeString()]})]}),s.jsxs("tr",{children:[s.jsxs("th",{children:[g[a],": "]}),s.jsxs("td",{children:[e.updatedAt.toLocaleDateString()," ",(j=e.updatedAt)==null?void 0:j.toLocaleTimeString()]})]})]})]})]}),s.jsx(I,{language:a,text:`${w[a]} (${v[a]})`,hideBrackets:!0,className:"narrow2 change-status",wrapperClass:r["change-status-main"],children:s.jsx(s.Fragment,{children:s.jsxs("form",{className:r["change-status-form"],onSubmit:t=>{t.preventDefault(),$(i==null?void 0:i.find(n=>n.orderID===e.orderID))},children:[s.jsx(q,{language:a,id:`status-${e.orderID}`,className:"status",instructions:"Status",options:D,value:D.find(t=>t.value===e.status),onChange:t=>{h(i==null?void 0:i.map(n=>n.orderID===e.orderID?{...n,status:t==null?void 0:t.value}:n))}}),s.jsx("button",{type:"submit",disabled:y,children:O[a]})]})})}),(f=e.items)==null?void 0:f.map(t=>s.jsxs("div",{className:r["item-wrap"],children:[s.jsx("h3",{children:t.name}),s.jsx("p",{children:t.description}),s.jsxs("p",{children:[s.jsxs("strong",{children:[z[a],": "]}),t.id==="misc-quote"?t.price+" €":t.price+" x "+t.quantity+" = "+t.quantity*t.price+" €"]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[ss[a],": "]})," ",s.jsx("br",{}),L(t.details)]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[v[a],": "]}),V(t.status)," "]}),t.id==="misc-quote"?null:s.jsxs("p",{children:[s.jsxs("strong",{children:[C[a],": "]}),N[t.paid]]},t.id),s.jsx(I,{language:a,text:`${w[a]}`,hideBrackets:!0,className:"narrow2 change-status",wrapperClass:r["change-status"],children:s.jsx(s.Fragment,{children:s.jsxs("form",{className:r["change-status-form"],onSubmit:n=>{n.preventDefault(),$(i==null?void 0:i.find(l=>l.orderID===e.orderID))},children:[s.jsxs("label",{children:[s.jsx("span",{children:z[a]}),s.jsx("input",{type:"number",className:"bg",name:`price-${t.id}`,defaultValue:t.price,onChange:n=>{h(i==null?void 0:i.map(l=>l.orderID===e.orderID?{...l,items:l.items.map(c=>c.id===t.id?{...c,price:Number(n.target.value)}:c)}:l)),G(!k)}})]}),s.jsxs("label",{children:[s.jsx("span",{children:ts[a]}),s.jsx("input",{type:"number",className:"bg",name:`quantity-${t.id}`,defaultValue:t.quantity,onChange:n=>{h(i==null?void 0:i.map(l=>l.orderID===e.orderID?{...l,items:l.items.map(c=>c.id===t.id?{...c,quantity:Number(n.target.value)}:c)}:l))}})]}),s.jsxs("label",{children:[s.jsx("span",{children:T[a]}),s.jsx("textarea",{name:`details-${t.id}`,rows:6,defaultValue:t.details,onChange:n=>{h(i==null?void 0:i.map(l=>l.orderID===e.orderID?{...l,items:l.items.map(c=>c.id===t.id?{...c,details:n.target.value}:c)}:l))}})]}),s.jsx(q,{language:a,id:`status-${t.id}`,className:`status ${M.prev2}`,instructions:v[a],options:D,value:D.find(n=>n.value===t.status),onChange:n=>{h(i==null?void 0:i.map(l=>l.orderID===e.orderID?{...l,items:l.items.map(c=>c.id===t.id?{...c,status:n==null?void 0:n.value}:c)}:l))}}),s.jsx(q,{language:a,id:`paid-${t.id}`,className:`paid ${M.prev}`,instructions:C[a],options:B,value:B.find(n=>n.value===t.paid),onChange:n=>{h(i==null?void 0:i.map(l=>l.orderID===e.orderID?{...l,items:l.items.map(c=>c.id===t.id?{...c,paid:n==null?void 0:n.value}:c)}:l))}}),s.jsx("button",{type:"submit",disabled:y,children:O[a]})]})})})]},t.id)),s.jsxs("div",{className:r["info-wrap"],children:[s.jsxs("table",{className:`${r["info-table"]}`,children:[s.jsx("caption",{children:T[a]}),s.jsx("tbody",{children:Object.keys(e.info).map(t=>{var n;return t==="_id"?null:e.info[t]!==null&&((n=e.info[t])==null?void 0:n.trim())!==""&&s.jsxs("tr",{children:[s.jsxs("th",{children:[_(t),":"]}),s.jsx("td",{children:e.info[t]})]},t)})})]}),e.extra&&e.extra.trim()!==""&&s.jsxs("p",{children:[s.jsxs("strong",{children:[Q[a],": "]})," ",s.jsx("br",{}),L(e.extra)]}),s.jsx(I,{language:a,text:`${w[a]} (${T[a]})`,hideBrackets:!0,className:"narrow2 change-status",wrapperClass:r["change-status-info"],children:s.jsx(s.Fragment,{children:s.jsxs("form",{className:r["change-status-form"],onSubmit:t=>{t.preventDefault(),$(i==null?void 0:i.find(n=>n.orderID===e.orderID))},children:[Object.keys(e.info).map((t,n)=>t==="_id"?null:s.jsxs("label",{children:[s.jsx("span",{children:_(t)}),s.jsx("input",{type:"text",className:"bg",name:`info-${t}-${n}`,defaultValue:e.info[t],onChange:l=>{h(i==null?void 0:i.map(c=>c.orderID===e.orderID?{...c,info:{...c.info,[t]:l.target.value}}:c))}})]},`${t}-${n}`)),s.jsxs("label",{children:[s.jsx("span",{children:Q[a]}),s.jsx("textarea",{rows:6,name:`additional-${e.orderID}`,defaultValue:e.extra,onChange:t=>{h(i==null?void 0:i.map(n=>n.orderID===e.orderID?{...n,extra:t.target.value}:n))}})]}),(F=e.items)!=null&&F.every(t=>t.paid==="full")?s.jsx("button",{onClick:()=>{h(i==null?void 0:i.map(t=>t.orderID===e.orderID?{...t,status:"completed"}:t)),$(i==null?void 0:i.find(t=>t.orderID===e.orderID))},children:W[a]},e.updatedAt.toString()):s.jsxs("div",{children:[es[a]," ",s.jsx("br",{}),((P=e.items)==null?void 0:P.some(t=>t.paid!=="full"))&&as[a],":"," ",s.jsx("ul",{className:"ul",children:(R=e.items)==null?void 0:R.filter(t=>t.paid!=="full").map((t,n)=>s.jsxs("li",{children:[t.name," (",N[t.paid],")"]},`${t.paid}-${n}`))})]},e.updatedAt.toString()),s.jsx("button",{type:"submit",disabled:y,children:O[a]})]})})}),m&&m.role&&m.role>2&&s.jsx("div",{className:`${r["delete-order"]}`,children:s.jsxs("button",{className:"danger delete",onClick:()=>{window.confirm(`${is[a]} ${e.orderID}?`)&&H(e.orderID)},children:[ns[a],": ",e.orderID]},e.createdAt.toString())})]})]})})},`${e.orderID}-${d}`)})})};export{Ss as default};
