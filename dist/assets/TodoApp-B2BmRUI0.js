import{r as o,j as s}from"./react-A9DAvxly.js";import{bQ as Te,bR as Ee,bS as ce,bT as c,bU as oe,be as fe,S as re,ba as Y,bV as ee,bW as Se,bX as ie,bY as De,bZ as se,b_ as pe,b$ as de,c0 as ve,c1 as $e,c2 as Ce,c3 as ke,c4 as ue,c5 as ge,c6 as Fe,c7 as ae,f as Me,e as _e,c8 as Ie,g as Ae,c9 as Oe,ca as Pe,cb as Ye,cc as ze,cd as Re,ce as qe,K as Le,bu as Be,cf as Je,cg as ne,W as $,ch as Ue,ci as he,cj as He,ck as ye,cl as Ke,cm as We,cn as Ve,co as Xe,cp as Ze,cq as Qe,cr as Ge,ag as es,cs as xe,ct as je,cu as we,cv as be,cw as ss,cx as rs,cy as ts,cz as as,cA as me,cB as ns,cC as ls,cD as is}from"./index-BQcww9yM.js";import{W as cs,X as ms,Y as os,Z as fs,_ as ps,$ as ds,a0 as us,a1 as hs,a2 as ys,a3 as xs,F as js,a4 as ws}from"./react-icons-jnmi4x7s.js";import{R as bs}from"./react-dom-CxfJ6lHP.js";import{a as le}from"./react-redux-C4cSaZU-.js";import{v as Ns}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-CCb-kr4I.js";import"./react-router-dom-CYs6befe.js";import"./react-router-S1Hdk0kP.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./scheduler-CzFDRTuY.js";import"./use-sync-external-store-DEc9BFqZ.js";const Ne=ke(6),Ss=({todo:e,language:t,priorityOptions:m,categoryOptions:a,handleModify:z,sending:F,newCategory:R,newPriority:B,setNewPriority:J,setNewCategory:V,showDeadline:N,setShowDeadline:U,title:S,newName:A,setNewName:C,newDay:f,setNewDay:p,newMonth:E,setNewMonth:k,newYear:j,setNewYear:y,setIsOpen:M})=>{const[w,h]=o.useState(null),H=l=>{C(l.target.value)},X=l=>{Number(l)<=31&&l.length<=2?(p(l),h(null)):h(`${ue[t]}: ${pe[t]}`)},te=l=>{Number(l)<=12&&l.length<=2?(k(l),h(null)):h(`${ue[t]}: ${de[t]}`)},_=l=>{const u=l.target.value;Number(u)<=Number(new Date().getFullYear())+10&&u.length<=4?(y(u),h(null)):h(ge[t])};o.useEffect(()=>{if(f&&E&&j){const l=new Date(Number(j),Number(E)-1,Number(f)),u=new Date;u.setHours(0,0,0,0),h(null),l<u&&h(Te[t])}},[f,E,j,t]),o.useEffect(()=>{N?(f||p((new Date().getDate()+1).toString().padStart(2,"0")),E||k((new Date().getMonth()+1).toString().padStart(2,"0")),j||y(new Date().getFullYear().toString())):(p(""),k(""),y(""))},[N]);const T=o.useRef(null),g=o.useRef(null);o.useEffect(()=>{var u;g.current=document.activeElement,(u=T.current)==null||u.focus();const l=O=>{var q,L;if(O.key==="Tab"){const D=(L=(q=T.current)==null?void 0:q.parentElement)==null?void 0:L.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!D||D.length===0){O.preventDefault();return}const K=D==null?void 0:D[0],W=D==null?void 0:D[D.length-1];O.shiftKey?document.activeElement===K&&(O.preventDefault(),W==null||W.focus()):document.activeElement===W&&(O.preventDefault(),K==null||K.focus())}else O.key==="Escape"&&I()};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l),g.current?g.current.focus():document.body.focus()}},[T.current]);const I=()=>{M(!1),g.current?g.current.focus():document.body.focus()},Z=Ee();return bs.createPortal(s.jsx("div",{className:`${ce["modal-overlay"]} ${Z?c.light:""}`,onClick:I,children:s.jsxs("div",{className:`${ce["modal-content"]} ${c["todo-modal"]}`,onClick:l=>l.stopPropagation(),role:"dialog","aria-modal":"true","aria-label":S??"Task",children:[s.jsxs("button",{ref:T,className:`${ce["close-button"]} tooltip-wrap`,onClick:I,children:[s.jsx("span",{"aria-hidden":"true",children:"×"}),s.jsx("span",{className:"scr",children:oe[t]}),s.jsx("span",{"aria-hidden":"true",className:"tooltip below left narrow2",children:oe[t]})]}),s.jsx("h2",{children:fe[t]}),s.jsxs("form",{onSubmit:z,className:`${c.modify}`,children:[s.jsx(re,{id:`category_${Y(ee((e==null?void 0:e.name)??Ne,t))}`,className:`${c.select} ${c["category-select"]}`,value:a==null?void 0:a.find(l=>l.value===R),onChange:l=>V(l==null?void 0:l.value),options:a,instructions:Se[t],language:t,hideDelete:!0,z:3}),s.jsx(re,{id:`priority_${Y(ee((e==null?void 0:e.name)??Ne,t))}`,className:`${c.select}`,value:m==null?void 0:m.find(l=>l.value===B),onChange:l=>J(l==null?void 0:l.value),options:m,instructions:ie[t],language:t,hideDelete:!0,z:2}),s.jsxs("fieldset",{className:`${c.fieldset} ${c["deadline-wrap"]}`,children:[s.jsx("legend",{children:s.jsxs("label",{children:[De[t]," ",s.jsx("input",{style:{marginLeft:"0.5em"},type:"checkbox",checked:N,onChange:()=>U(!N)})]})}),N&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:c["deadline-inputs"],children:[s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`day_${Y(ee((e==null?void 0:e.name)??se[t],t))}`,children:pe[t]}),s.jsx("input",{type:"number",id:`day_${Y((e==null?void 0:e.name)||"Task")}`,name:"day",min:1,max:31,value:f,placeholder:"DD",onChange:l=>X(l.target.value),required:!0,className:"bg"})]}),s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`month_${Y((e==null?void 0:e.name)||"Task")}`,children:de[t]}),s.jsx("input",{type:"number",id:`month_${Y(ee((e==null?void 0:e.name)??se[t],t))}`,name:"month",min:1,max:12,value:E,placeholder:"MM",onChange:l=>te(l.target.value),required:!0,className:"bg"})]}),s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`year_${Y((e==null?void 0:e.name)||"Task")}`,children:ve[t]}),s.jsx("input",{type:"number",id:`year_${Y(ee((e==null?void 0:e.name)??se[t],t))}`,name:"year",min:new Date().getFullYear(),max:new Date().getFullYear()+10,value:j,placeholder:"YYYY",onChange:l=>_(l),required:!0,className:"bg"})]})]})," ",w&&s.jsx("p",{className:c.error,children:w})]})]}),s.jsxs("fieldset",{className:`${c.fieldset} ${c.textarea}`,children:[s.jsx("legend",{children:se[t]}),s.jsxs("label",{children:[s.jsx("textarea",{id:`task_${Y(e==null?void 0:e.name)}`,required:!0,name:"task",rows:4,value:A,onChange:H}),s.jsxs("span",{className:"scr",children:[fe[t]," ",ee((e==null?void 0:e.name)??se[t],t)]})]})]}),s.jsxs("button",{type:"submit",disabled:F,className:"modify",children:[$e[t]," ",s.jsx(cs,{})]}),s.jsxs("button",{onClick:I,className:`reset ${c.cancel}`,type:"button",children:[Ce[t]," ",s.jsx(ms,{})]})]})]})}),document.getElementById("modal-root"))};function Ts({todo:e,toggleTodo:t,deleteTodo:m,language:a,modifyTodo:z,isDragging:F,handleUpdate:R,handleDragging:B,sending:J,priorityOptions:V,categoryOptions:N,zin:U}){const[S,A]=o.useState((e==null?void 0:e.name)??""),[C,f]=o.useState(!1),[p,E]=o.useState((e==null?void 0:e.priority)||"low"),[k,j]=o.useState(e!=null&&e.deadline?new Date(e.deadline).getDate().toString().padStart(2,"0"):""),[y,M]=o.useState(e!=null&&e.deadline?(new Date(e.deadline).getMonth()+1).toString().padStart(2,"0"):""),[w,h]=o.useState(e!=null&&e.deadline?new Date(e.deadline).getFullYear().toString():""),H=k&&y&&w?`${w}-${y}-${k}`:"",[X,te]=o.useState((e==null?void 0:e.category)||"other"),[_,T]=o.useState(!1);function g(){t(e==null?void 0:e.key)}function I(){window.confirm(Re[a]+' "'+(e==null?void 0:e.name)+'"?')&&(A(""),m(e==null?void 0:e.key),T(!1))}const Z=n=>{n.preventDefault(),z(e==null?void 0:e.key,S,p,H,X),T(!1)};o.useEffect(()=>{e!=null&&e.deadline&&f(!0)},[e]),o.useEffect(()=>{if((e==null?void 0:e.name)!==S&&A((e==null?void 0:e.name)||""),e!=null&&e.deadline){const n=new Date(e.deadline);j(n.getDate().toString().padStart(2,"0")),M((n.getMonth()+1).toString().padStart(2,"0")),h(n.getFullYear().toString())}},[e]);const[l,u]=o.useState(!0),[O,q]=o.useState(!1),L=()=>{u(!0),q(!1)},D=()=>{u(!0)},K=()=>{u(!1)},W=()=>{u(!1),q(!0)},r=()=>{var n;(n=window.getSelection())!=null&&n.toString()?(u(!1),q(!0)):(u(!0),q(!1))},i=n=>{O&&n.preventDefault()};return s.jsx(s.Fragment,{children:s.jsxs("li",{style:{zIndex:`calc(${U} - ${e==null?void 0:e.order})`},className:`${F?"dragging":""} ${_?c.open:c.closed}`,draggable:l,onDragStart:n=>{var d;l?(n.dataTransfer.setData("application/my-app",(d=e==null?void 0:e.order)==null?void 0:d.toString()),B(!0)):n.preventDefault()},onDragEnd:()=>B(!1),children:[s.jsxs("span",{onMouseOver:D,onMouseDown:L,className:`${c["drag-handle"]} tooltip-wrap`,children:[s.jsx(os,{}),s.jsx("span",{className:"tooltip narrow2 below right",children:Fe[a]})]}),s.jsxs("label",{onClick:i,children:[s.jsx("input",{type:"checkbox",id:`check_${Y(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:g}),s.jsx("span",{onMouseOver:K,onMouseDown:W,onMouseUp:r,children:e==null?void 0:e.name})]}),s.jsxs("div",{className:`${c["btn-wrap"]}`,children:[(e==null?void 0:e.category)==="personal"?s.jsxs("b",{className:`tooltip-wrap ${c.cat}`,children:[s.jsx(fs,{}),s.jsxs("span",{className:"tooltip narrow2 below left",children:[ae[a],": ",Me[a]]})]}):(e==null?void 0:e.category)==="work"?s.jsxs("b",{className:`tooltip-wrap ${c.cat} ${c.bg}`,children:[s.jsx(ps,{}),s.jsxs("span",{className:"tooltip narrow2 below left",children:[ae[a],": ",_e[a]]})]}):(e==null?void 0:e.category)==="shopping"?s.jsxs("b",{className:`tooltip-wrap ${c.cat} ${c.bg}`,children:[s.jsx(ds,{}),s.jsxs("span",{className:"tooltip narrow2 below left",children:[ae[a],": ",Ie[a]]})]}):s.jsxs("b",{className:`tooltip-wrap ${c.cat}`,children:[s.jsx(us,{}),s.jsxs("span",{className:"tooltip narrow2 below left",children:[ae[a],": ",Ae[a]]})]}),(e==null?void 0:e.priority)==="high"?s.jsxs("b",{className:"tooltip-wrap",children:[s.jsx(hs,{}),s.jsxs("span",{className:"tooltip narrow2 below left",children:[ie[a],": ",Oe[a]]})]}):(e==null?void 0:e.priority)==="medium"?s.jsxs("b",{className:"tooltip-wrap",children:[s.jsx(ys,{}),s.jsxs("span",{className:"tooltip narrow2 below left",children:[ie[a],": ",Pe[a]]})]}):(e==null?void 0:e.priority)==="low"?s.jsxs("b",{className:"tooltip-wrap",children:[s.jsx(xs,{}),s.jsxs("span",{className:"tooltip narrow2 below left",children:[ie[a],": ",Ye[a]]})]}):s.jsx(s.Fragment,{children:" "}),s.jsx("button",{onClick:()=>T(!0),className:`${c.edit} tooltip-wrap`,disabled:(e==null?void 0:e.complete)??!1,children:fe[a]}),s.jsxs("button",{className:`${c.delete} tooltip-wrap`,onClick:_?()=>T(!1):I,children:[s.jsx("span",{"aria-hidden":"true",children:_?s.jsx(js,{style:{fontSize:"0.8em"}}):s.jsx(s.Fragment,{children:"×"})}),s.jsx("span",{className:"tooltip below left narrow2",children:_?oe[a]:ze[a]})]})]}),_&&s.jsx(Ss,{title:e==null?void 0:e.name,language:a,handleModify:Z,newName:S,setNewName:A,newPriority:p,setNewPriority:E,newDay:k,setNewDay:j,newMonth:y,setNewMonth:M,newYear:w,setNewYear:h,newCategory:X,setNewCategory:te,priorityOptions:V,categoryOptions:N,showDeadline:C,setShowDeadline:f,sending:J,todo:e,setIsOpen:T})]})})}function Es({toggleTodo:e,deleteTodo:t,language:m,modifyTodo:a,modifyTodoOrder:z,todosWithIdAndStatus:F,sending:R,priorityOptions:B,categoryOptions:J}){var A,C;const{isDragging:V,listItemsByStatus:N,handleUpdate:U,handleDragging:S}=qe(F,["todos"]);return s.jsx("ul",{className:`${c["todo-ul"]} todo-ul`,onDragOver:f=>f.preventDefault(),onDrop:f=>{var y;f.preventDefault();const p=f.dataTransfer.getData("application/my-app"),E=(y=Array.from(f.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:y.reduce((M,w)=>{const h=w.getBoundingClientRect(),H=Math.abs(h.top-f.clientY);return H<M.offset?{offset:H,element:w}:M},{offset:Number.POSITIVE_INFINITY}),k=Array.from(f.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(E.element);if(Number(p)===k)return;const j=U(Number(p),"todos",k);if(Array.isArray(j)){const M=j==null?void 0:j.map((w,h)=>({key:w.key,order:h}));z(M)}else console.error("Order is not an array");S(!1)},children:(C=(A=N.todos)==null?void 0:A.items)==null?void 0:C.slice().sort((f,p)=>f.order??0>(p.order??0)?1:-1).sort((f,p)=>f.complete===p.complete?0:f.complete?1:-1).map(f=>{var p;return s.jsx(Ts,{sending:R,toggleTodo:e,deleteTodo:t,todo:F==null?void 0:F.find(E=>E.key===f.key),language:m,modifyTodo:a,isDragging:V,handleUpdate:U,handleDragging:S,priorityOptions:B,categoryOptions:J,zin:(p=N.todos)==null?void 0:p.items.length},f==null?void 0:f.key)})})}function Js({language:e}){const t=Le(),m=le(r=>{var i;return(i=r.auth)==null?void 0:i.user});o.useEffect(()=>{t(Be())},[]);const a=le(r=>r.todos.todos),z=le(r=>r.todos.status),F=le(r=>r.todos.error),[R,B]=o.useState("low"),[J,V]=o.useState(""),[N,U]=o.useState("other"),[S,A]=o.useState("all"),[C,f]=o.useState("all"),p="ReactTodos",E=a==null?void 0:a.some(r=>r.complete);o.useEffect(()=>{if(a.length===0&&!m){const r=JSON.parse(window.localStorage.getItem(p)||"[]"),i=new Set(a.map(n=>n.key));r.forEach(n=>{i.has(n.key)||t(Je(n))})}},[t,a,m]),o.useEffect(()=>{window.localStorage.setItem(p,JSON.stringify(a))},[a]);const k=r=>{const i=new Set,n=[];return r.forEach(d=>{i.has(d.key)?n.push(d):i.add(d.key)}),n},j=r=>{if(!r){t($("Error: no key",!0,8));return}if(m!=null&&m._id)t(xe(m._id,r));else{t(je(r));const i=a.filter(n=>n.key!==r);window.localStorage.setItem(p,JSON.stringify(i))}};o.useEffect(()=>{const r=k(a),i=new Set;r.forEach(n=>{i.has(n.key)||(j(n.key),i.add(n.key))})},[a]);const[y,M]=o.useState([]),w=a.filter(r=>{const i=S==="all"||r.priority===S,n=C==="all"||r.category===C;return i&&n});o.useEffect(()=>{const r=w==null?void 0:w.slice().sort((i,n)=>(i.order??0)-(n.order??0)).map(i=>({...i,id:i.order,status:"todos"}));M(r)},[a,S,C]);const h=["all","low","medium","high"],H=["all","work","personal","shopping","other"],X=["low","medium","high"],te=["work","personal","shopping","other"],_=ne(h,e),T=ne(H,e),g=ne(X,e),I=ne(te,e);o.useEffect(()=>{z==="failed"&&t($(`There was an error: ${F}`,!0,8))},[z,F,t]);const[Z,l]=o.useState(!1);o.useEffect(()=>{m!=null&&m._id&&t(Ue(m._id)).then(()=>{t(he(m._id))}).catch(r=>{var i,n;console.error(r),(n=(i=r.response)==null?void 0:i.data)!=null&&n.message?t($(r.response.data.message,!0,8)):t($(`${r.message}`,!0,8))})},[m==null?void 0:m._id]);function u(r){const i=a.find(n=>n.key===r);if(i){const n={...i,complete:!i.complete};t(m?we(m._id,r,n):be(n))}}const O=async(r,i,n,d,Q)=>{if(l(!0),!r){t($("Error: no key",!0,8)),l(!1);return}const P=a.find(v=>v.key===r);if(P){const v={...P,name:i,priority:n,deadline:d,category:Q};if(m)await t(we(m._id,r,v)).then(()=>{t($(`${ss[e]}`,!1,3)),l(!1)}).catch(x=>{var b,G;console.error(x),(G=(b=x.response)==null?void 0:b.data)!=null&&G.message?t($(x.response.data.message,!0,8)):t($(`${x}`,!0,8)),l(!1)});else{t(be(v));const x=a.map(b=>b.key===r?v:b);window.localStorage.setItem(p,JSON.stringify(x)),l(!1)}}},q=r=>{var i,n;if(m)t(async d=>{var Q,P;try{await rs(m._id,r).then(()=>{d(he(m._id))})}catch(v){console.error(v),(P=(Q=v.response)==null?void 0:Q.data)!=null&&P.message?d($(v.response.data.message,!0,8)):d($(`${v}`,!0,8))}});else try{t(ts(r))}catch(d){console.error(d),(n=(i=d.response)==null?void 0:i.data)!=null&&n.message?t($(d.response.data.message,!0,8)):t($(`${d}`,!0,8))}finally{window.localStorage.setItem(p,JSON.stringify(a))}},L=o.useRef(null),D=r=>{var v;r.preventDefault(),l(!0);const i=((v=L.current)==null?void 0:v.value)??"";if(i===""){l(!1);return}const n=Ns(),d=a.reduce((x,b)=>b.order>x?b.order:x,0),Q=a.reduce((x,b)=>b.order<x?b.order:x,0);let P;if(R==="high"?P={key:n,name:i,complete:!1,order:Q-1,priority:R,deadline:J,category:N}:P={key:n,name:i,complete:!1,order:d+1,priority:R,deadline:J,category:N},m)t(as(m._id,P)),l(!1);else{const x=[...a,P].sort((b,G)=>b.order-G.order).map((b,G)=>({...b,order:G}));t(me(x)),window.localStorage.setItem(p,JSON.stringify(x)),me(x),l(!1)}L.current&&(L.current.value="")};async function K(r){if(r.preventDefault(),window.confirm(ns[e]))if(m)await t(ls(m._id));else{t(is());const i=a.filter(n=>!n.complete);window.localStorage.setItem(p,JSON.stringify(i))}}function W(r){if(!r){t($("Error: no key",!0,8));return}if(m!=null&&m._id)t(xe(m._id,r));else{t(je(r));let i=a.filter(n=>n.key!==r);i=i.map((n,d)=>({...n,order:d+1})),t(me(i)),window.localStorage.setItem(p,JSON.stringify(i))}}return s.jsxs(s.Fragment,{children:[s.jsx("form",{onSubmit:D,className:c.form,children:s.jsxs("fieldset",{children:[s.jsx("legend",{className:"scr",children:He[e]}),s.jsxs("div",{className:c["todo-input-area"],children:[s.jsx("label",{htmlFor:"taskinput",children:ye[e]}),s.jsx("textarea",{ref:L,id:"taskinput",className:"bg",rows:3,name:"task",required:!0,autoComplete:"off",placeholder:`${se[e]}...`}),s.jsx(re,{z:y.length+5,id:"category",className:`${c.select} ${c["category-select"]}`,hideDelete:!0,instructions:Se[e],value:I.find(r=>r.value===N)||I[0],onChange:r=>U(r==null?void 0:r.value),options:I,language:e}),s.jsx(re,{id:"priority",className:c.select,hideDelete:!0,instructions:Ke[e],value:g.find(r=>r.value===R)||g[0],onChange:r=>B(r==null?void 0:r.value),options:g,language:e,z:y.length+4}),s.jsxs("button",{id:c["submit-todo"],className:c["submit-todo"],type:"submit",disabled:Z,children:[ye[e]," ",s.jsx(ws,{})]})]})]})}),s.jsxs("div",{className:c["controls-wrap"],children:[s.jsx(re,{id:"category-filter",className:`${c.select} ${c["category-select"]}`,hideDelete:!0,instructions:We[e],value:T.find(r=>r.value===C)||T[0],onChange:r=>f(r==null?void 0:r.value),options:T,language:e,z:y.length+3}),s.jsx(re,{id:"priority-filter",className:c.select,hideDelete:!0,instructions:Ve[e],value:_.find(r=>r.value===S)||_[0],onChange:r=>A(r==null?void 0:r.value),options:_,language:e,z:y.length+2}),s.jsx("button",{className:`danger ${c["clear-completed"]}`,disabled:!E,onClick:r=>K(r),children:Xe[e]})]}),s.jsxs("div",{className:c["list-wrap"],children:[s.jsxs("p",{className:c["left-to-do"],children:[a==null?void 0:a.filter(r=>!(r!=null&&r.complete)).length," ",Ze[e]]}),(S!=="all"||C!=="all")&&s.jsxs("p",{className:c["filter-notification"],children:[Qe[e]," ",Ge[e]]}),s.jsx(Es,{sending:Z,todosWithIdAndStatus:y,toggleTodo:u,deleteTodo:W,language:e,modifyTodo:O,modifyTodoOrder:q,priorityOptions:g,categoryOptions:I}),z==="loading"&&s.jsxs("p",{className:"flex center margin0auto textcenter",children:[es[e],"..."]})]})]})}export{Js as default};
