import{r as i}from"./react-A9DAvxly.js";const Q=(E,r)=>{const[z,A]=i.useState(!1),[O,M]=i.useState(E);i.useEffect(()=>{M(E)},[E]);const R=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",d=i.useMemo(()=>r==null?void 0:r.map(n=>`${R?"local-":""}DnD-${n}`),[r,R]),S=i.useCallback(()=>r==null?void 0:r.reduce((n,o,l)=>{const g=JSON.parse(localStorage.getItem(d[l])||"[]");return n[o]={items:g,setItems:c=>{localStorage.setItem(d[l],JSON.stringify(c)),p(m=>({...m,[o]:{...m[o],items:c}}))},removeItems:()=>{localStorage.removeItem(d[l]),p(c=>({...c,[o]:{...c[o],items:[]}}))}},n},{}),[r,d]),a=(n,o)=>JSON.stringify(n)===JSON.stringify(o),[e,p]=i.useState(S),b=i.useRef(O),k=i.useRef(r);i.useEffect(()=>{const n=b.current,o=k.current;if(!a(n,O)||!a(o,r)){const l=r==null?void 0:r.reduce((g,c,m)=>{var h,J;const I=O.filter(D=>D.status===c);return g[c]={items:I,setItems:((h=e[c])==null?void 0:h.setItems)||(D=>{localStorage.setItem(d[m],JSON.stringify(D)),p(N=>({...N,[c]:{...N[c],items:D}}))}),removeItems:((J=e[c])==null?void 0:J.removeItems)||(()=>{localStorage.removeItem(d[m]),p(D=>({...D,[c]:{...D[c],items:[]}}))})},g},{});p(l),b.current=O,k.current=r}},[O,r,d]),i.useEffect(()=>{r==null||r.forEach((n,o)=>{const l=O==null?void 0:O.filter(g=>g.status===n);localStorage.setItem(d[o],JSON.stringify(l))})},[O,r,d]);const F=i.useCallback((n,o,l)=>{var J,D,N,L,U,x,C,K,v,j;const g=(J=Object.keys(e))==null?void 0:J.find(f=>{var q,y;return(y=(q=e==null?void 0:e[f])==null?void 0:q.items)==null?void 0:y.find($=>($==null?void 0:$.id)===n)});if(!g)return;const c=(N=(D=e==null?void 0:e[g])==null?void 0:D.items)==null?void 0:N.find(f=>(f==null?void 0:f.id)===n),m=(U=(L=e==null?void 0:e[o])==null?void 0:L.items)==null?void 0:U.findIndex(f=>(f==null?void 0:f.id)===l);if(!c)return;c.status=o;const I=(C=(x=e==null?void 0:e[g])==null?void 0:x.items)==null?void 0:C.filter(f=>f.id!==n);(K=e==null?void 0:e[g])==null||K.setItems(I);let h=[...(v=e==null?void 0:e[o])==null?void 0:v.items];return h=h.filter(f=>f.id!==c.id),h.splice(m>=0?m:h.length,0,c),(j=e==null?void 0:e[o])==null||j.setItems(h),p(f=>({...f,[g]:{...f[g],items:I},[o]:{...f[o],items:h}})),h},[e,p]),G=i.useCallback((n,o)=>{if(n===o)return;const l=r==null?void 0:r.indexOf(n);if(l===-1){console.error(`Old status "${n}" not found in statuses array`);return}const g=d[l],c=`${R?"local-":""}DnD-${o}`,m=e[n].items.map(I=>({...I,status:o}));p(I=>({...I,[n]:{...I[n],items:[]},[o]:{...I[o],items:m}})),localStorage.setItem(c,JSON.stringify(m)),localStorage.removeItem(g)},[e,d,r]);return{isDragging:z,listItemsByStatus:e,handleUpdate:F,handleRenameStatus:G,handleDragging:n=>A(n)}};export{Q as u};
