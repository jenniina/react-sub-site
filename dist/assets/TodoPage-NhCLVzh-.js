import{r as f,j as s}from"./react-A9DAvxly.js";import{cu as G,ax as P,bS as R,ef as V,eg as L,eh as Q,ei as X,ej as W,aZ as Z,c6 as ee,ek as H,b0 as E,el as se,em as re,en as U,eo as te,ep as ne,b1 as ae,eq as q,er as K,es as z,et as Y,eu as ie,ev as le,ew as oe,ex as ce,ey as de,ez as fe,eA as me,eB as pe,H as ue,cr as he,cs as Te,eC as xe,eD as ye,eE as je,eF as we,eG as _e,eH as ge,d7 as Ee,eI as Se,eJ as ke,K as Ne}from"./index-xrT_8w5r.js";import{J as be}from"./react-icons-DJiaMApb.js";import{u as De}from"./useDragAndDrop-CFENP5_-.js";import{a as $}from"./react-redux-CHm9GgGE.js";import{v as Ae}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./react-dom-yh0erWL-.js";import"./scheduler-CzFDRTuY.js";import"./@reduxjs-DTZ4pglK.js";import"./immer-BNrqi0cU.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-BimPEqV4.js";import"./react-router-dom-BQMcumiI.js";import"./react-router-344DmMNz.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./use-sync-external-store-DEc9BFqZ.js";const ve="_form_fflgg_1",Ie="_closed_fflgg_173",Ce="_open_fflgg_189",Oe="_modify_fflgg_173",m={form:ve,"list-wrap":"_list-wrap_fflgg_31","todo-input-area":"_todo-input-area_fflgg_37","todo-ul":"_todo-ul_fflgg_49","drag-handle":"_drag-handle_fflgg_83","btn-wrap":"_btn-wrap_fflgg_139",closed:Ie,"modify-todo":"_modify-todo_fflgg_173",open:Ce,delete:"_delete_fflgg_243","left-to-do":"_left-to-do_fflgg_291",modify:Oe};function Me({todo:e,toggleTodo:l,deleteTodo:i,language:r,modifyTodo:S,isDragging:y,handleUpdate:T,handleDragging:b}){const[k,j]=f.useState((e==null?void 0:e.name)??""),[g,w]=f.useState(!1);function D(){l(e==null?void 0:e.key)}function o(){window.confirm(Q[r]+' "'+(e==null?void 0:e.name)+'"?')&&(j(""),i(e==null?void 0:e.key),w(!1))}const u=c=>{c.preventDefault(),S(e==null?void 0:e.key,k),w(!1)},I=c=>{j(c.target.value)};f.useEffect(()=>{(e==null?void 0:e.name)!==k&&j((e==null?void 0:e.name)||"")},[e]);const A=c=>{const C="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";let B="";for(let J=0;J<c;J++){const F=Math.floor(Math.random()*C.length);B+=C.substring(F,F+1)}return B},h=(c=A(9))=>c.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"-"),v=(c=W[r])=>c.split(" ").length<=4?c:c.split(" ").slice(0,3).join(" ")+" "+X[r],[_,p]=f.useState(!0),[t,n]=f.useState(!1),a=()=>{p(!0),n(!1)},d=()=>{p(!0)},x=()=>{p(!1)},N=()=>{p(!1),n(!0)},O=()=>{var c;(c=window.getSelection())!=null&&c.toString()?(p(!1),n(!0)):(p(!0),n(!1))},M=c=>{t&&c.preventDefault()};return s.jsxs("li",{className:`${y?"dragging":""}`,draggable:_,onDragStart:c=>{var C;_?(c.dataTransfer.setData("application/my-app",(C=e==null?void 0:e.order)==null?void 0:C.toString()),b(!0)):c.preventDefault()},onDragEnd:()=>b(!1),children:[s.jsxs("span",{onMouseOver:d,onMouseDown:a,className:`${m["drag-handle"]} tooltip-wrap`,children:[s.jsx(be,{}),s.jsx("span",{className:"tooltip narrow2 below right",children:G[r]})]}),s.jsxs("label",{className:`${g?m.open:m.closed}`,onClick:M,children:[s.jsx("input",{type:"checkbox",id:`check_${h(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:D}),s.jsx("span",{onMouseOver:x,onMouseDown:N,onMouseUp:O,children:e==null?void 0:e.name})]}),s.jsxs("div",{className:`${g?m.open:m.closed} ${m["btn-wrap"]}`,children:[s.jsx(P,{language:r,className:`${m["modify-todo"]} modify-todo`,text:R[r],isOpen:g,setIsFormOpen:w,hideBrackets:!1,onClick:()=>{j((e==null?void 0:e.name)??"")},children:s.jsxs("form",{onSubmit:u,className:`${m.modify}`,children:[s.jsxs("label",{children:[s.jsx("textarea",{id:`task_${h(e==null?void 0:e.name)}`,required:!0,name:"task",value:k,onChange:I}),s.jsxs("span",{className:"scr",children:[R[r]," ",v(e==null?void 0:e.name)]})]}),s.jsx("button",{type:"submit",className:"modify",children:V[r]})]})}),s.jsxs("button",{className:`${m.delete}`,onClick:o,"data-label":L[r],children:[s.jsx("span",{children:"Ã—"}),s.jsx("span",{className:"scr",children:L[r]})]})]})]})}function $e({toggleTodo:e,deleteTodo:l,language:i,modifyTodo:r,modifyTodoOrder:S,todosWithIdAndStatus:y,setTodosWithIdAndStatus:T}){var w,D;const{isDragging:b,listItemsByStatus:k,handleUpdate:j,handleDragging:g}=De(y,["todos"]);return Z(),s.jsx("ul",{className:`${m["todo-ul"]} todo-ul`,onDragOver:o=>o.preventDefault(),onDrop:o=>{var v;o.preventDefault();const u=o.dataTransfer.getData("application/my-app"),I=(v=Array.from(o.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:v.reduce((_,p)=>{const t=p.getBoundingClientRect(),n=Math.abs(t.top-o.clientY);return n<_.offset?{offset:n,element:p}:_},{offset:Number.POSITIVE_INFINITY}),A=Array.from(o.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(I.element);if(Number(u)===A)return;const h=j(Number(u),"todos",A);if(Array.isArray(h)){const _=h==null?void 0:h.map((p,t)=>({key:p.key,order:t}));S(_)}else console.error("Order is not an array");g(!1)},children:(D=(w=k.todos)==null?void 0:w.items)==null?void 0:D.slice().sort((o,u)=>o.order??0>(u.order??0)?1:-1).sort((o,u)=>o.complete===u.complete?0:o.complete?1:-1).map(o=>s.jsx(Me,{toggleTodo:e,deleteTodo:l,todo:y==null?void 0:y.find(u=>u.key===o.key),language:i,modifyTodo:r,isDragging:b,handleUpdate:j,handleDragging:g},o==null?void 0:o.key))})}function Be({language:e}){const l=Z(),i=$(t=>{var n;return(n=t.auth)==null?void 0:n.user});f.useEffect(()=>{l(ee())},[]);const r=$(t=>t.todos.todos),S=$(t=>t.todos.status),y=$(t=>t.todos.error),T="ReactTodos",b=r==null?void 0:r.some(t=>t.complete);f.useEffect(()=>{if(r.length===0&&!i){const t=JSON.parse(window.localStorage.getItem(T)||"[]"),n=new Set(r.map(a=>a.key));t.forEach(a=>{n.has(a.key)||l(H(a))})}},[l,r,i]),f.useEffect(()=>{window.localStorage.setItem(T,JSON.stringify(r))},[r]);const k=t=>{const n=new Set,a=[];return t.forEach(d=>{n.has(d.key)?a.push(d):n.add(d.key)}),a},j=t=>{if(!t){l(E("Error: no key",!0,8));return}if(i!=null&&i._id)l(q(i._id,t));else{l(K(t));const n=r.filter(a=>a.key!==t);window.localStorage.setItem(T,JSON.stringify(n))}};f.useEffect(()=>{const t=k(r),n=new Set;t.forEach(a=>{n.has(a.key)||(j(a.key),n.add(a.key))})},[r]);const[g,w]=f.useState([]);f.useEffect(()=>{const t=r==null?void 0:r.slice().sort((n,a)=>(n.order??0)-(a.order??0)).map(n=>({...n,id:n.order,status:"todos"}));w(t)},[r]),f.useEffect(()=>{S==="failed"&&l(E(`There was an error: ${y}`,!0,8))},[S,y,l]);const[D,o]=f.useState(!1);f.useEffect(()=>{i!=null&&i._id&&!D&&l(se(i._id)).then(()=>{o(!0)})},[i==null?void 0:i._id]);function u(t){const n=r.find(a=>a.key===t);if(n){const a={...n,complete:!n.complete};l(i?z(i._id,t,a):Y(a))}}const I=async(t,n)=>{if(!t){l(E("Error: no key",!0,8));return}const a=r.find(d=>d.key===t);if(a){const d={...a,name:n};if(i)await l(z(i._id,t,d)).then(()=>{l(E("Todo updated",!1,3))}).catch(x=>{console.error(x),l(E(`${x}`,!0,8))});else{l(Y(d));const x=r.map(N=>N.key===t?d:N);window.localStorage.setItem(T,JSON.stringify(x))}}},A=t=>{if(i)l(async n=>{try{await ie(i._id,t).then(()=>{n(le(i._id))})}catch(a){console.error(a),n(E(`${a}`,!0,8))}});else try{l(oe(t))}catch(n){console.error(n),l(E(`${n}`,!0,8))}finally{window.localStorage.setItem(T,JSON.stringify(r))}},h=f.useRef(null),v=t=>{var N;t.preventDefault();const n=((N=h.current)==null?void 0:N.value)??"";if(n==="")return;const a=Ae(),d=r.reduce((O,M)=>M.order>O?M.order:O,0),x={key:a,name:n,complete:!1,order:d+1};i?l(ce(i._id,x)):(l(H(x)),window.localStorage.setItem(T,JSON.stringify([...r,x]))),h.current&&(h.current.value="")};async function _(t){if(t.preventDefault(),window.confirm(de[e]))if(i)await l(fe(i._id));else{l(me());const n=r.filter(a=>!a.complete);window.localStorage.setItem(T,JSON.stringify(n))}}function p(t){if(!t){l(E("Error: no key",!0,8));return}if(i!=null&&i._id)l(q(i._id,t));else{l(K(t));let n=r.filter(a=>a.key!==t);n=n.map((a,d)=>({...a,order:d+1})),l(pe(n)),window.localStorage.setItem(T,JSON.stringify(n))}}return s.jsxs(s.Fragment,{children:[s.jsx("form",{onSubmit:v,className:m.form,children:s.jsxs("fieldset",{children:[s.jsx("legend",{className:"scr",children:re[e]}),s.jsxs("div",{className:m["todo-input-area"],children:[s.jsx("label",{htmlFor:"taskinput",children:U[e]}),s.jsx("textarea",{ref:h,id:"taskinput",className:"bg",name:"task",required:!0,autoComplete:"off",placeholder:`${W[e]}...`}),s.jsx("button",{id:m["submit-todo"],type:"submit",children:U[e]}),s.jsx("button",{className:"danger",disabled:!b,onClick:t=>_(t),children:te[e]})]})]})}),s.jsxs("div",{className:m["list-wrap"],children:[s.jsxs("p",{className:m["left-to-do"],children:[r==null?void 0:r.filter(t=>!(t!=null&&t.complete)).length," ",ne[e]]}),s.jsx($e,{todosWithIdAndStatus:g,setTodosWithIdAndStatus:w,toggleTodo:u,deleteTodo:p,language:e,modifyTodo:I,modifyTodoOrder:A}),S==="loading"&&s.jsxs("p",{children:[ae[e],"..."]})]})]})}function ts({heading:e,text:l,type:i,language:r}){return s.jsxs("div",{className:`todo ${i}`,children:[s.jsx(ue,{language:r,address:"todo",heading:e,text:l}),s.jsxs("div",{className:"inner-wrap",children:[s.jsx("section",{className:"card",children:s.jsx("div",{children:s.jsx("div",{className:"medium",children:s.jsxs(P,{language:r,text:he[r],className:"features",children:[s.jsx("h2",{children:Te[r]}),s.jsxs("ul",{className:"ul",children:[s.jsx("li",{children:xe[r]}),s.jsx("li",{children:ye[r]}),s.jsx("li",{children:je[r]}),s.jsx("li",{children:we[r]}),s.jsx("li",{children:_e[r]}),s.jsx("li",{children:ge[r]})]}),s.jsx("h3",{children:Ee[r]}),s.jsxs("ul",{className:"ul",children:[s.jsx("li",{children:Se[r]}),s.jsx("li",{children:ke[r]})]})]})})})}),s.jsx("section",{className:"card",children:s.jsx("div",{children:s.jsxs("div",{className:"medium",children:[s.jsx("h2",{children:Ne[r]}),s.jsx(Be,{language:r})]})})})]})]})}export{ts as default};
