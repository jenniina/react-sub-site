import{r as D,j as e}from"./react-kX_YxI4E.js";import{c as A}from"./cart-CgS8CQgD.js";import{L as R,u as W,l as Y,w as r,A as I,S as C,x as V,e as f}from"./index-BoQMGU2_.js";import"./dom-to-image-more-CfDXlNbO.js";import"./axios-CCb-kr4I.js";import"./react-dom-B5MLDbn_.js";import"./scheduler-CzFDRTuY.js";import"./react-redux-BEmJlIGA.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./react-is-DUDD-a5e.js";import"./use-sync-external-store-BPp6CH6k.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./react-icons-CzVo0GbG.js";import"./react-router-dom-StiqOUIT.js";import"./react-router-DUuhLvki.js";import"./@remix-run-DTnHqtaE.js";const pe=({language:h,user:m,statusOptions:$,paidOptions:w,splitToLines:O,paidStatus:y,itemStatus:q,info:E})=>{const{t:i}=D.useContext(R),j=W(),_=Y(),[a,u]=D.useState(null),[P,F]=D.useState(!1),[N,v]=D.useState(!1),S=async()=>{var s,d;try{const x=(await A.getAllOrders(h,m._id)).map(o=>({...o,createdAt:new Date(o.createdAt),updatedAt:new Date(o.updatedAt)})).sort((o,g)=>o.status==="cancelled"&&g.status!=="cancelled"?1:o.status!=="cancelled"&&g.status==="cancelled"?-1:g.createdAt.getTime()-o.createdAt.getTime());u(x)}catch(p){(d=(s=p.response)==null?void 0:s.data)!=null&&d.message?j(f(p.response.data.message,!0,8)):j(f(p.message,!0,8))}};D.useEffect(()=>{m&&(m!=null&&m.role)&&(m==null?void 0:m.role)>1&&S()},[m]),D.useEffect(()=>{a&&u(a.map(s=>({...s,total:s.items.map(d=>d.price*d.quantity).reduce((d,p)=>d+p,0)})))},[P]);const k=async s=>{A.deleteOrder(h,s,m._id).then(()=>{j(f(`${i("Deleted")} ${s}`,!1,5)),S()}).catch(d=>{var p,x;(x=(p=d.response)==null?void 0:p.data)!=null&&x.message?j(f(d.response.data.message,!0,8)):j(f(d.message,!0,8))})},b=async s=>{v(!0),A.updateOrder(h,s,m._id).then(d=>{d.success&&j(f(`${d.message}`,!1,5)),S(),v(!1)}).catch(d=>{var p,x;(x=(p=d.response)==null?void 0:p.data)!=null&&x.message?j(f(d.response.data.message,!0,8)):j(f(d.message,!0,8)),v(!1)})};return e.jsx("div",{className:`${r.orders} ${_?r.light:""}`,children:a==null?void 0:a.map((s,d)=>{var p,x,o,g,T,L,B;return e.jsx("div",{className:`${r.order} ${s.status==="completed"?r.completed:s.status==="cancelled"?r.cancelled:s.status==="pending"?r.pending:s.status==="in progress"?r["in-progress"]:""}`,children:e.jsx(I,{language:h,text:`${s.status==="completed"?"[ "+i("OrderCompleted")+" ] ":""}${s.orderID} ${s.info.companyName?`${s.info.name} (${s.info.companyName})`:s.info.name}`,hideBrackets:!0,className:`${s.status==="cancelled"||s.status==="completed"?"reset":s.status==="pending"?"grayer":""} change-status`,wrapperClass:r["change-status-main"],showButton:!0,children:e.jsxs(e.Fragment,{children:[e.jsxs("h2",{children:[s.info.name," ",s.info.companyName?`(${s.info.companyName})`:""]}),e.jsxs("div",{className:r["info-wrap"],children:[e.jsx("p",{children:e.jsxs("big",{children:[e.jsxs("strong",{children:[i("OrderID"),": "]}),s.orderID]})}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i("Status"),": "]}),q(s.status)]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i("PaymentState"),": "]}),y[s.items.every(t=>t.paid==="full")?"full":s.items.every(t=>t.paid==="none")?"none":"partial"]]}),e.jsxs("p",{children:[i("Total"),": ",e.jsxs("big",{children:[s.total," € "]})]}),e.jsxs("table",{className:`${r["info-table"]}`,children:[e.jsx("caption",{children:i("Ordered")}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("th",{children:[i("Ordered"),": "]}),e.jsxs("td",{children:[(p=s.createdAt)==null?void 0:p.toLocaleDateString()," ",(x=s.createdAt)==null?void 0:x.toLocaleTimeString()]})]}),e.jsxs("tr",{children:[e.jsxs("th",{children:[i("LastUpdated"),": "]}),e.jsxs("td",{children:[s.updatedAt.toLocaleDateString()," ",(o=s.updatedAt)==null?void 0:o.toLocaleTimeString()]})]})]})]})]}),e.jsx(I,{language:h,text:`${i("Edit")} (${i("Status")})`,hideBrackets:!0,className:"narrow2 change-status",wrapperClass:r["change-status-main"],children:e.jsx(e.Fragment,{children:e.jsxs("form",{className:r["change-status-form"],onSubmit:t=>{t.preventDefault(),b(a==null?void 0:a.find(n=>n.orderID===s.orderID))},children:[e.jsx(C,{language:h,id:`status-${s.orderID}`,className:"status",instructions:"Status",options:$,value:$.find(t=>t.value===s.status),onChange:t=>{u(a==null?void 0:a.map(n=>n.orderID===s.orderID?{...n,status:t==null?void 0:t.value}:n))}}),e.jsx("button",{type:"submit",disabled:N,children:i("Submit")})]})})}),(g=s.items)==null?void 0:g.map(t=>e.jsxs("div",{className:r["item-wrap"],children:[e.jsx("h3",{children:t.name}),e.jsx("p",{children:t.description}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i("Price"),": "]}),t.id==="misc-quote"?t.price+" €":t.price+" x "+t.quantity+" = "+t.quantity*t.price+" €"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i("RequestsAndNeeds"),": "]})," ",e.jsx("br",{}),O(t.details)]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i("Status"),": "]}),q(t.status)," "]}),t.id==="misc-quote"?null:e.jsxs("p",{children:[e.jsxs("strong",{children:[i("PaymentState"),": "]}),y[t.paid]]},t.id),e.jsx(I,{language:h,text:`${i("Edit")}`,hideBrackets:!0,className:"narrow2 change-status",wrapperClass:r["change-status"],children:e.jsx(e.Fragment,{children:e.jsxs("form",{className:r["change-status-form"],onSubmit:n=>{n.preventDefault(),b(a==null?void 0:a.find(l=>l.orderID===s.orderID))},children:[e.jsxs("label",{children:[e.jsx("span",{children:i("Price")}),e.jsx("input",{type:"number",className:"bg",name:`price-${t.id}`,defaultValue:t.price,onChange:n=>{u(a==null?void 0:a.map(l=>l.orderID===s.orderID?{...l,items:l.items.map(c=>c.id===t.id?{...c,price:Number(n.target.value)}:c)}:l)),F(!P)}})]}),e.jsxs("label",{children:[e.jsx("span",{children:i("Quantity")}),e.jsx("input",{type:"number",className:"bg",name:`quantity-${t.id}`,defaultValue:t.quantity,onChange:n=>{u(a==null?void 0:a.map(l=>l.orderID===s.orderID?{...l,items:l.items.map(c=>c.id===t.id?{...c,quantity:Number(n.target.value)}:c)}:l))}})]}),e.jsxs("label",{children:[e.jsx("span",{children:i("Info")}),e.jsx("textarea",{name:`details-${t.id}`,rows:6,defaultValue:t.details,onChange:n=>{u(a==null?void 0:a.map(l=>l.orderID===s.orderID?{...l,items:l.items.map(c=>c.id===t.id?{...c,details:n.target.value}:c)}:l))}})]}),e.jsx(C,{language:h,id:`status-${t.id}`,className:`status ${V.prev2}`,instructions:i("Status"),options:$,value:$.find(n=>n.value===t.status),onChange:n=>{u(a==null?void 0:a.map(l=>l.orderID===s.orderID?{...l,items:l.items.map(c=>c.id===t.id?{...c,status:n==null?void 0:n.value}:c)}:l))}}),e.jsx(C,{language:h,id:`paid-${t.id}`,className:`paid ${V.prev}`,instructions:i("PaymentState"),options:w,value:w.find(n=>n.value===t.paid),onChange:n=>{u(a==null?void 0:a.map(l=>l.orderID===s.orderID?{...l,items:l.items.map(c=>c.id===t.id?{...c,paid:n==null?void 0:n.value}:c)}:l))}}),e.jsx("button",{type:"submit",disabled:N,children:i("Submit")})]})})})]},t.id)),e.jsxs("div",{className:r["info-wrap"],children:[e.jsxs("table",{className:`${r["info-table"]}`,children:[e.jsx("caption",{children:i("Info")}),e.jsx("tbody",{children:Object.keys(s.info).map(t=>{var n;return t==="_id"?null:s.info[t]!==null&&((n=s.info[t])==null?void 0:n.trim())!==""&&e.jsxs("tr",{children:[e.jsxs("th",{children:[E(t),":"]}),e.jsx("td",{children:s.info[t]})]},t)})})]}),s.extra&&s.extra.trim()!==""&&e.jsxs("p",{children:[e.jsxs("strong",{children:[i("AdditionalInformation"),": "]})," ",e.jsx("br",{}),O(s.extra)]}),e.jsx(I,{language:h,text:`${i("Edit")} (${i("Info")})`,hideBrackets:!0,className:"narrow2 change-status",wrapperClass:r["change-status-info"],children:e.jsx(e.Fragment,{children:e.jsxs("form",{className:r["change-status-form"],onSubmit:t=>{t.preventDefault(),b(a==null?void 0:a.find(n=>n.orderID===s.orderID))},children:[Object.keys(s.info).map((t,n)=>t==="_id"?null:e.jsxs("label",{children:[e.jsx("span",{children:E(t)}),e.jsx("input",{type:"text",className:"bg",name:`info-${t}-${n}`,defaultValue:s.info[t],onChange:l=>{u(a==null?void 0:a.map(c=>c.orderID===s.orderID?{...c,info:{...c.info,[t]:l.target.value}}:c))}})]},`${t}-${n}`)),e.jsxs("label",{children:[e.jsx("span",{children:i("AdditionalInformation")}),e.jsx("textarea",{rows:6,name:`additional-${s.orderID}`,defaultValue:s.extra,onChange:t=>{u(a==null?void 0:a.map(n=>n.orderID===s.orderID?{...n,extra:t.target.value}:n))}})]}),(T=s.items)!=null&&T.every(t=>t.paid==="full")?e.jsx("button",{onClick:()=>{u(a==null?void 0:a.map(t=>t.orderID===s.orderID?{...t,status:"completed"}:t)),b(a==null?void 0:a.find(t=>t.orderID===s.orderID))},children:i("OrderCompleted")},s.updatedAt.toString()):e.jsxs("div",{children:[i("OrderNotCompleted")," ",e.jsx("br",{}),((L=s.items)==null?void 0:L.some(t=>t.paid!=="full"))&&i("MissingPayment"),":"," ",e.jsx("ul",{className:"ul",children:(B=s.items)==null?void 0:B.filter(t=>t.paid!=="full").map((t,n)=>e.jsxs("li",{children:[t.name," (",y[t.paid],")"]},`${t.paid}-${n}`))})]},s.updatedAt.toString()),e.jsx("button",{type:"submit",disabled:N,children:i("Submit")})]})})}),m&&m.role&&m.role>2&&e.jsx("div",{className:`${r["delete-order"]}`,children:e.jsxs("button",{className:"danger delete",onClick:()=>{window.confirm(`${i("AreYouSureYouWantToDelete")} ${s.orderID}?`)&&k(s.orderID)},children:[i("Delete"),": ",s.orderID]},s.createdAt.toString())})]})]})})},`${s.orderID}-${d}`)})})};export{pe as default};
