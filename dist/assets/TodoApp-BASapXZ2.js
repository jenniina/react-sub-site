import{r as p,j as o}from"./react-A9DAvxly.js";import{bF as B,bG as $,a$ as H,b3 as M,bH as z,bI as K,bJ as P,bK as J,bL as V,bM as G,K as W,bj as Q,bN as L,W as g,bO as X,bP as Z,bQ as Y,bR as ee,bS as se,ac as te,bT as F,bU as R,bV as U,bW as q,bX as re,bY as ae,bZ as ne,b_ as oe,b$ as ie,c0 as le,c1 as ce,c2 as de}from"./index-DcgSy2bx.js";import{aj as fe}from"./react-icons-DfNghVim.js";import{a as A}from"./react-redux-CHm9GgGE.js";import{v as me}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./react-dom-yh0erWL-.js";import"./scheduler-CzFDRTuY.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-CCb-kr4I.js";import"./react-router-dom-CYs6befe.js";import"./react-router-S1Hdk0kP.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./use-sync-external-store-DEc9BFqZ.js";const pe="_form_7mcgs_1",ue="_closed_7mcgs_173",he="_open_7mcgs_189",ye="_modify_7mcgs_173",u={form:pe,"list-wrap":"_list-wrap_7mcgs_31","todo-input-area":"_todo-input-area_7mcgs_37","todo-ul":"_todo-ul_7mcgs_49","drag-handle":"_drag-handle_7mcgs_83","btn-wrap":"_btn-wrap_7mcgs_139",closed:ue,"modify-todo":"_modify-todo_7mcgs_173",open:he,delete:"_delete_7mcgs_243","left-to-do":"_left-to-do_7mcgs_291",modify:ye};function Te({todo:e,toggleTodo:n,deleteTodo:i,language:r,modifyTodo:j,isDragging:_,handleUpdate:b,handleDragging:D}){const[k,w]=p.useState((e==null?void 0:e.name)??""),[S,x]=p.useState(!1);function O(){n(e==null?void 0:e.key)}function d(){window.confirm(V[r]+' "'+(e==null?void 0:e.name)+'"?')&&(w(""),i(e==null?void 0:e.key),x(!1))}const y=c=>{c.preventDefault(),j(e==null?void 0:e.key,k),x(!1)},v=c=>{w(c.target.value)};p.useEffect(()=>{(e==null?void 0:e.name)!==k&&w((e==null?void 0:e.name)||"")},[e]);const[E,f]=p.useState(!0),[I,T]=p.useState(!1),N=()=>{f(!0),T(!1)},s=()=>{f(!0)},t=()=>{f(!1)},a=()=>{f(!1),T(!0)},l=()=>{var c;(c=window.getSelection())!=null&&c.toString()?(f(!1),T(!0)):(f(!0),T(!1))},m=c=>{I&&c.preventDefault()};return o.jsxs("li",{className:`${_?"dragging":""}`,draggable:E,onDragStart:c=>{var h;E?(c.dataTransfer.setData("application/my-app",(h=e==null?void 0:e.order)==null?void 0:h.toString()),D(!0)):c.preventDefault()},onDragEnd:()=>D(!1),children:[o.jsxs("span",{onMouseOver:s,onMouseDown:N,className:`${u["drag-handle"]} tooltip-wrap`,children:[o.jsx(fe,{}),o.jsx("span",{className:"tooltip narrow2 below right",children:B[r]})]}),o.jsxs("label",{className:`${S?u.open:u.closed}`,onClick:m,children:[o.jsx("input",{type:"checkbox",id:`check_${$(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:O}),o.jsx("span",{onMouseOver:t,onMouseDown:a,onMouseUp:l,children:e==null?void 0:e.name})]}),o.jsxs("div",{className:`${S?u.open:u.closed} ${u["btn-wrap"]}`,children:[o.jsx(H,{language:r,className:`${u["modify-todo"]} modify-todo`,wrapperClass:"modify-todo-wrap",text:M[r],isOpen:S,setIsFormOpen:x,hideBrackets:!1,onClick:()=>{w((e==null?void 0:e.name)??"")},children:o.jsxs("form",{onSubmit:y,className:`${u.modify}`,children:[o.jsxs("label",{children:[o.jsx("textarea",{id:`task_${$(e==null?void 0:e.name)}`,required:!0,name:"task",value:k,onChange:v}),o.jsxs("span",{className:"scr",children:[M[r]," ",z((e==null?void 0:e.name)??K[r],r)]})]}),o.jsx("button",{type:"submit",className:"modify",children:P[r]})]})}),o.jsxs("button",{className:`${u.delete}`,onClick:d,"data-label":J[r],children:[o.jsx("span",{children:"Ã—"}),o.jsx("span",{className:"scr",children:J[r]})]})]})]})}function ge({toggleTodo:e,deleteTodo:n,language:i,modifyTodo:r,modifyTodoOrder:j,todosWithIdAndStatus:_,setTodosWithIdAndStatus:b}){var x,O;const{isDragging:D,listItemsByStatus:k,handleUpdate:w,handleDragging:S}=G(_,["todos"]);return W(),o.jsx("ul",{className:`${u["todo-ul"]} todo-ul`,onDragOver:d=>d.preventDefault(),onDrop:d=>{var I;d.preventDefault();const y=d.dataTransfer.getData("application/my-app"),v=(I=Array.from(d.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:I.reduce((T,N)=>{const s=N.getBoundingClientRect(),t=Math.abs(s.top-d.clientY);return t<T.offset?{offset:t,element:N}:T},{offset:Number.POSITIVE_INFINITY}),E=Array.from(d.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(v.element);if(Number(y)===E)return;const f=w(Number(y),"todos",E);if(Array.isArray(f)){const T=f==null?void 0:f.map((N,s)=>({key:N.key,order:s}));j(T)}else console.error("Order is not an array");S(!1)},children:(O=(x=k.todos)==null?void 0:x.items)==null?void 0:O.slice().sort((d,y)=>d.order??0>(y.order??0)?1:-1).sort((d,y)=>d.complete===y.complete?0:d.complete?1:-1).map(d=>o.jsx(Te,{toggleTodo:e,deleteTodo:n,todo:_==null?void 0:_.find(y=>y.key===d.key),language:i,modifyTodo:r,isDragging:D,handleUpdate:w,handleDragging:S},d==null?void 0:d.key))})}function Ye({language:e}){const n=W(),i=A(s=>{var t;return(t=s.auth)==null?void 0:t.user});p.useEffect(()=>{n(Q())},[]);const r=A(s=>s.todos.todos),j=A(s=>s.todos.status),_=A(s=>s.todos.error),b="ReactTodos",D=r==null?void 0:r.some(s=>s.complete);p.useEffect(()=>{if(r.length===0&&!i){const s=JSON.parse(window.localStorage.getItem(b)||"[]"),t=new Set(r.map(a=>a.key));s.forEach(a=>{t.has(a.key)||n(L(a))})}},[n,r,i]),p.useEffect(()=>{window.localStorage.setItem(b,JSON.stringify(r))},[r]);const k=s=>{const t=new Set,a=[];return s.forEach(l=>{t.has(l.key)?a.push(l):t.add(l.key)}),a},w=s=>{if(!s){n(g("Error: no key",!0,8));return}if(i!=null&&i._id)n(F(i._id,s));else{n(R(s));const t=r.filter(a=>a.key!==s);window.localStorage.setItem(b,JSON.stringify(t))}};p.useEffect(()=>{const s=k(r),t=new Set;s.forEach(a=>{t.has(a.key)||(w(a.key),t.add(a.key))})},[r]);const[S,x]=p.useState([]);p.useEffect(()=>{const s=r==null?void 0:r.slice().sort((t,a)=>(t.order??0)-(a.order??0)).map(t=>({...t,id:t.order,status:"todos"}));x(s)},[r]),p.useEffect(()=>{j==="failed"&&n(g(`There was an error: ${_}`,!0,8))},[j,_,n]);const[O,d]=p.useState(!1);p.useEffect(()=>{i!=null&&i._id&&!O&&n(X(i._id)).then(()=>{d(!0)})},[i==null?void 0:i._id]);function y(s){const t=r.find(a=>a.key===s);if(t){const a={...t,complete:!t.complete};n(i?U(i._id,s,a):q(a))}}const v=async(s,t)=>{if(!s){n(g("Error: no key",!0,8));return}const a=r.find(l=>l.key===s);if(a){const l={...a,name:t};if(i)await n(U(i._id,s,l)).then(()=>{n(g("Todo updated",!1,3))}).catch(m=>{var c,h;console.error(m),(h=(c=m.response)==null?void 0:c.data)!=null&&h.message?n(g(m.response.data.message,!0,8)):n(g(`${m}`,!0,8))});else{n(q(l));const m=r.map(c=>c.key===s?l:c);window.localStorage.setItem(b,JSON.stringify(m))}}},E=s=>{var t,a;if(i)n(async l=>{var m,c;try{await re(i._id,s).then(()=>{l(ae(i._id))})}catch(h){console.error(h),(c=(m=h.response)==null?void 0:m.data)!=null&&c.message?l(g(h.response.data.message,!0,8)):l(g(`${h}`,!0,8))}});else try{n(ne(s))}catch(l){console.error(l),(a=(t=l.response)==null?void 0:t.data)!=null&&a.message?n(g(l.response.data.message,!0,8)):n(g(`${l}`,!0,8))}finally{window.localStorage.setItem(b,JSON.stringify(r))}},f=p.useRef(null),I=s=>{var c;s.preventDefault();const t=((c=f.current)==null?void 0:c.value)??"";if(t==="")return;const a=me(),l=r.reduce((h,C)=>C.order>h?C.order:h,0),m={key:a,name:t,complete:!1,order:l+1};i?n(oe(i._id,m)):(n(L(m)),window.localStorage.setItem(b,JSON.stringify([...r,m]))),f.current&&(f.current.value="")};async function T(s){if(s.preventDefault(),window.confirm(ie[e]))if(i)await n(le(i._id));else{n(ce());const t=r.filter(a=>!a.complete);window.localStorage.setItem(b,JSON.stringify(t))}}function N(s){if(!s){n(g("Error: no key",!0,8));return}if(i!=null&&i._id)n(F(i._id,s));else{n(R(s));let t=r.filter(a=>a.key!==s);t=t.map((a,l)=>({...a,order:l+1})),n(de(t)),window.localStorage.setItem(b,JSON.stringify(t))}}return o.jsxs(o.Fragment,{children:[o.jsx("form",{onSubmit:I,className:u.form,children:o.jsxs("fieldset",{children:[o.jsx("legend",{className:"scr",children:Z[e]}),o.jsxs("div",{className:u["todo-input-area"],children:[o.jsx("label",{htmlFor:"taskinput",children:Y[e]}),o.jsx("textarea",{ref:f,id:"taskinput",className:"bg",name:"task",required:!0,autoComplete:"off",placeholder:`${K[e]}...`}),o.jsx("button",{id:u["submit-todo"],type:"submit",children:Y[e]}),o.jsx("button",{className:"danger",disabled:!D,onClick:s=>T(s),children:ee[e]})]})]})}),o.jsxs("div",{className:u["list-wrap"],children:[o.jsxs("p",{className:u["left-to-do"],children:[r==null?void 0:r.filter(s=>!(s!=null&&s.complete)).length," ",se[e]]}),o.jsx(ge,{todosWithIdAndStatus:S,setTodosWithIdAndStatus:x,toggleTodo:y,deleteTodo:N,language:e,modifyTodo:v,modifyTodoOrder:E}),j==="loading"&&o.jsxs("p",{children:[te[e],"..."]})]})]})}export{Ye as default};
