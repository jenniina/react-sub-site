import{r as f,j as a,bU as Z,bV as P,be as X,bi as Y,bW as G,bX as q,bY as Q,bZ as ee,b_ as W,b$ as se,K as H,a9 as M,bz as te,c0 as F,V as b,c1 as ne,c2 as re,c3 as R,c4 as ae,c5 as ce,ad as le,c6 as z,c7 as K,c8 as B,c9 as V,ca as oe,cb as ie,cc as de,cd as fe,ce as me,cf as ue,cg as pe,ch as he,ci as ye}from"./index-DmCUPrzn.js";const Te="_form_7mcgs_1",ge="_closed_7mcgs_173",_e="_open_7mcgs_189",we="_modify_7mcgs_173",m={form:Te,"list-wrap":"_list-wrap_7mcgs_31","todo-input-area":"_todo-input-area_7mcgs_37","todo-ul":"_todo-ul_7mcgs_49","drag-handle":"_drag-handle_7mcgs_83","btn-wrap":"_btn-wrap_7mcgs_139",closed:ge,"modify-todo":"_modify-todo_7mcgs_173",open:_e,delete:"_delete_7mcgs_243","left-to-do":"_left-to-do_7mcgs_291",modify:we};function xe({todo:e,toggleTodo:l,deleteTodo:c,language:n,modifyTodo:N,isDragging:g,handleUpdate:y,handleDragging:E}){const[k,_]=f.useState((e==null?void 0:e.name)??""),[S,w]=f.useState(!1);function D(){l(e==null?void 0:e.key)}function o(){window.confirm(Q[n]+' "'+(e==null?void 0:e.name)+'"?')&&(_(""),c(e==null?void 0:e.key),w(!1))}const p=i=>{i.preventDefault(),N(e==null?void 0:e.key,k),w(!1)},I=i=>{_(i.target.value)};f.useEffect(()=>{(e==null?void 0:e.name)!==k&&_((e==null?void 0:e.name)||"")},[e]);const O=i=>{const v="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";let J="";for(let L=0;L<i;L++){const U=Math.floor(Math.random()*v.length);J+=v.substring(U,U+1)}return J},h=(i=O(9))=>i.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"-"),A=(i=W[n])=>i.split(" ").length<=4?i:i.split(" ").slice(0,3).join(" ")+" "+ee[n],[x,u]=f.useState(!0),[s,t]=f.useState(!1),r=()=>{u(!0),t(!1)},d=()=>{u(!0)},T=()=>{u(!1)},j=()=>{u(!1),t(!0)},C=()=>{var i;(i=window.getSelection())!=null&&i.toString()?(u(!1),t(!0)):(u(!0),t(!1))},$=i=>{s&&i.preventDefault()};return a.jsxs("li",{className:`${g?"dragging":""}`,draggable:x,onDragStart:i=>{var v;x?(i.dataTransfer.setData("application/my-app",(v=e==null?void 0:e.order)==null?void 0:v.toString()),E(!0)):i.preventDefault()},onDragEnd:()=>E(!1),children:[a.jsxs("span",{onMouseOver:d,onMouseDown:r,className:`${m["drag-handle"]} tooltip-wrap`,children:[a.jsx(Z,{}),a.jsx("span",{className:"tooltip narrow2 below right",children:P[n]})]}),a.jsxs("label",{className:`${S?m.open:m.closed}`,onClick:$,children:[a.jsx("input",{type:"checkbox",id:`check_${h(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:D}),a.jsx("span",{onMouseOver:T,onMouseDown:j,onMouseUp:C,children:e==null?void 0:e.name})]}),a.jsxs("div",{className:`${S?m.open:m.closed} ${m["btn-wrap"]}`,children:[a.jsx(X,{language:n,className:`${m["modify-todo"]} modify-todo`,text:Y[n],isOpen:S,setIsFormOpen:w,hideBrackets:!1,onClick:()=>{_((e==null?void 0:e.name)??"")},children:a.jsxs("form",{onSubmit:p,className:`${m.modify}`,children:[a.jsxs("label",{children:[a.jsx("textarea",{id:`task_${h(e==null?void 0:e.name)}`,required:!0,name:"task",value:k,onChange:I}),a.jsxs("span",{className:"scr",children:[Y[n]," ",A(e==null?void 0:e.name)]})]}),a.jsx("button",{type:"submit",className:"modify",children:G[n]})]})}),a.jsxs("button",{className:`${m.delete}`,onClick:o,"data-label":q[n],children:[a.jsx("span",{children:"Ã—"}),a.jsx("span",{className:"scr",children:q[n]})]})]})]})}function Se({toggleTodo:e,deleteTodo:l,language:c,modifyTodo:n,modifyTodoOrder:N,todosWithIdAndStatus:g,setTodosWithIdAndStatus:y}){var w,D;const{isDragging:E,listItemsByStatus:k,handleUpdate:_,handleDragging:S}=se(g,["todos"]);return H(),a.jsx("ul",{className:`${m["todo-ul"]} todo-ul`,onDragOver:o=>o.preventDefault(),onDrop:o=>{var A;o.preventDefault();const p=o.dataTransfer.getData("application/my-app"),I=(A=Array.from(o.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:A.reduce((x,u)=>{const s=u.getBoundingClientRect(),t=Math.abs(s.top-o.clientY);return t<x.offset?{offset:t,element:u}:x},{offset:Number.POSITIVE_INFINITY}),O=Array.from(o.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(I.element);if(Number(p)===O)return;const h=_(Number(p),"todos",O);if(Array.isArray(h)){const x=h==null?void 0:h.map((u,s)=>({key:u.key,order:s}));N(x)}else console.error("Order is not an array");S(!1)},children:(D=(w=k.todos)==null?void 0:w.items)==null?void 0:D.slice().sort((o,p)=>o.order??0>(p.order??0)?1:-1).sort((o,p)=>o.complete===p.complete?0:o.complete?1:-1).map(o=>a.jsx(xe,{toggleTodo:e,deleteTodo:l,todo:g==null?void 0:g.find(p=>p.key===o.key),language:c,modifyTodo:n,isDragging:E,handleUpdate:_,handleDragging:S},o==null?void 0:o.key))})}function Ne({language:e}){const l=H(),c=M(s=>{var t;return(t=s.auth)==null?void 0:t.user});f.useEffect(()=>{l(te())},[]);const n=M(s=>s.todos.todos),N=M(s=>s.todos.status),g=M(s=>s.todos.error),y="ReactTodos",E=n==null?void 0:n.some(s=>s.complete);f.useEffect(()=>{if(n.length===0&&!c){const s=JSON.parse(window.localStorage.getItem(y)||"[]"),t=new Set(n.map(r=>r.key));s.forEach(r=>{t.has(r.key)||l(F(r))})}},[l,n,c]),f.useEffect(()=>{window.localStorage.setItem(y,JSON.stringify(n))},[n]);const k=s=>{const t=new Set,r=[];return s.forEach(d=>{t.has(d.key)?r.push(d):t.add(d.key)}),r},_=s=>{if(!s){l(b("Error: no key",!0,8));return}if(c!=null&&c._id)l(z(c._id,s));else{l(K(s));const t=n.filter(r=>r.key!==s);window.localStorage.setItem(y,JSON.stringify(t))}};f.useEffect(()=>{const s=k(n),t=new Set;s.forEach(r=>{t.has(r.key)||(_(r.key),t.add(r.key))})},[n]);const[S,w]=f.useState([]);f.useEffect(()=>{const s=n==null?void 0:n.slice().sort((t,r)=>(t.order??0)-(r.order??0)).map(t=>({...t,id:t.order,status:"todos"}));w(s)},[n]),f.useEffect(()=>{N==="failed"&&l(b(`There was an error: ${g}`,!0,8))},[N,g,l]);const[D,o]=f.useState(!1);f.useEffect(()=>{c!=null&&c._id&&!D&&l(ne(c._id)).then(()=>{o(!0)})},[c==null?void 0:c._id]);function p(s){const t=n.find(r=>r.key===s);if(t){const r={...t,complete:!t.complete};l(c?B(c._id,s,r):V(r))}}const I=async(s,t)=>{if(!s){l(b("Error: no key",!0,8));return}const r=n.find(d=>d.key===s);if(r){const d={...r,name:t};if(c)await l(B(c._id,s,d)).then(()=>{l(b("Todo updated",!1,3))}).catch(T=>{console.error(T),l(b(`${T}`,!0,8))});else{l(V(d));const T=n.map(j=>j.key===s?d:j);window.localStorage.setItem(y,JSON.stringify(T))}}},O=s=>{if(c)l(async t=>{try{await oe(c._id,s).then(()=>{t(ie(c._id))})}catch(r){console.error(r),t(b(`${r}`,!0,8))}});else try{l(de(s))}catch(t){console.error(t),l(b(`${t}`,!0,8))}finally{window.localStorage.setItem(y,JSON.stringify(n))}},h=f.useRef(null),A=s=>{var j;s.preventDefault();const t=((j=h.current)==null?void 0:j.value)??"";if(t==="")return;const r=fe(),d=n.reduce((C,$)=>$.order>C?$.order:C,0),T={key:r,name:t,complete:!1,order:d+1};c?l(me(c._id,T)):(l(F(T)),window.localStorage.setItem(y,JSON.stringify([...n,T]))),h.current&&(h.current.value="")};async function x(s){if(s.preventDefault(),window.confirm(ue[e]))if(c)await l(pe(c._id));else{l(he());const t=n.filter(r=>!r.complete);window.localStorage.setItem(y,JSON.stringify(t))}}function u(s){if(!s){l(b("Error: no key",!0,8));return}if(c!=null&&c._id)l(z(c._id,s));else{l(K(s));let t=n.filter(r=>r.key!==s);t=t.map((r,d)=>({...r,order:d+1})),l(ye(t)),window.localStorage.setItem(y,JSON.stringify(t))}}return a.jsxs(a.Fragment,{children:[a.jsx("form",{onSubmit:A,className:m.form,children:a.jsxs("fieldset",{children:[a.jsx("legend",{className:"scr",children:re[e]}),a.jsxs("div",{className:m["todo-input-area"],children:[a.jsx("label",{htmlFor:"taskinput",children:R[e]}),a.jsx("textarea",{ref:h,id:"taskinput",className:"bg",name:"task",required:!0,autoComplete:"off",placeholder:`${W[e]}...`}),a.jsx("button",{id:m["submit-todo"],type:"submit",children:R[e]}),a.jsx("button",{className:"danger",disabled:!E,onClick:s=>x(s),children:ae[e]})]})]})}),a.jsxs("div",{className:m["list-wrap"],children:[a.jsxs("p",{className:m["left-to-do"],children:[n==null?void 0:n.filter(s=>!(s!=null&&s.complete)).length," ",ce[e]]}),a.jsx(Se,{todosWithIdAndStatus:S,setTodosWithIdAndStatus:w,toggleTodo:p,deleteTodo:u,language:e,modifyTodo:I,modifyTodoOrder:O}),N==="loading"&&a.jsxs("p",{children:[le[e],"..."]})]})]})}export{Ne as default};
