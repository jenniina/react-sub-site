import{r as m,j as t}from"./react-A9DAvxly.js";import{K as je,bQ as Ne,bR as ce,bS as ie,be as re,S as Q,ba as F,bT as Z,bU as Te,bV as be,bW as Se,bX as ee,bY as fe,bZ as ve,b_ as De,b$ as ge,c0 as ke,c1 as Ce,W as w,c2 as Ee,c3 as $e,c4 as ze,c5 as Me,c6 as me,c7 as de,c8 as Fe,c9 as Ae,ca as Ye,bu as Ie,cb as ue,cc as se,cd as Oe,ce as pe,cf as Re,cg as oe,ch as Pe,ci as qe,cj as Le,ck as Je,ag as Ue,cl as he,cm as ye,cn as xe,co as _e,cp as Be,cq as Ke,cr as We,cs as He,ct as Ve,cu as Xe,cv as Ze,cw as Qe}from"./index-C3CT_j7U.js";import{W as Ge,X as es,Y as ss,F as ts,Z as rs}from"./react-icons-atCsfckx.js";import{R as as}from"./react-dom-CxfJ6lHP.js";import{a as te}from"./react-redux-C4cSaZU-.js";import{v as ns}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-CCb-kr4I.js";import"./react-router-dom-CYs6befe.js";import"./react-router-S1Hdk0kP.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./scheduler-CzFDRTuY.js";import"./use-sync-external-store-DEc9BFqZ.js";const cs="_form_1ccfz_1",is="_edit_1ccfz_63",ls="_cancel_1ccfz_75",fs="_closed_1ccfz_229",ms="_modify_1ccfz_229",ds="_select_1ccfz_427",us="_fieldset_1ccfz_481",ps="_textarea_1ccfz_499",os="_open_1ccfz_709",l={form:cs,"list-wrap":"_list-wrap_1ccfz_31","todo-input-area":"_todo-input-area_1ccfz_37","submit-todo":"_submit-todo_1ccfz_51","clear-completed":"_clear-completed_1ccfz_57","btn-wrap":"_btn-wrap_1ccfz_63",edit:is,cancel:ls,"todo-modal":"_todo-modal_1ccfz_97","todo-ul":"_todo-ul_1ccfz_109","drag-handle":"_drag-handle_1ccfz_143","modify-todo":"_modify-todo_1ccfz_229",closed:fs,delete:"_delete_1ccfz_307","left-to-do":"_left-to-do_1ccfz_331",modify:ms,"controls-wrap":"_controls-wrap_1ccfz_411",select:ds,"more-info-wrap":"_more-info-wrap_1ccfz_449",fieldset:us,textarea:ps,"deadline-inputs":"_deadline-inputs_1ccfz_513","filter-notification":"_filter-notification_1ccfz_549","category-select":"_category-select_1ccfz_649",open:os},we=Ce(6),hs=({todo:e,language:r,priorityOptions:i,categoryOptions:n,handleModify:A,sending:D,newCategory:K,newPriority:R,setNewPriority:W,setNewCategory:H,showDeadline:S,setShowDeadline:P,title:j,newName:z,setNewName:v,newDay:u,setNewDay:d,newMonth:Y,setNewMonth:g,newYear:k,setNewYear:y,setIsOpen:C})=>{const x=je(),M=f=>{v(f.target.value)},I=(f,N)=>{const p=f.target.value;p.length<=2?N(p):x(w(`${Ee[r]}: ${fe[r]}`,!0,5))},V=f=>{const N=f.target.value;Number(N)<=Number(new Date().getFullYear())+10&&N.length<=4?y(N):x(w($e[r],!0,5))};m.useEffect(()=>{S||(d(""),g(""),y(""))},[S]);const q=m.useRef(null),_=m.useRef(null);m.useEffect(()=>{var N;_.current=document.activeElement,(N=q.current)==null||N.focus();const f=p=>{var E,X;if(p.key==="Tab"){const h=(X=(E=q.current)==null?void 0:E.parentElement)==null?void 0:X.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!h||h.length===0){p.preventDefault();return}const $=h==null?void 0:h[0],J=h==null?void 0:h[h.length-1];p.shiftKey?document.activeElement===$&&(p.preventDefault(),J==null||J.focus()):document.activeElement===J&&(p.preventDefault(),$==null||$.focus())}else p.key==="Escape"&&b()};return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f),_.current?_.current.focus():document.body.focus()}},[q.current]);const b=()=>{C(!1),_.current?_.current.focus():document.body.focus()},L=Ne();return as.createPortal(t.jsx("div",{className:`${ce["modal-overlay"]} ${L?l.light:""}`,onClick:b,children:t.jsxs("div",{className:`${ce["modal-content"]} ${l["todo-modal"]}`,onClick:f=>f.stopPropagation(),role:"dialog","aria-modal":"true","aria-label":j??"Task",children:[t.jsxs("button",{ref:q,className:`${ce["close-button"]} tooltip-wrap`,onClick:b,children:[t.jsx("span",{"aria-hidden":"true",children:"×"}),t.jsx("span",{className:"scr",children:ie[r]}),t.jsx("span",{"aria-hidden":"true",className:"tooltip below left narrow2",children:ie[r]})]}),t.jsx("h2",{children:re[r]}),t.jsxs("form",{onSubmit:A,className:`${l.modify}`,children:[t.jsx(Q,{id:`category_${F(Z((e==null?void 0:e.name)??we,r))}`,className:`${l.select} ${l["category-select"]}`,value:n==null?void 0:n.find(f=>f.value===K),onChange:f=>H(f==null?void 0:f.value),options:n,instructions:Te[r],language:r,hideDelete:!0,z:3}),t.jsx(Q,{id:`priority_${F(Z((e==null?void 0:e.name)??we,r))}`,className:`${l.select}`,value:i==null?void 0:i.find(f=>f.value===R),onChange:f=>W(f==null?void 0:f.value),options:i,instructions:be[r],language:r,hideDelete:!0,z:2}),t.jsxs("fieldset",{className:l.fieldset,children:[t.jsx("legend",{children:t.jsxs("label",{children:[Se[r]," ",t.jsx("input",{style:{marginLeft:"0.5em"},type:"checkbox",checked:S,onChange:()=>P(!S)})]})}),S&&t.jsxs("div",{className:l["deadline-inputs"],children:[t.jsxs("div",{className:l.input,children:[t.jsx("label",{className:"scr",htmlFor:`day_${F(Z((e==null?void 0:e.name)??ee[r],r))}`,children:fe[r]}),t.jsx("input",{type:"number",id:`day_${F((e==null?void 0:e.name)||"Task")}`,name:"day",min:1,max:31,value:u,placeholder:"DD",onChange:f=>I(f,d),required:!0,className:"bg"})]}),t.jsxs("div",{className:l.input,children:[t.jsx("label",{className:"scr",htmlFor:`month_${F((e==null?void 0:e.name)||"Task")}`,children:ve[r]}),t.jsx("input",{type:"number",id:`month_${F(Z((e==null?void 0:e.name)??ee[r],r))}`,name:"month",value:Y,placeholder:"MM",onChange:f=>I(f,g),required:!0,className:"bg"})]}),t.jsxs("div",{className:l.input,children:[t.jsx("label",{className:"scr",htmlFor:`year_${F((e==null?void 0:e.name)||"Task")}`,children:De[r]}),t.jsx("input",{type:"number",id:`year_${F(Z((e==null?void 0:e.name)??ee[r],r))}`,name:"year",min:new Date().getFullYear(),max:new Date().getFullYear()+10,value:k,placeholder:"YYYY",onChange:f=>V(f),required:!0,className:"bg"})]})]})]}),t.jsxs("fieldset",{className:`${l.fieldset} ${l.textarea}`,children:[t.jsx("legend",{children:re[r]}),t.jsxs("label",{children:[t.jsx("textarea",{id:`task_${F(e==null?void 0:e.name)}`,required:!0,name:"task",rows:4,value:z,onChange:M}),t.jsxs("span",{className:"scr",children:[re[r]," ",Z((e==null?void 0:e.name)??ee[r],r)]})]})]}),t.jsxs("button",{type:"submit",disabled:D,className:"modify",children:[ge[r]," ",t.jsx(Ge,{})]}),t.jsxs("button",{onClick:b,className:`reset ${l.cancel}`,type:"button",children:[ke[r]," ",t.jsx(es,{})]})]})]})}),document.getElementById("modal-root"))};function ys({todo:e,toggleTodo:r,deleteTodo:i,language:n,modifyTodo:A,isDragging:D,handleUpdate:K,handleDragging:R,sending:W,priorityOptions:H,categoryOptions:S,zin:P}){const[j,z]=m.useState((e==null?void 0:e.name)??""),[v,u]=m.useState(!1),[d,Y]=m.useState((e==null?void 0:e.priority)||"low"),[g,k]=m.useState(e!=null&&e.deadline?new Date(e.deadline).getDate().toString().padStart(2,"0"):""),[y,C]=m.useState(e!=null&&e.deadline?(new Date(e.deadline).getMonth()+1).toString().padStart(2,"0"):""),[x,M]=m.useState(e!=null&&e.deadline?new Date(e.deadline).getFullYear().toString():""),I=g&&y&&x?`${x}-${y}-${g}`:"",[V,q]=m.useState((e==null?void 0:e.category)||"other"),[_,b]=m.useState(!1);function L(){r(e==null?void 0:e.key)}function f(){window.confirm(Ae[n]+' "'+(e==null?void 0:e.name)+'"?')&&(z(""),i(e==null?void 0:e.key),b(!1))}const N=a=>{a.preventDefault(),A(e==null?void 0:e.key,j,d,I,V),b(!1)};m.useEffect(()=>{if((e==null?void 0:e.name)!==j&&z((e==null?void 0:e.name)||""),e!=null&&e.deadline){const a=new Date(e.deadline);k(a.getDate().toString().padStart(2,"0")),C((a.getMonth()+1).toString().padStart(2,"0")),M(a.getFullYear().toString())}},[e]);const[p,E]=m.useState(!0),[X,h]=m.useState(!1),$=()=>{E(!0),h(!1)},J=()=>{E(!0)},ae=()=>{E(!1)},ne=()=>{E(!1),h(!0)},s=()=>{var a;(a=window.getSelection())!=null&&a.toString()?(E(!1),h(!0)):(E(!0),h(!1))},c=a=>{X&&a.preventDefault()};return t.jsx(t.Fragment,{children:t.jsxs("li",{style:{zIndex:`calc(${P} - ${e==null?void 0:e.order})`},className:`${D?"dragging":""} ${_?l.open:l.closed}`,draggable:p,onDragStart:a=>{var o;p?(a.dataTransfer.setData("application/my-app",(o=e==null?void 0:e.order)==null?void 0:o.toString()),R(!0)):a.preventDefault()},onDragEnd:()=>R(!1),children:[t.jsxs("span",{onMouseOver:J,onMouseDown:$,className:`${l["drag-handle"]} tooltip-wrap`,children:[t.jsx(ss,{}),t.jsx("span",{className:"tooltip narrow2 below right",children:ze[n]})]}),t.jsxs("label",{onClick:c,children:[t.jsx("input",{type:"checkbox",id:`check_${F(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:L}),t.jsx("span",{onMouseOver:ae,onMouseDown:ne,onMouseUp:s,children:e==null?void 0:e.name})]}),t.jsxs("div",{className:`${l["more-info-wrap"]}`,children:[(e==null?void 0:e.category)&&t.jsxs("span",{children:[Me[n],": ",me(de,e==null?void 0:e.category,n)]}),(e==null?void 0:e.priority)&&(e==null?void 0:e.category)&&t.jsx("span",{"aria-hidden":"true",children:" | "}),(e==null?void 0:e.priority)&&t.jsxs("span",{children:[be[n],": ",me(de,e==null?void 0:e.priority,n)]}),(e==null?void 0:e.deadline)&&(e==null?void 0:e.deadline)!==""&&(e==null?void 0:e.priority)&&t.jsx("span",{"aria-hidden":"true",children:" | "}),(e==null?void 0:e.deadline)&&(e==null?void 0:e.deadline)!==""&&t.jsxs("span",{children:[Se[n],":"," ",new Date(e.deadline).toLocaleDateString(n,{year:"numeric",month:"long",day:"numeric"})]})]}),t.jsxs("div",{className:`${l["btn-wrap"]}`,children:[t.jsx("button",{onClick:()=>b(!0),className:`${l.edit} tooltip-wrap`,disabled:(e==null?void 0:e.complete)??!1,children:re[n]}),t.jsxs("button",{className:`${l.delete} tooltip-wrap`,onClick:_?()=>b(!1):f,children:[t.jsx("span",{"aria-hidden":"true",children:_?t.jsx(ts,{style:{fontSize:"0.8em"}}):t.jsx(t.Fragment,{children:"×"})}),t.jsx("span",{className:"tooltip below left narrow2",children:_?ie[n]:Fe[n]})]})]}),_&&t.jsx(hs,{title:e==null?void 0:e.name,language:n,handleModify:N,newName:j,setNewName:z,newPriority:d,setNewPriority:Y,newDay:g,setNewDay:k,newMonth:y,setNewMonth:C,newYear:x,setNewYear:M,newCategory:V,setNewCategory:q,priorityOptions:H,categoryOptions:S,showDeadline:v,setShowDeadline:u,sending:W,todo:e,setIsOpen:b})]})})}function xs({toggleTodo:e,deleteTodo:r,language:i,modifyTodo:n,modifyTodoOrder:A,todosWithIdAndStatus:D,sending:K,priorityOptions:R,categoryOptions:W}){var z,v;const{isDragging:H,listItemsByStatus:S,handleUpdate:P,handleDragging:j}=Ye(D,["todos"]);return t.jsx("ul",{className:`${l["todo-ul"]} todo-ul`,onDragOver:u=>u.preventDefault(),onDrop:u=>{var y;u.preventDefault();const d=u.dataTransfer.getData("application/my-app"),Y=(y=Array.from(u.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:y.reduce((C,x)=>{const M=x.getBoundingClientRect(),I=Math.abs(M.top-u.clientY);return I<C.offset?{offset:I,element:x}:C},{offset:Number.POSITIVE_INFINITY}),g=Array.from(u.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(Y.element);if(Number(d)===g)return;const k=P(Number(d),"todos",g);if(Array.isArray(k)){const C=k==null?void 0:k.map((x,M)=>({key:x.key,order:M}));A(C)}else console.error("Order is not an array");j(!1)},children:(v=(z=S.todos)==null?void 0:z.items)==null?void 0:v.slice().sort((u,d)=>u.order??0>(d.order??0)?1:-1).sort((u,d)=>u.complete===d.complete?0:u.complete?1:-1).map(u=>{var d;return t.jsx(ys,{sending:K,toggleTodo:e,deleteTodo:r,todo:D==null?void 0:D.find(Y=>Y.key===u.key),language:i,modifyTodo:n,isDragging:H,handleUpdate:P,handleDragging:j,priorityOptions:R,categoryOptions:W,zin:(d=S.todos)==null?void 0:d.items.length},u==null?void 0:u.key)})})}function Is({language:e}){const r=je(),i=te(s=>{var c;return(c=s.auth)==null?void 0:c.user});m.useEffect(()=>{r(Ie())},[]);const n=te(s=>s.todos.todos),A=te(s=>s.todos.status),D=te(s=>s.todos.error),[K,R]=m.useState("low"),[W,H]=m.useState(""),[S,P]=m.useState("other"),[j,z]=m.useState("all"),[v,u]=m.useState("all"),d="ReactTodos",Y=n==null?void 0:n.some(s=>s.complete);m.useEffect(()=>{if(n.length===0&&!i){const s=JSON.parse(window.localStorage.getItem(d)||"[]"),c=new Set(n.map(a=>a.key));s.forEach(a=>{c.has(a.key)||r(ue(a))})}},[r,n,i]),m.useEffect(()=>{window.localStorage.setItem(d,JSON.stringify(n))},[n]);const g=s=>{const c=new Set,a=[];return s.forEach(o=>{c.has(o.key)?a.push(o):c.add(o.key)}),a},k=s=>{if(!s){r(w("Error: no key",!0,8));return}if(i!=null&&i._id)r(he(i._id,s));else{r(ye(s));const c=n.filter(a=>a.key!==s);window.localStorage.setItem(d,JSON.stringify(c))}};m.useEffect(()=>{const s=g(n),c=new Set;s.forEach(a=>{c.has(a.key)||(k(a.key),c.add(a.key))})},[n]);const[y,C]=m.useState([]),x=n.filter(s=>{const c=j==="all"||s.priority===j,a=v==="all"||s.category===v;return c&&a});m.useEffect(()=>{const s=x==null?void 0:x.slice().sort((c,a)=>(c.order??0)-(a.order??0)).map(c=>({...c,id:c.order,status:"todos"}));C(s)},[n,j,v]);const M=["all","low","medium","high"],I=["all","work","personal","shopping","other"],V=["low","medium","high"],q=["work","personal","shopping","other"],_=se(M,e),b=se(I,e),L=se(V,e),f=se(q,e);m.useEffect(()=>{A==="failed"&&r(w(`There was an error: ${D}`,!0,8))},[A,D,r]);const[N,p]=m.useState(!1);m.useEffect(()=>{i!=null&&i._id&&r(Oe(i._id)).then(()=>{r(pe(i._id))}).catch(s=>{var c,a;console.error(s),(a=(c=s.response)==null?void 0:c.data)!=null&&a.message?r(w(s.response.data.message,!0,8)):r(w(`${s.message}`,!0,8))})},[i==null?void 0:i._id]);function E(s){const c=n.find(a=>a.key===s);if(c){const a={...c,complete:!c.complete};r(i?xe(i._id,s,a):_e(a))}}const X=async(s,c,a,o,U)=>{if(p(!0),!s){r(w("Error: no key",!0,8)),p(!1);return}const B=n.find(T=>T.key===s);if(B){const T={...B,name:c,priority:a,deadline:o,category:U};if(i)await r(xe(i._id,s,T)).then(()=>{r(w(`${Be[e]}`,!1,3)),p(!1)}).catch(O=>{var G,le;console.error(O),(le=(G=O.response)==null?void 0:G.data)!=null&&le.message?r(w(O.response.data.message,!0,8)):r(w(`${O}`,!0,8)),p(!1)});else{r(_e(T));const O=n.map(G=>G.key===s?T:G);window.localStorage.setItem(d,JSON.stringify(O)),p(!1)}}},h=s=>{var c,a;if(i)r(async o=>{var U,B;try{await Ke(i._id,s).then(()=>{o(pe(i._id))})}catch(T){console.error(T),(B=(U=T.response)==null?void 0:U.data)!=null&&B.message?o(w(T.response.data.message,!0,8)):o(w(`${T}`,!0,8))}});else try{r(We(s))}catch(o){console.error(o),(a=(c=o.response)==null?void 0:c.data)!=null&&a.message?r(w(o.response.data.message,!0,8)):r(w(`${o}`,!0,8))}finally{window.localStorage.setItem(d,JSON.stringify(n))}},$=m.useRef(null),J=s=>{var B;s.preventDefault(),p(!0);const c=((B=$.current)==null?void 0:B.value)??"";if(c===""){p(!1);return}const a=ns(),o=n.reduce((T,O)=>O.order>T?O.order:T,0),U={key:a,name:c,complete:!1,order:o+1,priority:K,deadline:W,category:S};i?(r(He(i._id,U)),p(!1)):(r(ue(U)),window.localStorage.setItem(d,JSON.stringify([...n,U])),p(!1)),$.current&&($.current.value="")};async function ae(s){if(s.preventDefault(),window.confirm(Ve[e]))if(i)await r(Xe(i._id));else{r(Ze());const c=n.filter(a=>!a.complete);window.localStorage.setItem(d,JSON.stringify(c))}}function ne(s){if(!s){r(w("Error: no key",!0,8));return}if(i!=null&&i._id)r(he(i._id,s));else{r(ye(s));let c=n.filter(a=>a.key!==s);c=c.map((a,o)=>({...a,order:o+1})),r(Qe(c)),window.localStorage.setItem(d,JSON.stringify(c))}}return t.jsxs(t.Fragment,{children:[t.jsx("form",{onSubmit:J,className:l.form,children:t.jsxs("fieldset",{children:[t.jsx("legend",{className:"scr",children:Re[e]}),t.jsxs("div",{className:l["todo-input-area"],children:[t.jsx("label",{htmlFor:"taskinput",children:oe[e]}),t.jsx("textarea",{ref:$,id:"taskinput",className:"bg",rows:3,name:"task",required:!0,autoComplete:"off",placeholder:`${ee[e]}...`}),t.jsx(Q,{z:y.length+5,id:"category",className:`${l.select} ${l["category-select"]}`,hideDelete:!0,instructions:"Select category",value:f.find(s=>s.value===S)||f[0],onChange:s=>P(s==null?void 0:s.value),options:f,language:e}),t.jsx(Q,{id:"priority",className:l.select,hideDelete:!0,instructions:"Select priority",value:L.find(s=>s.value===K)||L[0],onChange:s=>R(s==null?void 0:s.value),options:L,language:e,z:y.length+4}),t.jsxs("button",{id:l["submit-todo"],className:l["submit-todo"],type:"submit",disabled:N,children:[oe[e]," ",t.jsx(rs,{})]})]})]})}),t.jsxs("div",{className:l["controls-wrap"],children:[t.jsx(Q,{id:"category-filter",className:`${l.select} ${l["category-select"]}`,hideDelete:!0,instructions:"Filter by category",value:b.find(s=>s.value===v)||b[0],onChange:s=>u(s==null?void 0:s.value),options:b,language:e,z:y.length+3}),t.jsx(Q,{id:"priority-filter",className:l.select,hideDelete:!0,instructions:"Filter by priority",value:_.find(s=>s.value===j)||_[0],onChange:s=>z(s==null?void 0:s.value),options:_,language:e,z:y.length+2}),t.jsx("button",{className:`danger ${l["clear-completed"]}`,disabled:!Y,onClick:s=>ae(s),children:Pe[e]})]}),t.jsxs("div",{className:l["list-wrap"],children:[t.jsxs("p",{className:l["left-to-do"],children:[n==null?void 0:n.filter(s=>!(s!=null&&s.complete)).length," ",qe[e]]}),(j!=="all"||v!=="all")&&t.jsxs("p",{className:l["filter-notification"],children:[Le[e]," ",Je[e]]}),t.jsx(xs,{sending:N,todosWithIdAndStatus:y,toggleTodo:E,deleteTodo:ne,language:e,modifyTodo:X,modifyTodoOrder:h,priorityOptions:L,categoryOptions:f}),A==="loading"&&t.jsxs("p",{className:"flex center margin0auto textcenter",children:[Ue[e],"..."]})]})]})}export{Is as default};
