import{r as u,j as s}from"./react-A9DAvxly.js";import{bQ as Ee,bR as $e,bS as ie,bT as c,bU as le,be as ce,S as se,ba as P,bV as G,bW as Ne,bX as De,bY as ve,bZ as ee,b_ as me,b$ as ue,c0 as Ce,c1 as ke,c2 as ge,c3 as Fe,c4 as fe,c5 as Me,c6 as _e,c7 as Ae,c8 as de,c9 as pe,ca as Ie,cb as Oe,cc as Ye,K as Pe,bu as Re,cd as he,ce as ae,W as C,cf as ze,cg as oe,ch as qe,ci as ye,cj as Be,ck as Le,cl as Je,cm as Ue,cn as Ke,co as He,cp as We,ag as Ve,cq as xe,cr as je,cs as Se,ct as Te,cu as Xe,cv as Ze,cw as Qe,cx as Ge,cy as be,cz as es,cA as ss,cB as rs}from"./index-BU3I52F2.js";import{W as ts,X as as,Y as ns,F as is,Z as ls}from"./react-icons-atCsfckx.js";import{R as cs}from"./react-dom-CxfJ6lHP.js";import{a as ne}from"./react-redux-C4cSaZU-.js";import{v as ms}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-CCb-kr4I.js";import"./react-router-dom-CYs6befe.js";import"./react-router-S1Hdk0kP.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./scheduler-CzFDRTuY.js";import"./use-sync-external-store-DEc9BFqZ.js";const we=Fe(6),us=({todo:e,language:t,priorityOptions:m,categoryOptions:i,handleModify:R,sending:M,newCategory:z,newPriority:L,setNewPriority:J,setNewCategory:X,showDeadline:S,setShowDeadline:U,title:T,newName:O,setNewName:k,newDay:f,setNewDay:d,newMonth:N,setNewMonth:g,newYear:x,setNewYear:y,setIsOpen:_})=>{const[j,o]=u.useState(null),K=n=>{k(n.target.value)},Z=n=>{Number(n)<=31&&n.length<=2?(d(n),o(null)):o(`${fe[t]}: ${me[t]}`)},re=n=>{Number(n)<=12&&n.length<=2?(g(n),o(null)):o(`${fe[t]}: ${ue[t]}`)},A=n=>{const h=n.target.value;Number(h)<=Number(new Date().getFullYear())+10&&h.length<=4?(y(h),o(null)):o(Me[t])};u.useEffect(()=>{if(f&&N&&x){const n=new Date(Number(x),Number(N)-1,Number(f)),h=new Date;h.setHours(0,0,0,0),o(null),n<h&&o(Ee[t])}},[f,N,x,t]),u.useEffect(()=>{S?(f||d((new Date().getDate()+1).toString().padStart(2,"0")),N||g((new Date().getMonth()+1).toString().padStart(2,"0")),x||y(new Date().getFullYear().toString())):(d(""),g(""),y(""))},[S]);const b=u.useRef(null),F=u.useRef(null);u.useEffect(()=>{var h;F.current=document.activeElement,(h=b.current)==null||h.focus();const n=Y=>{var q,B;if(Y.key==="Tab"){const D=(B=(q=b.current)==null?void 0:q.parentElement)==null?void 0:B.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!D||D.length===0){Y.preventDefault();return}const H=D==null?void 0:D[0],W=D==null?void 0:D[D.length-1];Y.shiftKey?document.activeElement===H&&(Y.preventDefault(),W==null||W.focus()):document.activeElement===W&&(Y.preventDefault(),H==null||H.focus())}else Y.key==="Escape"&&I()};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n),F.current?F.current.focus():document.body.focus()}},[b.current]);const I=()=>{_(!1),F.current?F.current.focus():document.body.focus()},Q=$e();return cs.createPortal(s.jsx("div",{className:`${ie["modal-overlay"]} ${Q?c.light:""}`,onClick:I,children:s.jsxs("div",{className:`${ie["modal-content"]} ${c["todo-modal"]}`,onClick:n=>n.stopPropagation(),role:"dialog","aria-modal":"true","aria-label":T??"Task",children:[s.jsxs("button",{ref:b,className:`${ie["close-button"]} tooltip-wrap`,onClick:I,children:[s.jsx("span",{"aria-hidden":"true",children:"×"}),s.jsx("span",{className:"scr",children:le[t]}),s.jsx("span",{"aria-hidden":"true",className:"tooltip below left narrow2",children:le[t]})]}),s.jsx("h2",{children:ce[t]}),s.jsxs("form",{onSubmit:R,className:`${c.modify}`,children:[s.jsx(se,{id:`category_${P(G((e==null?void 0:e.name)??we,t))}`,className:`${c.select} ${c["category-select"]}`,value:i==null?void 0:i.find(n=>n.value===z),onChange:n=>X(n==null?void 0:n.value),options:i,instructions:Ne[t],language:t,hideDelete:!0,z:3}),s.jsx(se,{id:`priority_${P(G((e==null?void 0:e.name)??we,t))}`,className:`${c.select}`,value:m==null?void 0:m.find(n=>n.value===L),onChange:n=>J(n==null?void 0:n.value),options:m,instructions:De[t],language:t,hideDelete:!0,z:2}),s.jsxs("fieldset",{className:`${c.fieldset} ${c["deadline-wrap"]}`,children:[s.jsx("legend",{children:s.jsxs("label",{children:[ve[t]," ",s.jsx("input",{style:{marginLeft:"0.5em"},type:"checkbox",checked:S,onChange:()=>U(!S)})]})}),S&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:c["deadline-inputs"],children:[s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`day_${P(G((e==null?void 0:e.name)??ee[t],t))}`,children:me[t]}),s.jsx("input",{type:"number",id:`day_${P((e==null?void 0:e.name)||"Task")}`,name:"day",min:1,max:31,value:f,placeholder:"DD",onChange:n=>Z(n.target.value),required:!0,className:"bg"})]}),s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`month_${P((e==null?void 0:e.name)||"Task")}`,children:ue[t]}),s.jsx("input",{type:"number",id:`month_${P(G((e==null?void 0:e.name)??ee[t],t))}`,name:"month",min:1,max:12,value:N,placeholder:"MM",onChange:n=>re(n.target.value),required:!0,className:"bg"})]}),s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`year_${P((e==null?void 0:e.name)||"Task")}`,children:Ce[t]}),s.jsx("input",{type:"number",id:`year_${P(G((e==null?void 0:e.name)??ee[t],t))}`,name:"year",min:new Date().getFullYear(),max:new Date().getFullYear()+10,value:x,placeholder:"YYYY",onChange:n=>A(n),required:!0,className:"bg"})]})]})," ",j&&s.jsx("p",{className:c.error,children:j})]})]}),s.jsxs("fieldset",{className:`${c.fieldset} ${c.textarea}`,children:[s.jsx("legend",{children:ee[t]}),s.jsxs("label",{children:[s.jsx("textarea",{id:`task_${P(e==null?void 0:e.name)}`,required:!0,name:"task",rows:4,value:O,onChange:K}),s.jsxs("span",{className:"scr",children:[ce[t]," ",G((e==null?void 0:e.name)??ee[t],t)]})]})]}),s.jsxs("button",{type:"submit",disabled:M,className:"modify",children:[ke[t]," ",s.jsx(ts,{})]}),s.jsxs("button",{onClick:I,className:`reset ${c.cancel}`,type:"button",children:[ge[t]," ",s.jsx(as,{})]})]})]})}),document.getElementById("modal-root"))};function fs({todo:e,toggleTodo:t,deleteTodo:m,language:i,modifyTodo:R,isDragging:M,handleUpdate:z,handleDragging:L,sending:J,priorityOptions:X,categoryOptions:S,zin:U}){const[T,O]=u.useState((e==null?void 0:e.name)??""),[k,f]=u.useState(!1),[d,N]=u.useState((e==null?void 0:e.priority)||"low"),[g,x]=u.useState(e!=null&&e.deadline?new Date(e.deadline).getDate().toString().padStart(2,"0"):""),[y,_]=u.useState(e!=null&&e.deadline?(new Date(e.deadline).getMonth()+1).toString().padStart(2,"0"):""),[j,o]=u.useState(e!=null&&e.deadline?new Date(e.deadline).getFullYear().toString():""),K=g&&y&&j?`${j}-${y}-${g}`:"",[Z,re]=u.useState((e==null?void 0:e.category)||"other"),[A,b]=u.useState(!1);function F(){t(e==null?void 0:e.key)}function I(){window.confirm(Oe[i]+' "'+(e==null?void 0:e.name)+'"?')&&(O(""),m(e==null?void 0:e.key),b(!1))}const Q=a=>{a.preventDefault(),R(e==null?void 0:e.key,T,d,K,Z),b(!1)};u.useEffect(()=>{e!=null&&e.deadline&&f(!0)},[e]),u.useEffect(()=>{if((e==null?void 0:e.name)!==T&&O((e==null?void 0:e.name)||""),e!=null&&e.deadline){const a=new Date(e.deadline);x(a.getDate().toString().padStart(2,"0")),_((a.getMonth()+1).toString().padStart(2,"0")),o(a.getFullYear().toString())}},[e]);const[n,h]=u.useState(!0),[Y,q]=u.useState(!1),B=()=>{h(!0),q(!1)},D=()=>{h(!0)},H=()=>{h(!1)},W=()=>{h(!1),q(!0)},r=()=>{var a;(a=window.getSelection())!=null&&a.toString()?(h(!1),q(!0)):(h(!0),q(!1))},l=a=>{Y&&a.preventDefault()};return s.jsx(s.Fragment,{children:s.jsxs("li",{style:{zIndex:`calc(${U} - ${e==null?void 0:e.order})`},className:`${M?"dragging":""} ${A?c.open:c.closed}`,draggable:n,onDragStart:a=>{var p;n?(a.dataTransfer.setData("application/my-app",(p=e==null?void 0:e.order)==null?void 0:p.toString()),L(!0)):a.preventDefault()},onDragEnd:()=>L(!1),children:[s.jsxs("span",{onMouseOver:D,onMouseDown:B,className:`${c["drag-handle"]} tooltip-wrap`,children:[s.jsx(ns,{}),s.jsx("span",{className:"tooltip narrow2 below right",children:_e[i]})]}),s.jsxs("label",{onClick:l,children:[s.jsx("input",{type:"checkbox",id:`check_${P(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:F}),s.jsx("span",{onMouseOver:H,onMouseDown:W,onMouseUp:r,children:e==null?void 0:e.name}),s.jsxs("div",{className:`${c["more-info-wrap"]}`,children:[(e==null?void 0:e.category)&&s.jsxs("span",{children:[Ae[i],":"," ",de(pe,e==null?void 0:e.category,i)]}),(e==null?void 0:e.priority)&&(e==null?void 0:e.category)&&s.jsx("span",{"aria-hidden":"true",children:" | "}),(e==null?void 0:e.priority)&&s.jsxs("span",{children:[De[i],":"," ",de(pe,e==null?void 0:e.priority,i)]}),(e==null?void 0:e.deadline)&&(e==null?void 0:e.deadline)!==""&&(e==null?void 0:e.priority)&&s.jsx("span",{"aria-hidden":"true",children:" | "}),(e==null?void 0:e.deadline)&&(e==null?void 0:e.deadline)!==""&&(()=>{const a=new Date(e.deadline),p=new Date;a.setHours(0,0,0,0),p.setHours(0,0,0,0);const V=a<p,v=a.getTime()===p.getTime();return s.jsxs("span",{className:`${c.deadline} ${V?c.overdue:""} ${v?c.today:""}`,children:[ve[i],":"," ",new Date(e.deadline).toLocaleDateString(i,{year:"numeric",month:"long",day:"numeric"})]})})()]})]}),s.jsxs("div",{className:`${c["btn-wrap"]}`,children:[s.jsx("button",{onClick:()=>b(!0),className:`${c.edit} tooltip-wrap`,disabled:(e==null?void 0:e.complete)??!1,children:ce[i]}),s.jsxs("button",{className:`${c.delete} tooltip-wrap`,onClick:A?()=>b(!1):I,children:[s.jsx("span",{"aria-hidden":"true",children:A?s.jsx(is,{style:{fontSize:"0.8em"}}):s.jsx(s.Fragment,{children:"×"})}),s.jsx("span",{className:"tooltip below left narrow2",children:A?le[i]:Ie[i]})]})]}),A&&s.jsx(us,{title:e==null?void 0:e.name,language:i,handleModify:Q,newName:T,setNewName:O,newPriority:d,setNewPriority:N,newDay:g,setNewDay:x,newMonth:y,setNewMonth:_,newYear:j,setNewYear:o,newCategory:Z,setNewCategory:re,priorityOptions:X,categoryOptions:S,showDeadline:k,setShowDeadline:f,sending:J,todo:e,setIsOpen:b})]})})}function ds({toggleTodo:e,deleteTodo:t,language:m,modifyTodo:i,modifyTodoOrder:R,todosWithIdAndStatus:M,sending:z,priorityOptions:L,categoryOptions:J}){var O,k;const{isDragging:X,listItemsByStatus:S,handleUpdate:U,handleDragging:T}=Ye(M,["todos"]);return s.jsx("ul",{className:`${c["todo-ul"]} todo-ul`,onDragOver:f=>f.preventDefault(),onDrop:f=>{var y;f.preventDefault();const d=f.dataTransfer.getData("application/my-app"),N=(y=Array.from(f.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:y.reduce((_,j)=>{const o=j.getBoundingClientRect(),K=Math.abs(o.top-f.clientY);return K<_.offset?{offset:K,element:j}:_},{offset:Number.POSITIVE_INFINITY}),g=Array.from(f.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(N.element);if(Number(d)===g)return;const x=U(Number(d),"todos",g);if(Array.isArray(x)){const _=x==null?void 0:x.map((j,o)=>({key:j.key,order:o}));R(_)}else console.error("Order is not an array");T(!1)},children:(k=(O=S.todos)==null?void 0:O.items)==null?void 0:k.slice().sort((f,d)=>f.order??0>(d.order??0)?1:-1).sort((f,d)=>f.complete===d.complete?0:f.complete?1:-1).map(f=>{var d;return s.jsx(fs,{sending:z,toggleTodo:e,deleteTodo:t,todo:M==null?void 0:M.find(N=>N.key===f.key),language:m,modifyTodo:i,isDragging:X,handleUpdate:U,handleDragging:T,priorityOptions:L,categoryOptions:J,zin:(d=S.todos)==null?void 0:d.items.length},f==null?void 0:f.key)})})}function Ms({language:e}){const t=Pe(),m=ne(r=>{var l;return(l=r.auth)==null?void 0:l.user});u.useEffect(()=>{t(Re())},[]);const i=ne(r=>r.todos.todos),R=ne(r=>r.todos.status),M=ne(r=>r.todos.error),[z,L]=u.useState("low"),[J,X]=u.useState(""),[S,U]=u.useState("other"),[T,O]=u.useState("all"),[k,f]=u.useState("all"),d="ReactTodos",N=i==null?void 0:i.some(r=>r.complete);u.useEffect(()=>{if(i.length===0&&!m){const r=JSON.parse(window.localStorage.getItem(d)||"[]"),l=new Set(i.map(a=>a.key));r.forEach(a=>{l.has(a.key)||t(he(a))})}},[t,i,m]),u.useEffect(()=>{window.localStorage.setItem(d,JSON.stringify(i))},[i]);const g=r=>{const l=new Set,a=[];return r.forEach(p=>{l.has(p.key)?a.push(p):l.add(p.key)}),a},x=r=>{if(!r){t(C("Error: no key",!0,8));return}if(m!=null&&m._id)t(xe(m._id,r));else{t(je(r));const l=i.filter(a=>a.key!==r);window.localStorage.setItem(d,JSON.stringify(l))}};u.useEffect(()=>{const r=g(i),l=new Set;r.forEach(a=>{l.has(a.key)||(x(a.key),l.add(a.key))})},[i]);const[y,_]=u.useState([]),j=i.filter(r=>{const l=T==="all"||r.priority===T,a=k==="all"||r.category===k;return l&&a});u.useEffect(()=>{const r=j==null?void 0:j.slice().sort((l,a)=>(l.order??0)-(a.order??0)).map(l=>({...l,id:l.order,status:"todos"}));_(r)},[i,T,k]);const o=["all","low","medium","high"],K=["all","work","personal","shopping","other"],Z=["low","medium","high"],re=["work","personal","shopping","other"],A=ae(o,e),b=ae(K,e),F=ae(Z,e),I=ae(re,e);u.useEffect(()=>{R==="failed"&&t(C(`There was an error: ${M}`,!0,8))},[R,M,t]);const[Q,n]=u.useState(!1);u.useEffect(()=>{m!=null&&m._id&&t(ze(m._id)).then(()=>{t(oe(m._id))}).catch(r=>{var l,a;console.error(r),(a=(l=r.response)==null?void 0:l.data)!=null&&a.message?t(C(r.response.data.message,!0,8)):t(C(`${r.message}`,!0,8))})},[m==null?void 0:m._id]);function h(r){const l=i.find(a=>a.key===r);if(l){const a={...l,complete:!l.complete};t(m?Se(m._id,r,a):Te(a))}}const Y=async(r,l,a,p,V)=>{if(n(!0),!r){t(C("Error: no key",!0,8)),n(!1);return}const v=i.find(E=>E.key===r);if(v){const E={...v,name:l,priority:a,deadline:p,category:V};if(m)await t(Se(m._id,r,E)).then(()=>{t(C(`${Xe[e]}`,!1,3)),n(!1)}).catch(w=>{var $,te;console.error(w),(te=($=w.response)==null?void 0:$.data)!=null&&te.message?t(C(w.response.data.message,!0,8)):t(C(`${w}`,!0,8)),n(!1)});else{t(Te(E));const w=i.map($=>$.key===r?E:$);window.localStorage.setItem(d,JSON.stringify(w)),n(!1)}}},q=r=>{var l,a;if(m)t(async p=>{var V,v;try{await Ze(m._id,r).then(()=>{p(oe(m._id))})}catch(E){console.error(E),(v=(V=E.response)==null?void 0:V.data)!=null&&v.message?p(C(E.response.data.message,!0,8)):p(C(`${E}`,!0,8))}});else try{t(Qe(r))}catch(p){console.error(p),(a=(l=p.response)==null?void 0:l.data)!=null&&a.message?t(C(p.response.data.message,!0,8)):t(C(`${p}`,!0,8))}finally{window.localStorage.setItem(d,JSON.stringify(i))}},B=u.useRef(null),D=r=>{var E;r.preventDefault(),n(!0);const l=((E=B.current)==null?void 0:E.value)??"";if(l===""){n(!1);return}const a=ms(),p=i.reduce((w,$)=>$.order>w?$.order:w,0),V=i.reduce((w,$)=>$.order<w?$.order:w,0);let v;if(z==="high"?v={key:a,name:l,complete:!1,order:V-1,priority:z,deadline:J,category:S}:v={key:a,name:l,complete:!1,order:p+1,priority:z,deadline:J,category:S},m)t(Ge(m._id,v)),n(!1);else{t(he(v)),window.localStorage.setItem(d,JSON.stringify([...i,v]));const w=i.map(($,te)=>({...$,order:te+1}));t(be(w)),n(!1)}B.current&&(B.current.value="")};async function H(r){if(r.preventDefault(),window.confirm(es[e]))if(m)await t(ss(m._id));else{t(rs());const l=i.filter(a=>!a.complete);window.localStorage.setItem(d,JSON.stringify(l))}}function W(r){if(!r){t(C("Error: no key",!0,8));return}if(m!=null&&m._id)t(xe(m._id,r));else{t(je(r));let l=i.filter(a=>a.key!==r);l=l.map((a,p)=>({...a,order:p+1})),t(be(l)),window.localStorage.setItem(d,JSON.stringify(l))}}return s.jsxs(s.Fragment,{children:[s.jsx("form",{onSubmit:D,className:c.form,children:s.jsxs("fieldset",{children:[s.jsx("legend",{className:"scr",children:qe[e]}),s.jsxs("div",{className:c["todo-input-area"],children:[s.jsx("label",{htmlFor:"taskinput",children:ye[e]}),s.jsx("textarea",{ref:B,id:"taskinput",className:"bg",rows:3,name:"task",required:!0,autoComplete:"off",placeholder:`${ee[e]}...`}),s.jsx(se,{z:y.length+5,id:"category",className:`${c.select} ${c["category-select"]}`,hideDelete:!0,instructions:Ne[e],value:I.find(r=>r.value===S)||I[0],onChange:r=>U(r==null?void 0:r.value),options:I,language:e}),s.jsx(se,{id:"priority",className:c.select,hideDelete:!0,instructions:Be[e],value:F.find(r=>r.value===z)||F[0],onChange:r=>L(r==null?void 0:r.value),options:F,language:e,z:y.length+4}),s.jsxs("button",{id:c["submit-todo"],className:c["submit-todo"],type:"submit",disabled:Q,children:[ye[e]," ",s.jsx(ls,{})]})]})]})}),s.jsxs("div",{className:c["controls-wrap"],children:[s.jsx(se,{id:"category-filter",className:`${c.select} ${c["category-select"]}`,hideDelete:!0,instructions:Le[e],value:b.find(r=>r.value===k)||b[0],onChange:r=>f(r==null?void 0:r.value),options:b,language:e,z:y.length+3}),s.jsx(se,{id:"priority-filter",className:c.select,hideDelete:!0,instructions:Je[e],value:A.find(r=>r.value===T)||A[0],onChange:r=>O(r==null?void 0:r.value),options:A,language:e,z:y.length+2}),s.jsx("button",{className:`danger ${c["clear-completed"]}`,disabled:!N,onClick:r=>H(r),children:Ue[e]})]}),s.jsxs("div",{className:c["list-wrap"],children:[s.jsxs("p",{className:c["left-to-do"],children:[i==null?void 0:i.filter(r=>!(r!=null&&r.complete)).length," ",Ke[e]]}),(T!=="all"||k!=="all")&&s.jsxs("p",{className:c["filter-notification"],children:[He[e]," ",We[e]]}),s.jsx(ds,{sending:Q,todosWithIdAndStatus:y,toggleTodo:h,deleteTodo:W,language:e,modifyTodo:Y,modifyTodoOrder:q,priorityOptions:F,categoryOptions:I}),R==="loading"&&s.jsxs("p",{className:"flex center margin0auto textcenter",children:[Ve[e],"..."]})]})]})}export{Ms as default};
