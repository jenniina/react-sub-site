import{r as u,j as s}from"./react-A9DAvxly.js";import{bQ as ve,bR as Ee,bS as ie,bT as c,bU as ce,be as me,S as re,ba as P,bV as ee,bW as we,bX as Ne,bY as De,bZ as se,b_ as ue,b$ as fe,c0 as $e,c1 as Ce,c2 as ke,c3 as ge,c4 as de,c5 as Fe,c6 as Me,c7 as _e,c8 as pe,c9 as he,ca as Ae,cb as Ie,cc as Oe,K as Ye,bu as Pe,cd as Re,ce as ae,W as $,cf as ze,cg as oe,ch as qe,ci as ye,cj as Be,ck as Le,cl as Je,cm as Ue,cn as Ke,co as He,cp as We,ag as Ve,cq as xe,cr as je,cs as Se,ct as Te,cu as Xe,cv as Ze,cw as Qe,cx as Ge,cy as le,cz as es,cA as ss,cB as rs}from"./index-DWF2kN-s.js";import{W as ts,X as as,Y as ns,F as is,Z as ls}from"./react-icons-atCsfckx.js";import{R as cs}from"./react-dom-CxfJ6lHP.js";import{a as ne}from"./react-redux-C4cSaZU-.js";import{v as ms}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-CCb-kr4I.js";import"./react-router-dom-CYs6befe.js";import"./react-router-S1Hdk0kP.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./scheduler-CzFDRTuY.js";import"./use-sync-external-store-DEc9BFqZ.js";const be=ge(6),us=({todo:e,language:t,priorityOptions:m,categoryOptions:i,handleModify:R,sending:M,newCategory:z,newPriority:L,setNewPriority:J,setNewCategory:X,showDeadline:b,setShowDeadline:U,title:w,newName:O,setNewName:C,newDay:f,setNewDay:d,newMonth:D,setNewMonth:k,newYear:j,setNewYear:y,setIsOpen:_})=>{const[S,o]=u.useState(null),K=n=>{C(n.target.value)},Z=n=>{Number(n)<=31&&n.length<=2?(d(n),o(null)):o(`${de[t]}: ${ue[t]}`)},te=n=>{Number(n)<=12&&n.length<=2?(k(n),o(null)):o(`${de[t]}: ${fe[t]}`)},A=n=>{const h=n.target.value;Number(h)<=Number(new Date().getFullYear())+10&&h.length<=4?(y(h),o(null)):o(Fe[t])};u.useEffect(()=>{if(f&&D&&j){const n=new Date(Number(j),Number(D)-1,Number(f)),h=new Date;h.setHours(0,0,0,0),o(null),n<h&&o(ve[t])}},[f,D,j,t]),u.useEffect(()=>{b?(f||d((new Date().getDate()+1).toString().padStart(2,"0")),D||k((new Date().getMonth()+1).toString().padStart(2,"0")),j||y(new Date().getFullYear().toString())):(d(""),k(""),y(""))},[b]);const N=u.useRef(null),g=u.useRef(null);u.useEffect(()=>{var h;g.current=document.activeElement,(h=N.current)==null||h.focus();const n=Y=>{var q,B;if(Y.key==="Tab"){const v=(B=(q=N.current)==null?void 0:q.parentElement)==null?void 0:B.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!v||v.length===0){Y.preventDefault();return}const H=v==null?void 0:v[0],W=v==null?void 0:v[v.length-1];Y.shiftKey?document.activeElement===H&&(Y.preventDefault(),W==null||W.focus()):document.activeElement===W&&(Y.preventDefault(),H==null||H.focus())}else Y.key==="Escape"&&I()};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n),g.current?g.current.focus():document.body.focus()}},[N.current]);const I=()=>{_(!1),g.current?g.current.focus():document.body.focus()},Q=Ee();return cs.createPortal(s.jsx("div",{className:`${ie["modal-overlay"]} ${Q?c.light:""}`,onClick:I,children:s.jsxs("div",{className:`${ie["modal-content"]} ${c["todo-modal"]}`,onClick:n=>n.stopPropagation(),role:"dialog","aria-modal":"true","aria-label":w??"Task",children:[s.jsxs("button",{ref:N,className:`${ie["close-button"]} tooltip-wrap`,onClick:I,children:[s.jsx("span",{"aria-hidden":"true",children:"×"}),s.jsx("span",{className:"scr",children:ce[t]}),s.jsx("span",{"aria-hidden":"true",className:"tooltip below left narrow2",children:ce[t]})]}),s.jsx("h2",{children:me[t]}),s.jsxs("form",{onSubmit:R,className:`${c.modify}`,children:[s.jsx(re,{id:`category_${P(ee((e==null?void 0:e.name)??be,t))}`,className:`${c.select} ${c["category-select"]}`,value:i==null?void 0:i.find(n=>n.value===z),onChange:n=>X(n==null?void 0:n.value),options:i,instructions:we[t],language:t,hideDelete:!0,z:3}),s.jsx(re,{id:`priority_${P(ee((e==null?void 0:e.name)??be,t))}`,className:`${c.select}`,value:m==null?void 0:m.find(n=>n.value===L),onChange:n=>J(n==null?void 0:n.value),options:m,instructions:Ne[t],language:t,hideDelete:!0,z:2}),s.jsxs("fieldset",{className:`${c.fieldset} ${c["deadline-wrap"]}`,children:[s.jsx("legend",{children:s.jsxs("label",{children:[De[t]," ",s.jsx("input",{style:{marginLeft:"0.5em"},type:"checkbox",checked:b,onChange:()=>U(!b)})]})}),b&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:c["deadline-inputs"],children:[s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`day_${P(ee((e==null?void 0:e.name)??se[t],t))}`,children:ue[t]}),s.jsx("input",{type:"number",id:`day_${P((e==null?void 0:e.name)||"Task")}`,name:"day",min:1,max:31,value:f,placeholder:"DD",onChange:n=>Z(n.target.value),required:!0,className:"bg"})]}),s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`month_${P((e==null?void 0:e.name)||"Task")}`,children:fe[t]}),s.jsx("input",{type:"number",id:`month_${P(ee((e==null?void 0:e.name)??se[t],t))}`,name:"month",min:1,max:12,value:D,placeholder:"MM",onChange:n=>te(n.target.value),required:!0,className:"bg"})]}),s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`year_${P((e==null?void 0:e.name)||"Task")}`,children:$e[t]}),s.jsx("input",{type:"number",id:`year_${P(ee((e==null?void 0:e.name)??se[t],t))}`,name:"year",min:new Date().getFullYear(),max:new Date().getFullYear()+10,value:j,placeholder:"YYYY",onChange:n=>A(n),required:!0,className:"bg"})]})]})," ",S&&s.jsx("p",{className:c.error,children:S})]})]}),s.jsxs("fieldset",{className:`${c.fieldset} ${c.textarea}`,children:[s.jsx("legend",{children:se[t]}),s.jsxs("label",{children:[s.jsx("textarea",{id:`task_${P(e==null?void 0:e.name)}`,required:!0,name:"task",rows:4,value:O,onChange:K}),s.jsxs("span",{className:"scr",children:[me[t]," ",ee((e==null?void 0:e.name)??se[t],t)]})]})]}),s.jsxs("button",{type:"submit",disabled:M,className:"modify",children:[Ce[t]," ",s.jsx(ts,{})]}),s.jsxs("button",{onClick:I,className:`reset ${c.cancel}`,type:"button",children:[ke[t]," ",s.jsx(as,{})]})]})]})}),document.getElementById("modal-root"))};function fs({todo:e,toggleTodo:t,deleteTodo:m,language:i,modifyTodo:R,isDragging:M,handleUpdate:z,handleDragging:L,sending:J,priorityOptions:X,categoryOptions:b,zin:U}){const[w,O]=u.useState((e==null?void 0:e.name)??""),[C,f]=u.useState(!1),[d,D]=u.useState((e==null?void 0:e.priority)||"low"),[k,j]=u.useState(e!=null&&e.deadline?new Date(e.deadline).getDate().toString().padStart(2,"0"):""),[y,_]=u.useState(e!=null&&e.deadline?(new Date(e.deadline).getMonth()+1).toString().padStart(2,"0"):""),[S,o]=u.useState(e!=null&&e.deadline?new Date(e.deadline).getFullYear().toString():""),K=k&&y&&S?`${S}-${y}-${k}`:"",[Z,te]=u.useState((e==null?void 0:e.category)||"other"),[A,N]=u.useState(!1);function g(){t(e==null?void 0:e.key)}function I(){window.confirm(Ie[i]+' "'+(e==null?void 0:e.name)+'"?')&&(O(""),m(e==null?void 0:e.key),N(!1))}const Q=a=>{a.preventDefault(),R(e==null?void 0:e.key,w,d,K,Z),N(!1)};u.useEffect(()=>{e!=null&&e.deadline&&f(!0)},[e]),u.useEffect(()=>{if((e==null?void 0:e.name)!==w&&O((e==null?void 0:e.name)||""),e!=null&&e.deadline){const a=new Date(e.deadline);j(a.getDate().toString().padStart(2,"0")),_((a.getMonth()+1).toString().padStart(2,"0")),o(a.getFullYear().toString())}},[e]);const[n,h]=u.useState(!0),[Y,q]=u.useState(!1),B=()=>{h(!0),q(!1)},v=()=>{h(!0)},H=()=>{h(!1)},W=()=>{h(!1),q(!0)},r=()=>{var a;(a=window.getSelection())!=null&&a.toString()?(h(!1),q(!0)):(h(!0),q(!1))},l=a=>{Y&&a.preventDefault()};return s.jsx(s.Fragment,{children:s.jsxs("li",{style:{zIndex:`calc(${U} - ${e==null?void 0:e.order})`},className:`${M?"dragging":""} ${A?c.open:c.closed}`,draggable:n,onDragStart:a=>{var p;n?(a.dataTransfer.setData("application/my-app",(p=e==null?void 0:e.order)==null?void 0:p.toString()),L(!0)):a.preventDefault()},onDragEnd:()=>L(!1),children:[s.jsxs("span",{onMouseOver:v,onMouseDown:B,className:`${c["drag-handle"]} tooltip-wrap`,children:[s.jsx(ns,{}),s.jsx("span",{className:"tooltip narrow2 below right",children:Me[i]})]}),s.jsxs("label",{onClick:l,children:[s.jsx("input",{type:"checkbox",id:`check_${P(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:g}),s.jsx("span",{onMouseOver:H,onMouseDown:W,onMouseUp:r,children:e==null?void 0:e.name}),s.jsxs("div",{className:`${c["more-info-wrap"]}`,children:[(e==null?void 0:e.category)&&s.jsxs("span",{children:[_e[i],":"," ",pe(he,e==null?void 0:e.category,i)]}),(e==null?void 0:e.priority)&&(e==null?void 0:e.category)&&s.jsx("span",{"aria-hidden":"true",children:" | "}),(e==null?void 0:e.priority)&&s.jsxs("span",{children:[Ne[i],":"," ",pe(he,e==null?void 0:e.priority,i)]}),(e==null?void 0:e.deadline)&&(e==null?void 0:e.deadline)!==""&&(e==null?void 0:e.priority)&&s.jsx("span",{"aria-hidden":"true",children:" | "}),(e==null?void 0:e.deadline)&&(e==null?void 0:e.deadline)!==""&&(()=>{const a=new Date(e.deadline),p=new Date;a.setHours(0,0,0,0),p.setHours(0,0,0,0);const V=a<p,F=a.getTime()===p.getTime();return s.jsxs("span",{className:`${c.deadline} ${V?c.overdue:""} ${F?c.today:""}`,children:[De[i],":"," ",new Date(e.deadline).toLocaleDateString(i,{year:"numeric",month:"long",day:"numeric"})]})})()]})]}),s.jsxs("div",{className:`${c["btn-wrap"]}`,children:[s.jsx("button",{onClick:()=>N(!0),className:`${c.edit} tooltip-wrap`,disabled:(e==null?void 0:e.complete)??!1,children:me[i]}),s.jsxs("button",{className:`${c.delete} tooltip-wrap`,onClick:A?()=>N(!1):I,children:[s.jsx("span",{"aria-hidden":"true",children:A?s.jsx(is,{style:{fontSize:"0.8em"}}):s.jsx(s.Fragment,{children:"×"})}),s.jsx("span",{className:"tooltip below left narrow2",children:A?ce[i]:Ae[i]})]})]}),A&&s.jsx(us,{title:e==null?void 0:e.name,language:i,handleModify:Q,newName:w,setNewName:O,newPriority:d,setNewPriority:D,newDay:k,setNewDay:j,newMonth:y,setNewMonth:_,newYear:S,setNewYear:o,newCategory:Z,setNewCategory:te,priorityOptions:X,categoryOptions:b,showDeadline:C,setShowDeadline:f,sending:J,todo:e,setIsOpen:N})]})})}function ds({toggleTodo:e,deleteTodo:t,language:m,modifyTodo:i,modifyTodoOrder:R,todosWithIdAndStatus:M,sending:z,priorityOptions:L,categoryOptions:J}){var O,C;const{isDragging:X,listItemsByStatus:b,handleUpdate:U,handleDragging:w}=Oe(M,["todos"]);return s.jsx("ul",{className:`${c["todo-ul"]} todo-ul`,onDragOver:f=>f.preventDefault(),onDrop:f=>{var y;f.preventDefault();const d=f.dataTransfer.getData("application/my-app"),D=(y=Array.from(f.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:y.reduce((_,S)=>{const o=S.getBoundingClientRect(),K=Math.abs(o.top-f.clientY);return K<_.offset?{offset:K,element:S}:_},{offset:Number.POSITIVE_INFINITY}),k=Array.from(f.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(D.element);if(Number(d)===k)return;const j=U(Number(d),"todos",k);if(Array.isArray(j)){const _=j==null?void 0:j.map((S,o)=>({key:S.key,order:o}));R(_)}else console.error("Order is not an array");w(!1)},children:(C=(O=b.todos)==null?void 0:O.items)==null?void 0:C.slice().sort((f,d)=>f.order??0>(d.order??0)?1:-1).sort((f,d)=>f.complete===d.complete?0:f.complete?1:-1).map(f=>{var d;return s.jsx(fs,{sending:z,toggleTodo:e,deleteTodo:t,todo:M==null?void 0:M.find(D=>D.key===f.key),language:m,modifyTodo:i,isDragging:X,handleUpdate:U,handleDragging:w,priorityOptions:L,categoryOptions:J,zin:(d=b.todos)==null?void 0:d.items.length},f==null?void 0:f.key)})})}function Ms({language:e}){const t=Ye(),m=ne(r=>{var l;return(l=r.auth)==null?void 0:l.user});u.useEffect(()=>{t(Pe())},[]);const i=ne(r=>r.todos.todos),R=ne(r=>r.todos.status),M=ne(r=>r.todos.error),[z,L]=u.useState("low"),[J,X]=u.useState(""),[b,U]=u.useState("other"),[w,O]=u.useState("all"),[C,f]=u.useState("all"),d="ReactTodos",D=i==null?void 0:i.some(r=>r.complete);u.useEffect(()=>{if(i.length===0&&!m){const r=JSON.parse(window.localStorage.getItem(d)||"[]"),l=new Set(i.map(a=>a.key));r.forEach(a=>{l.has(a.key)||t(Re(a))})}},[t,i,m]),u.useEffect(()=>{window.localStorage.setItem(d,JSON.stringify(i))},[i]);const k=r=>{const l=new Set,a=[];return r.forEach(p=>{l.has(p.key)?a.push(p):l.add(p.key)}),a},j=r=>{if(!r){t($("Error: no key",!0,8));return}if(m!=null&&m._id)t(xe(m._id,r));else{t(je(r));const l=i.filter(a=>a.key!==r);window.localStorage.setItem(d,JSON.stringify(l))}};u.useEffect(()=>{const r=k(i),l=new Set;r.forEach(a=>{l.has(a.key)||(j(a.key),l.add(a.key))})},[i]);const[y,_]=u.useState([]),S=i.filter(r=>{const l=w==="all"||r.priority===w,a=C==="all"||r.category===C;return l&&a});u.useEffect(()=>{const r=S==null?void 0:S.slice().sort((l,a)=>(l.order??0)-(a.order??0)).map(l=>({...l,id:l.order,status:"todos"}));_(r)},[i,w,C]);const o=["all","low","medium","high"],K=["all","work","personal","shopping","other"],Z=["low","medium","high"],te=["work","personal","shopping","other"],A=ae(o,e),N=ae(K,e),g=ae(Z,e),I=ae(te,e);u.useEffect(()=>{R==="failed"&&t($(`There was an error: ${M}`,!0,8))},[R,M,t]);const[Q,n]=u.useState(!1);u.useEffect(()=>{m!=null&&m._id&&t(ze(m._id)).then(()=>{t(oe(m._id))}).catch(r=>{var l,a;console.error(r),(a=(l=r.response)==null?void 0:l.data)!=null&&a.message?t($(r.response.data.message,!0,8)):t($(`${r.message}`,!0,8))})},[m==null?void 0:m._id]);function h(r){const l=i.find(a=>a.key===r);if(l){const a={...l,complete:!l.complete};t(m?Se(m._id,r,a):Te(a))}}const Y=async(r,l,a,p,V)=>{if(n(!0),!r){t($("Error: no key",!0,8)),n(!1);return}const F=i.find(E=>E.key===r);if(F){const E={...F,name:l,priority:a,deadline:p,category:V};if(m)await t(Se(m._id,r,E)).then(()=>{t($(`${Xe[e]}`,!1,3)),n(!1)}).catch(x=>{var T,G;console.error(x),(G=(T=x.response)==null?void 0:T.data)!=null&&G.message?t($(x.response.data.message,!0,8)):t($(`${x}`,!0,8)),n(!1)});else{t(Te(E));const x=i.map(T=>T.key===r?E:T);window.localStorage.setItem(d,JSON.stringify(x)),n(!1)}}},q=r=>{var l,a;if(m)t(async p=>{var V,F;try{await Ze(m._id,r).then(()=>{p(oe(m._id))})}catch(E){console.error(E),(F=(V=E.response)==null?void 0:V.data)!=null&&F.message?p($(E.response.data.message,!0,8)):p($(`${E}`,!0,8))}});else try{t(Qe(r))}catch(p){console.error(p),(a=(l=p.response)==null?void 0:l.data)!=null&&a.message?t($(p.response.data.message,!0,8)):t($(`${p}`,!0,8))}finally{window.localStorage.setItem(d,JSON.stringify(i))}},B=u.useRef(null),v=r=>{var E;r.preventDefault(),n(!0);const l=((E=B.current)==null?void 0:E.value)??"";if(l===""){n(!1);return}const a=ms(),p=i.reduce((x,T)=>T.order>x?T.order:x,0),V=i.reduce((x,T)=>T.order<x?T.order:x,0);let F;if(z==="high"?F={key:a,name:l,complete:!1,order:V-1,priority:z,deadline:J,category:b}:F={key:a,name:l,complete:!1,order:p+1,priority:z,deadline:J,category:b},m)t(Ge(m._id,F)),n(!1);else{const x=[...i,F].sort((T,G)=>T.order-G.order).map((T,G)=>({...T,order:G}));t(le(x)),window.localStorage.setItem(d,JSON.stringify(x)),le(x),n(!1)}B.current&&(B.current.value="")};async function H(r){if(r.preventDefault(),window.confirm(es[e]))if(m)await t(ss(m._id));else{t(rs());const l=i.filter(a=>!a.complete);window.localStorage.setItem(d,JSON.stringify(l))}}function W(r){if(!r){t($("Error: no key",!0,8));return}if(m!=null&&m._id)t(xe(m._id,r));else{t(je(r));let l=i.filter(a=>a.key!==r);l=l.map((a,p)=>({...a,order:p+1})),t(le(l)),window.localStorage.setItem(d,JSON.stringify(l))}}return s.jsxs(s.Fragment,{children:[s.jsx("form",{onSubmit:v,className:c.form,children:s.jsxs("fieldset",{children:[s.jsx("legend",{className:"scr",children:qe[e]}),s.jsxs("div",{className:c["todo-input-area"],children:[s.jsx("label",{htmlFor:"taskinput",children:ye[e]}),s.jsx("textarea",{ref:B,id:"taskinput",className:"bg",rows:3,name:"task",required:!0,autoComplete:"off",placeholder:`${se[e]}...`}),s.jsx(re,{z:y.length+5,id:"category",className:`${c.select} ${c["category-select"]}`,hideDelete:!0,instructions:we[e],value:I.find(r=>r.value===b)||I[0],onChange:r=>U(r==null?void 0:r.value),options:I,language:e}),s.jsx(re,{id:"priority",className:c.select,hideDelete:!0,instructions:Be[e],value:g.find(r=>r.value===z)||g[0],onChange:r=>L(r==null?void 0:r.value),options:g,language:e,z:y.length+4}),s.jsxs("button",{id:c["submit-todo"],className:c["submit-todo"],type:"submit",disabled:Q,children:[ye[e]," ",s.jsx(ls,{})]})]})]})}),s.jsxs("div",{className:c["controls-wrap"],children:[s.jsx(re,{id:"category-filter",className:`${c.select} ${c["category-select"]}`,hideDelete:!0,instructions:Le[e],value:N.find(r=>r.value===C)||N[0],onChange:r=>f(r==null?void 0:r.value),options:N,language:e,z:y.length+3}),s.jsx(re,{id:"priority-filter",className:c.select,hideDelete:!0,instructions:Je[e],value:A.find(r=>r.value===w)||A[0],onChange:r=>O(r==null?void 0:r.value),options:A,language:e,z:y.length+2}),s.jsx("button",{className:`danger ${c["clear-completed"]}`,disabled:!D,onClick:r=>H(r),children:Ue[e]})]}),s.jsxs("div",{className:c["list-wrap"],children:[s.jsxs("p",{className:c["left-to-do"],children:[i==null?void 0:i.filter(r=>!(r!=null&&r.complete)).length," ",Ke[e]]}),(w!=="all"||C!=="all")&&s.jsxs("p",{className:c["filter-notification"],children:[He[e]," ",We[e]]}),s.jsx(ds,{sending:Q,todosWithIdAndStatus:y,toggleTodo:h,deleteTodo:W,language:e,modifyTodo:Y,modifyTodoOrder:q,priorityOptions:g,categoryOptions:I}),R==="loading"&&s.jsxs("p",{className:"flex center margin0auto textcenter",children:[Ve[e],"..."]})]})]})}export{Ms as default};
