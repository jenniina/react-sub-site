import{r as f,j as o}from"./react-A9DAvxly.js";import{bH as z,b1 as J,b0 as P,b5 as L,bI as V,bJ as H,bK as Q,bL as Y,bM as X,bN as Z,K as W,bl as G,bO as R,W as _,bP as ee,bQ as se,bR as U,bS as te,bT as ae,ad as re,bU as q,bV as F,bW as K,bX as B,bY as ne,bZ as oe,b_ as le,b$ as ie,c0 as ce,c1 as de,c2 as fe,c3 as me}from"./index-DKfLKaok.js";import{a1 as pe}from"./react-icons-BGZR1ov-.js";import{a as $}from"./react-redux-CHm9GgGE.js";import{v as ue}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./react-dom-yh0erWL-.js";import"./scheduler-CzFDRTuY.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-CCb-kr4I.js";import"./react-router-dom-CYs6befe.js";import"./react-router-S1Hdk0kP.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./use-sync-external-store-DEc9BFqZ.js";const he="_form_7mcgs_1",ye="_closed_7mcgs_173",Te="_open_7mcgs_189",ge="_modify_7mcgs_173",m={form:he,"list-wrap":"_list-wrap_7mcgs_31","todo-input-area":"_todo-input-area_7mcgs_37","todo-ul":"_todo-ul_7mcgs_49","drag-handle":"_drag-handle_7mcgs_83","btn-wrap":"_btn-wrap_7mcgs_139",closed:ye,"modify-todo":"_modify-todo_7mcgs_173",open:Te,delete:"_delete_7mcgs_243","left-to-do":"_left-to-do_7mcgs_291",modify:ge};function be({todo:e,toggleTodo:n,deleteTodo:l,language:t,modifyTodo:D,isDragging:x,handleUpdate:y,handleDragging:I,sending:A}){const[k,S]=f.useState((e==null?void 0:e.name)??""),[j,E]=f.useState(!1);function d(){n(e==null?void 0:e.key)}function u(){window.confirm(X[t]+' "'+(e==null?void 0:e.name)+'"?')&&(S(""),l(e==null?void 0:e.key),E(!1))}const h=i=>{i.preventDefault(),D(e==null?void 0:e.key,k),E(!1)},v=i=>{S(i.target.value)};f.useEffect(()=>{(e==null?void 0:e.name)!==k&&S((e==null?void 0:e.name)||"")},[e]);const[N,T]=f.useState(!0),[g,b]=f.useState(!1),O=()=>{T(!0),b(!1)},C=()=>{T(!0)},s=()=>{T(!1)},a=()=>{T(!1),b(!0)},r=()=>{var i;(i=window.getSelection())!=null&&i.toString()?(T(!1),b(!0)):(T(!0),b(!1))},c=i=>{g&&i.preventDefault()};return o.jsxs("li",{className:`${x?"dragging":""}`,draggable:N,onDragStart:i=>{var p;N?(i.dataTransfer.setData("application/my-app",(p=e==null?void 0:e.order)==null?void 0:p.toString()),I(!0)):i.preventDefault()},onDragEnd:()=>I(!1),children:[o.jsxs("span",{onMouseOver:C,onMouseDown:O,className:`${m["drag-handle"]} tooltip-wrap`,children:[o.jsx(pe,{}),o.jsx("span",{className:"tooltip narrow2 below right",children:z[t]})]}),o.jsxs("label",{className:`${j?m.open:m.closed}`,onClick:c,children:[o.jsx("input",{type:"checkbox",id:`check_${J(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:d}),o.jsx("span",{onMouseOver:s,onMouseDown:a,onMouseUp:r,children:e==null?void 0:e.name})]}),o.jsxs("div",{className:`${j?m.open:m.closed} ${m["btn-wrap"]}`,children:[o.jsx(P,{language:t,className:`${m["modify-todo"]} modify-todo`,wrapperClass:"modify-todo-wrap",text:L[t],isOpen:j,setIsFormOpen:E,hideBrackets:!1,onClick:()=>{S((e==null?void 0:e.name)??"")},children:o.jsxs("form",{onSubmit:h,className:`${m.modify}`,children:[o.jsxs("label",{children:[o.jsx("textarea",{id:`task_${J(e==null?void 0:e.name)}`,required:!0,name:"task",value:k,onChange:v}),o.jsxs("span",{className:"scr",children:[L[t]," ",V((e==null?void 0:e.name)??H[t],t)]})]}),o.jsx("button",{type:"submit",disabled:A,className:"modify",children:Q[t]})]})}),o.jsxs("button",{className:`${m.delete}`,onClick:u,"data-label":Y[t],children:[o.jsx("span",{children:"Ã—"}),o.jsx("span",{className:"scr",children:Y[t]})]})]})]})}function _e({toggleTodo:e,deleteTodo:n,language:l,modifyTodo:t,modifyTodoOrder:D,todosWithIdAndStatus:x,sending:y}){var j,E;const{isDragging:I,listItemsByStatus:A,handleUpdate:k,handleDragging:S}=Z(x,["todos"]);return W(),o.jsx("ul",{className:`${m["todo-ul"]} todo-ul`,onDragOver:d=>d.preventDefault(),onDrop:d=>{var T;d.preventDefault();const u=d.dataTransfer.getData("application/my-app"),h=(T=Array.from(d.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:T.reduce((g,b)=>{const O=b.getBoundingClientRect(),C=Math.abs(O.top-d.clientY);return C<g.offset?{offset:C,element:b}:g},{offset:Number.POSITIVE_INFINITY}),v=Array.from(d.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(h.element);if(Number(u)===v)return;const N=k(Number(u),"todos",v);if(Array.isArray(N)){const g=N==null?void 0:N.map((b,O)=>({key:b.key,order:O}));D(g)}else console.error("Order is not an array");S(!1)},children:(E=(j=A.todos)==null?void 0:j.items)==null?void 0:E.slice().sort((d,u)=>d.order??0>(u.order??0)?1:-1).sort((d,u)=>d.complete===u.complete?0:d.complete?1:-1).map(d=>o.jsx(be,{sending:y,toggleTodo:e,deleteTodo:n,todo:x==null?void 0:x.find(u=>u.key===d.key),language:l,modifyTodo:t,isDragging:I,handleUpdate:k,handleDragging:S},d==null?void 0:d.key))})}function Ue({language:e}){const n=W(),l=$(s=>{var a;return(a=s.auth)==null?void 0:a.user});f.useEffect(()=>{n(G())},[]);const t=$(s=>s.todos.todos),D=$(s=>s.todos.status),x=$(s=>s.todos.error),y="ReactTodos",I=t==null?void 0:t.some(s=>s.complete);f.useEffect(()=>{if(t.length===0&&!l){const s=JSON.parse(window.localStorage.getItem(y)||"[]"),a=new Set(t.map(r=>r.key));s.forEach(r=>{a.has(r.key)||n(R(r))})}},[n,t,l]),f.useEffect(()=>{window.localStorage.setItem(y,JSON.stringify(t))},[t]);const A=s=>{const a=new Set,r=[];return s.forEach(c=>{a.has(c.key)?r.push(c):a.add(c.key)}),r},k=s=>{if(!s){n(_("Error: no key",!0,8));return}if(l!=null&&l._id)n(q(l._id,s));else{n(F(s));const a=t.filter(r=>r.key!==s);window.localStorage.setItem(y,JSON.stringify(a))}};f.useEffect(()=>{const s=A(t),a=new Set;s.forEach(r=>{a.has(r.key)||(k(r.key),a.add(r.key))})},[t]);const[S,j]=f.useState([]);f.useEffect(()=>{const s=t==null?void 0:t.slice().sort((a,r)=>(a.order??0)-(r.order??0)).map(a=>({...a,id:a.order,status:"todos"}));j(s)},[t]),f.useEffect(()=>{D==="failed"&&n(_(`There was an error: ${x}`,!0,8))},[D,x,n]);const[E,d]=f.useState(!1),[u,h]=f.useState(!1);f.useEffect(()=>{l!=null&&l._id&&!E&&n(ee(l._id)).then(()=>{d(!0)})},[l==null?void 0:l._id]);function v(s){const a=t.find(r=>r.key===s);if(a){const r={...a,complete:!a.complete};n(l?K(l._id,s,r):B(r))}}const N=async(s,a)=>{if(h(!0),!s){n(_("Error: no key",!0,8)),h(!1);return}const r=t.find(c=>c.key===s);if(r){const c={...r,name:a};if(l)await n(K(l._id,s,c)).then(()=>{n(_("Todo updated",!1,3)),h(!1)}).catch(i=>{var p,w;console.error(i),(w=(p=i.response)==null?void 0:p.data)!=null&&w.message?n(_(i.response.data.message,!0,8)):n(_(`${i}`,!0,8)),h(!1)});else{n(B(c));const i=t.map(p=>p.key===s?c:p);window.localStorage.setItem(y,JSON.stringify(i)),h(!1)}}},T=s=>{var a,r;if(l)n(async c=>{var i,p;try{await ne(l._id,s).then(()=>{c(oe(l._id))})}catch(w){console.error(w),(p=(i=w.response)==null?void 0:i.data)!=null&&p.message?c(_(w.response.data.message,!0,8)):c(_(`${w}`,!0,8))}});else try{n(le(s))}catch(c){console.error(c),(r=(a=c.response)==null?void 0:a.data)!=null&&r.message?n(_(c.response.data.message,!0,8)):n(_(`${c}`,!0,8))}finally{window.localStorage.setItem(y,JSON.stringify(t))}},g=f.useRef(null),b=s=>{var p;s.preventDefault(),h(!0);const a=((p=g.current)==null?void 0:p.value)??"";if(a===""){h(!1);return}const r=ue(),c=t.reduce((w,M)=>M.order>w?M.order:w,0),i={key:r,name:a,complete:!1,order:c+1};l?(n(ie(l._id,i)),h(!1)):(n(R(i)),window.localStorage.setItem(y,JSON.stringify([...t,i])),h(!1)),g.current&&(g.current.value="")};async function O(s){if(s.preventDefault(),window.confirm(ce[e]))if(l)await n(de(l._id));else{n(fe());const a=t.filter(r=>!r.complete);window.localStorage.setItem(y,JSON.stringify(a))}}function C(s){if(!s){n(_("Error: no key",!0,8));return}if(l!=null&&l._id)n(q(l._id,s));else{n(F(s));let a=t.filter(r=>r.key!==s);a=a.map((r,c)=>({...r,order:c+1})),n(me(a)),window.localStorage.setItem(y,JSON.stringify(a))}}return o.jsxs(o.Fragment,{children:[o.jsx("form",{onSubmit:b,className:m.form,children:o.jsxs("fieldset",{children:[o.jsx("legend",{className:"scr",children:se[e]}),o.jsxs("div",{className:m["todo-input-area"],children:[o.jsx("label",{htmlFor:"taskinput",children:U[e]}),o.jsx("textarea",{ref:g,id:"taskinput",className:"bg",name:"task",required:!0,autoComplete:"off",placeholder:`${H[e]}...`}),o.jsx("button",{id:m["submit-todo"],type:"submit",disabled:u,children:U[e]}),o.jsx("button",{className:"danger",disabled:!I,onClick:s=>O(s),children:te[e]})]})]})}),o.jsxs("div",{className:m["list-wrap"],children:[o.jsxs("p",{className:m["left-to-do"],children:[t==null?void 0:t.filter(s=>!(s!=null&&s.complete)).length," ",ae[e]]}),o.jsx(_e,{sending:u,todosWithIdAndStatus:S,toggleTodo:v,deleteTodo:C,language:e,modifyTodo:N,modifyTodoOrder:T}),D==="loading"&&o.jsxs("p",{children:[re[e],"..."]})]})]})}export{Ue as default};
