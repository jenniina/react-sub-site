import{r as w,j as o}from"./react-kX_YxI4E.js";import{L as C,u as R,N as g,E as L,e as b,aB as M}from"./index-De2CRixK.js";import{u as $,g as k}from"./Images-V_cCFKvr.js";import{Q as I,P as q,g as v}from"./poems-DilZHJZy.js";import"./dom-to-image-more-CfDXlNbO.js";import"./react-dom-B5MLDbn_.js";import"./scheduler-CzFDRTuY.js";import"./react-redux-BEmJlIGA.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./react-is-DUDD-a5e.js";import"./use-sync-external-store-BPp6CH6k.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-CCb-kr4I.js";import"./react-icons-DhcENkY1.js";import"./react-router-dom-StiqOUIT.js";import"./react-router-DUuhLvki.js";import"./@remix-run-DTnHqtaE.js";const N=({image:e,language:n,handleDownload:E,searchTerm:l,textType:d})=>{const{t:s}=w.useContext(C),h=R(),{tooltip:f,handleMouseMove:p,handleMouseLeave:r}=$(),m=c=>{const t=c.currentTarget.getBoundingClientRect(),i=c.clientX-t.left+10,y=c.clientY-t.top+10;p(i,y)},[x,u]=w.useState({id:0,content:"",originator:{name:"",id:0,description:"",language_code:"en",master_id:0,url:""},tags:[""],url:"",language_code:"en"}),[j,a]=w.useState({title:"",author:"",lines:[],linecount:"0"});return w.useEffect(()=>{if(d==="poem"){const c=Math.floor(Math.random()*5)+1;(async()=>{const i=await v(n,c);a(i[0])})()}else d==="quote"?(async()=>{if(n=L.fi){const t=await k(L.en,l);t.quote?u(t.quote):h(b(t.message??s("EError"),!0,8))}else{const t=await k(n,l);t.quote?u(t.quote):h(b(t.message??s("EError"),!0,8))}})():Math.floor(Math.random()*2)+1===1?(async()=>{const i=Math.floor(Math.random()*5)+1,y=await v(n,i);a(y[0])})():(async()=>{const i=await k(n,l);i.quote?u(i.quote):h(b(i.message??s("EError"),!0,8))})()},[n,l,d]),o.jsxs("div",{onMouseMove:m,onMouseLeave:r,children:[o.jsxs("div",{className:`tooltip-wrap ${g["image-wrap"]} ${g["image-modal"]}`,children:[o.jsxs("button",{onClick:E,className:"reset",children:[o.jsx("img",{src:e.largeImageURL,alt:e.tags,loading:"lazy",style:{width:"100%",height:"auto",borderRadius:"8px",cursor:"pointer",position:"relative"}})," "]}),f.visible&&o.jsx("span",{className:"tooltip narrow",style:{top:f.y,left:f.x,right:"unset"},children:s("EClickToLoadImage")})]}),d==="quote"?o.jsx(I,{quote:x,language:n}):o.jsx(q,{poem:j,language:n})]})},ee=({image:e,language:n,show:E,searchTerm:l,textType:d})=>{const{t:s}=w.useContext(C),h=R(),f=async()=>{if(window.confirm(s("EDownload")+"?")){const r=await fetch(e.largeImageURL,{mode:"cors"});if(!r.ok)throw new Error("Network response was not ok");try{const m=await r.blob(),x=window.URL.createObjectURL(m),u=e.largeImageURL.match(/\.(jpg|jpeg|png|gif|bmp|webp)$/i),j=u?u[1].toLowerCase():"jpg",a=document.createElement("a");a.href=x,a.download=`${M(`${e.id}`)}-${M(e.user)}.${j}`,a.target="_blank",a.rel="noreferrer",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(x)}catch(m){console.error("Download failed:",m),h(b(`${s("EError")}: ${m}`,!0,5))}}},p=()=>{E({title:e.tags,className:g["image-modal"],children:o.jsx(N,{image:e,language:n,handleDownload:f,searchTerm:l,textType:d})})};return o.jsxs("div",{className:`tooltip-wrap ${g["image-wrap"]}`,children:[o.jsx("button",{type:"button",style:{background:"none",border:"none",padding:0,cursor:"pointer",width:"100%"},"aria-label":s("EClickToOpenLargeImage"),onClick:p,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),p())},children:o.jsx("img",{src:e.webformatURL,alt:e.tags,title:e.tags,loading:"lazy",className:`${g["image-small"]}`,tabIndex:0,style:{width:"100%",height:"auto",borderRadius:"8px",cursor:"pointer"},onClick:p,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&p()}})}),o.jsx("span",{className:"tooltip above narrow2",children:s("EClickToOpenLargeImage")}),o.jsx("p",{children:o.jsx("small",{children:o.jsxs("a",{href:e.pageURL,target:"_blank",rel:"noreferrer",children:[s("EImagePage")," (",s("EAuthor"),": ",e.user,")"]})})})]},e.id)};export{ee as default};
