import{r as f,j as n}from"./react-A9DAvxly.js";import{bQ as B,ba as F,b9 as H,be as J,bR as V,bS as W,bT as P,bU as Q,bV as X,bW as Z,bX as G,K as z,bu as ee,bY as U,W as y,bZ as se,b_ as te,b$ as Y,c0 as ae,c1 as re,ag as ne,c2 as L,c3 as R,c4 as q,c5 as K,c6 as oe,c7 as le,c8 as ie,c9 as ce,ca as de,cb as fe,cc as me,cd as pe}from"./index-yJlXDAYf.js";import{W as ue,F as he}from"./react-icons-CrVlm7qW.js";import{a as $}from"./react-redux-CHm9GgGE.js";import{v as ye}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./react-dom-yh0erWL-.js";import"./scheduler-CzFDRTuY.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-CCb-kr4I.js";import"./react-router-dom-CYs6befe.js";import"./react-router-S1Hdk0kP.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./use-sync-external-store-DEc9BFqZ.js";const xe="_form_155x1_1",Te="_closed_155x1_171",we="_open_155x1_187",_e="_modify_155x1_171",m={form:xe,"list-wrap":"_list-wrap_155x1_31","todo-input-area":"_todo-input-area_155x1_37","todo-ul":"_todo-ul_155x1_49","drag-handle":"_drag-handle_155x1_83","btn-wrap":"_btn-wrap_155x1_139",closed:Te,"modify-todo":"_modify-todo_155x1_171",open:we,delete:"_delete_155x1_241","left-to-do":"_left-to-do_155x1_265",modify:_e};function ge({todo:e,toggleTodo:o,deleteTodo:l,language:a,modifyTodo:D,isDragging:S,handleUpdate:x,handleDragging:C,sending:I}){const[E,N]=f.useState((e==null?void 0:e.name)??""),[T,j]=f.useState(!1);function d(){o(e==null?void 0:e.key)}function u(){window.confirm(Z[a]+' "'+(e==null?void 0:e.name)+'"?')&&(N(""),l(e==null?void 0:e.key),j(!1))}const h=i=>{i.preventDefault(),D(e==null?void 0:e.key,E),j(!1)},v=i=>{N(i.target.value)};f.useEffect(()=>{(e==null?void 0:e.name)!==E&&N((e==null?void 0:e.name)||"")},[e]);const[k,w]=f.useState(!0),[_,g]=f.useState(!1),O=()=>{w(!0),g(!1)},A=()=>{w(!0)},s=()=>{w(!1)},t=()=>{w(!1),g(!0)},r=()=>{var i;(i=window.getSelection())!=null&&i.toString()?(w(!1),g(!0)):(w(!0),g(!1))},c=i=>{_&&i.preventDefault()};return n.jsxs("li",{className:`${S?"dragging":""}`,draggable:k,onDragStart:i=>{var p;k?(i.dataTransfer.setData("application/my-app",(p=e==null?void 0:e.order)==null?void 0:p.toString()),C(!0)):i.preventDefault()},onDragEnd:()=>C(!1),children:[n.jsxs("span",{onMouseOver:A,onMouseDown:O,className:`${m["drag-handle"]} tooltip-wrap`,children:[n.jsx(ue,{}),n.jsx("span",{className:"tooltip narrow2 below right",children:B[a]})]}),n.jsxs("label",{className:`${T?m.open:m.closed}`,onClick:c,children:[n.jsx("input",{type:"checkbox",id:`check_${F(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:d}),n.jsx("span",{onMouseOver:s,onMouseDown:t,onMouseUp:r,children:e==null?void 0:e.name})]}),n.jsxs("div",{className:`${T?m.open:m.closed} ${m["btn-wrap"]}`,children:[n.jsx(H,{language:a,className:`${m["modify-todo"]} modify-todo`,wrapperClass:"modify-todo-wrap",text:J[a],isOpen:T,setIsFormOpen:j,hideBrackets:!1,onClick:()=>{N((e==null?void 0:e.name)??"")},children:n.jsxs("form",{onSubmit:h,className:`${m.modify}`,children:[n.jsxs("label",{children:[n.jsx("textarea",{id:`task_${F(e==null?void 0:e.name)}`,required:!0,name:"task",rows:4,value:E,onChange:v}),n.jsxs("span",{className:"scr",children:[J[a]," ",V((e==null?void 0:e.name)??W[a],a)]})]}),n.jsx("button",{type:"submit",disabled:I,className:"modify",children:P[a]})]})}),n.jsxs("button",{className:`${m.delete} tooltip-wrap`,onClick:T?()=>j(!1):u,children:[n.jsx("span",{"aria-hidden":"true",children:T?n.jsx(he,{style:{fontSize:"0.8em"}}):n.jsx(n.Fragment,{children:"Ã—"})}),n.jsx("span",{className:"tooltip below left narrow2",children:T?Q[a]:X[a]})]})]})]})}function be({toggleTodo:e,deleteTodo:o,language:l,modifyTodo:a,modifyTodoOrder:D,todosWithIdAndStatus:S,sending:x}){var T,j;const{isDragging:C,listItemsByStatus:I,handleUpdate:E,handleDragging:N}=G(S,["todos"]);return z(),n.jsx("ul",{className:`${m["todo-ul"]} todo-ul`,onDragOver:d=>d.preventDefault(),onDrop:d=>{var w;d.preventDefault();const u=d.dataTransfer.getData("application/my-app"),h=(w=Array.from(d.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:w.reduce((_,g)=>{const O=g.getBoundingClientRect(),A=Math.abs(O.top-d.clientY);return A<_.offset?{offset:A,element:g}:_},{offset:Number.POSITIVE_INFINITY}),v=Array.from(d.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(h.element);if(Number(u)===v)return;const k=E(Number(u),"todos",v);if(Array.isArray(k)){const _=k==null?void 0:k.map((g,O)=>({key:g.key,order:O}));D(_)}else console.error("Order is not an array");N(!1)},children:(j=(T=I.todos)==null?void 0:T.items)==null?void 0:j.slice().sort((d,u)=>d.order??0>(u.order??0)?1:-1).sort((d,u)=>d.complete===u.complete?0:d.complete?1:-1).map(d=>n.jsx(ge,{sending:x,toggleTodo:e,deleteTodo:o,todo:S==null?void 0:S.find(u=>u.key===d.key),language:l,modifyTodo:a,isDragging:C,handleUpdate:E,handleDragging:N},d==null?void 0:d.key))})}function qe({language:e}){const o=z(),l=$(s=>{var t;return(t=s.auth)==null?void 0:t.user});f.useEffect(()=>{o(ee())},[]);const a=$(s=>s.todos.todos),D=$(s=>s.todos.status),S=$(s=>s.todos.error),x="ReactTodos",C=a==null?void 0:a.some(s=>s.complete);f.useEffect(()=>{if(a.length===0&&!l){const s=JSON.parse(window.localStorage.getItem(x)||"[]"),t=new Set(a.map(r=>r.key));s.forEach(r=>{t.has(r.key)||o(U(r))})}},[o,a,l]),f.useEffect(()=>{window.localStorage.setItem(x,JSON.stringify(a))},[a]);const I=s=>{const t=new Set,r=[];return s.forEach(c=>{t.has(c.key)?r.push(c):t.add(c.key)}),r},E=s=>{if(!s){o(y("Error: no key",!0,8));return}if(l!=null&&l._id)o(L(l._id,s));else{o(R(s));const t=a.filter(r=>r.key!==s);window.localStorage.setItem(x,JSON.stringify(t))}};f.useEffect(()=>{const s=I(a),t=new Set;s.forEach(r=>{t.has(r.key)||(E(r.key),t.add(r.key))})},[a]);const[N,T]=f.useState([]);f.useEffect(()=>{const s=a==null?void 0:a.slice().sort((t,r)=>(t.order??0)-(r.order??0)).map(t=>({...t,id:t.order,status:"todos"}));T(s)},[a]),f.useEffect(()=>{D==="failed"&&o(y(`There was an error: ${S}`,!0,8))},[D,S,o]);const[j,d]=f.useState(!1),[u,h]=f.useState(!1);f.useEffect(()=>{l!=null&&l._id&&!j&&o(se(l._id)).then(()=>{d(!0)}).catch(s=>{var t,r;console.error(s),(r=(t=s.response)==null?void 0:t.data)!=null&&r.message?o(y(s.response.data.message,!0,8)):o(y(`${s.message}`,!0,8))})},[l==null?void 0:l._id]);function v(s){const t=a.find(r=>r.key===s);if(t){const r={...t,complete:!t.complete};o(l?q(l._id,s,r):K(r))}}const k=async(s,t)=>{if(h(!0),!s){o(y("Error: no key",!0,8)),h(!1);return}const r=a.find(c=>c.key===s);if(r){const c={...r,name:t};if(l)await o(q(l._id,s,c)).then(()=>{o(y("Todo updated",!1,3)),h(!1)}).catch(i=>{var p,b;console.error(i),(b=(p=i.response)==null?void 0:p.data)!=null&&b.message?o(y(i.response.data.message,!0,8)):o(y(`${i}`,!0,8)),h(!1)});else{o(K(c));const i=a.map(p=>p.key===s?c:p);window.localStorage.setItem(x,JSON.stringify(i)),h(!1)}}},w=s=>{var t,r;if(l)o(async c=>{var i,p;try{await oe(l._id,s).then(()=>{c(le(l._id))})}catch(b){console.error(b),(p=(i=b.response)==null?void 0:i.data)!=null&&p.message?c(y(b.response.data.message,!0,8)):c(y(`${b}`,!0,8))}});else try{o(ie(s))}catch(c){console.error(c),(r=(t=c.response)==null?void 0:t.data)!=null&&r.message?o(y(c.response.data.message,!0,8)):o(y(`${c}`,!0,8))}finally{window.localStorage.setItem(x,JSON.stringify(a))}},_=f.useRef(null),g=s=>{var p;s.preventDefault(),h(!0);const t=((p=_.current)==null?void 0:p.value)??"";if(t===""){h(!1);return}const r=ye(),c=a.reduce((b,M)=>M.order>b?M.order:b,0),i={key:r,name:t,complete:!1,order:c+1};l?(o(ce(l._id,i)),h(!1)):(o(U(i)),window.localStorage.setItem(x,JSON.stringify([...a,i])),h(!1)),_.current&&(_.current.value="")};async function O(s){if(s.preventDefault(),window.confirm(de[e]))if(l)await o(fe(l._id));else{o(me());const t=a.filter(r=>!r.complete);window.localStorage.setItem(x,JSON.stringify(t))}}function A(s){if(!s){o(y("Error: no key",!0,8));return}if(l!=null&&l._id)o(L(l._id,s));else{o(R(s));let t=a.filter(r=>r.key!==s);t=t.map((r,c)=>({...r,order:c+1})),o(pe(t)),window.localStorage.setItem(x,JSON.stringify(t))}}return n.jsxs(n.Fragment,{children:[n.jsx("form",{onSubmit:g,className:m.form,children:n.jsxs("fieldset",{children:[n.jsx("legend",{className:"scr",children:te[e]}),n.jsxs("div",{className:m["todo-input-area"],children:[n.jsx("label",{htmlFor:"taskinput",children:Y[e]}),n.jsx("textarea",{ref:_,id:"taskinput",className:"bg",rows:3,name:"task",required:!0,autoComplete:"off",placeholder:`${W[e]}...`}),n.jsx("button",{id:m["submit-todo"],type:"submit",disabled:u,children:Y[e]}),n.jsx("button",{className:"danger",disabled:!C,onClick:s=>O(s),children:ae[e]})]})]})}),n.jsxs("div",{className:m["list-wrap"],children:[n.jsxs("p",{className:m["left-to-do"],children:[a==null?void 0:a.filter(s=>!(s!=null&&s.complete)).length," ",re[e]]}),n.jsx(be,{sending:u,todosWithIdAndStatus:N,toggleTodo:v,deleteTodo:A,language:e,modifyTodo:k,modifyTodoOrder:w}),D==="loading"&&n.jsxs("p",{className:"flex center margin0auto textcenter",children:[ne[e],"..."]})]})]})}export{qe as default};
