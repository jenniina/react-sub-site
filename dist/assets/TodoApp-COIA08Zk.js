import{r as d,j as s}from"./react-A9DAvxly.js";import{bQ as Te,bR as De,bS as ne,bT as ie,be as le,S as ee,ba as I,bU as Q,bV as Se,bW as be,bX as Ne,bY as G,bZ as me,b_ as de,b$ as Ee,c0 as Ce,c1 as $e,c2 as ke,c3 as fe,c4 as ge,c5 as Fe,c6 as Me,c7 as ue,c8 as pe,c9 as Ae,ca as Ie,cb as Oe,K as Ye,bu as Pe,cc as oe,cd as te,W as T,ce as Re,cf as he,cg as ze,ch as ye,ci as qe,cj as Le,ck as Be,cl as Je,cm as Ue,cn as Ke,co as We,ag as He,cp as xe,cq as _e,cr as ve,cs as we,ct as Ve,cu as Xe,cv as Ze,cw as Qe,cx as Ge,cy as es,cz as ss,cA as rs}from"./index-DuelJnhs.js";import{W as ts,X as as,Y as ns,F as is,Z as ls}from"./react-icons-atCsfckx.js";import{R as cs}from"./react-dom-CxfJ6lHP.js";import{a as ae}from"./react-redux-C4cSaZU-.js";import{v as ms}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./@reduxjs-DhFEcpJw.js";import"./immer-C0GRqQ_d.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-CCb-kr4I.js";import"./react-router-dom-CYs6befe.js";import"./react-router-S1Hdk0kP.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./scheduler-CzFDRTuY.js";import"./use-sync-external-store-DEc9BFqZ.js";const ds="_form_v0mrn_1",fs="_edit_v0mrn_63",us="_cancel_v0mrn_75",ps="_closed_v0mrn_251",os="_modify_v0mrn_251",hs="_select_v0mrn_457",ys="_fieldset_v0mrn_519",xs="_textarea_v0mrn_537",_s="_open_v0mrn_793",c={form:ds,"list-wrap":"_list-wrap_v0mrn_31","todo-input-area":"_todo-input-area_v0mrn_37","submit-todo":"_submit-todo_v0mrn_51","clear-completed":"_clear-completed_v0mrn_57","btn-wrap":"_btn-wrap_v0mrn_63",edit:fs,cancel:us,"todo-modal":"_todo-modal_v0mrn_105","todo-ul":"_todo-ul_v0mrn_125","drag-handle":"_drag-handle_v0mrn_159","modify-todo":"_modify-todo_v0mrn_251",closed:ps,delete:"_delete_v0mrn_329","left-to-do":"_left-to-do_v0mrn_357",modify:os,"controls-wrap":"_controls-wrap_v0mrn_441",select:hs,"more-info-wrap":"_more-info-wrap_v0mrn_485",fieldset:ys,textarea:xs,"deadline-inputs":"_deadline-inputs_v0mrn_551","deadline-wrap":"_deadline-wrap_v0mrn_577","filter-notification":"_filter-notification_v0mrn_593","category-select":"_category-select_v0mrn_693",open:_s},je=ke(6),vs=({todo:e,language:t,priorityOptions:m,categoryOptions:i,handleModify:O,sending:$,newCategory:W,newPriority:z,setNewPriority:H,setNewCategory:V,showDeadline:j,setShowDeadline:q,title:v,newName:M,setNewName:D,newDay:f,setNewDay:u,newMonth:S,setNewMonth:E,newYear:x,setNewYear:y,setIsOpen:k})=>{const[_,h]=d.useState(null),L=n=>{D(n.target.value)},X=n=>{Number(n)<=31&&n.length<=2?(u(n),h(null)):h(`${fe[t]}: ${me[t]}`)},se=n=>{Number(n)<=12&&n.length<=2?(E(n),h(null)):h(`${fe[t]}: ${de[t]}`)},g=n=>{const o=n.target.value;Number(o)<=Number(new Date().getFullYear())+10&&o.length<=4?(y(o),h(null)):h(ge[t])};d.useEffect(()=>{if(f&&S&&x){const n=new Date(Number(x),Number(S)-1,Number(f)),o=new Date;o.setHours(0,0,0,0),h(null),n<o&&h(Te[t])}},[f,S,x,t]),d.useEffect(()=>{j?(f||u((new Date().getDate()+1).toString().padStart(2,"0")),S||E((new Date().getMonth()+1).toString().padStart(2,"0")),x||y(new Date().getFullYear().toString())):(u(""),E(""),y(""))},[j]);const w=d.useRef(null),C=d.useRef(null);d.useEffect(()=>{var o;C.current=document.activeElement,(o=w.current)==null||o.focus();const n=A=>{var Y,P;if(A.key==="Tab"){const b=(P=(Y=w.current)==null?void 0:Y.parentElement)==null?void 0:P.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!b||b.length===0){A.preventDefault();return}const B=b==null?void 0:b[0],J=b==null?void 0:b[b.length-1];A.shiftKey?document.activeElement===B&&(A.preventDefault(),J==null||J.focus()):document.activeElement===J&&(A.preventDefault(),B==null||B.focus())}else A.key==="Escape"&&F()};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n),C.current?C.current.focus():document.body.focus()}},[w.current]);const F=()=>{k(!1),C.current?C.current.focus():document.body.focus()},Z=De();return cs.createPortal(s.jsx("div",{className:`${ne["modal-overlay"]} ${Z?c.light:""}`,onClick:F,children:s.jsxs("div",{className:`${ne["modal-content"]} ${c["todo-modal"]}`,onClick:n=>n.stopPropagation(),role:"dialog","aria-modal":"true","aria-label":v??"Task",children:[s.jsxs("button",{ref:w,className:`${ne["close-button"]} tooltip-wrap`,onClick:F,children:[s.jsx("span",{"aria-hidden":"true",children:"Ã—"}),s.jsx("span",{className:"scr",children:ie[t]}),s.jsx("span",{"aria-hidden":"true",className:"tooltip below left narrow2",children:ie[t]})]}),s.jsx("h2",{children:le[t]}),s.jsxs("form",{onSubmit:O,className:`${c.modify}`,children:[s.jsx(ee,{id:`category_${I(Q((e==null?void 0:e.name)??je,t))}`,className:`${c.select} ${c["category-select"]}`,value:i==null?void 0:i.find(n=>n.value===W),onChange:n=>V(n==null?void 0:n.value),options:i,instructions:Se[t],language:t,hideDelete:!0,z:3}),s.jsx(ee,{id:`priority_${I(Q((e==null?void 0:e.name)??je,t))}`,className:`${c.select}`,value:m==null?void 0:m.find(n=>n.value===z),onChange:n=>H(n==null?void 0:n.value),options:m,instructions:be[t],language:t,hideDelete:!0,z:2}),s.jsxs("fieldset",{className:`${c.fieldset} ${c["deadline-wrap"]}`,children:[s.jsx("legend",{children:s.jsxs("label",{children:[Ne[t]," ",s.jsx("input",{style:{marginLeft:"0.5em"},type:"checkbox",checked:j,onChange:()=>q(!j)})]})}),j&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:c["deadline-inputs"],children:[s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`day_${I(Q((e==null?void 0:e.name)??G[t],t))}`,children:me[t]}),s.jsx("input",{type:"number",id:`day_${I((e==null?void 0:e.name)||"Task")}`,name:"day",min:1,max:31,value:f,placeholder:"DD",onChange:n=>X(n.target.value),required:!0,className:"bg"})]}),s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`month_${I((e==null?void 0:e.name)||"Task")}`,children:de[t]}),s.jsx("input",{type:"number",id:`month_${I(Q((e==null?void 0:e.name)??G[t],t))}`,name:"month",min:1,max:12,value:S,placeholder:"MM",onChange:n=>se(n.target.value),required:!0,className:"bg"})]}),s.jsxs("div",{className:c.input,children:[s.jsx("label",{className:"scr",htmlFor:`year_${I((e==null?void 0:e.name)||"Task")}`,children:Ee[t]}),s.jsx("input",{type:"number",id:`year_${I(Q((e==null?void 0:e.name)??G[t],t))}`,name:"year",min:new Date().getFullYear(),max:new Date().getFullYear()+10,value:x,placeholder:"YYYY",onChange:n=>g(n),required:!0,className:"bg"})]})]})," ",_&&s.jsx("p",{className:c.error,children:_})]})]}),s.jsxs("fieldset",{className:`${c.fieldset} ${c.textarea}`,children:[s.jsx("legend",{children:G[t]}),s.jsxs("label",{children:[s.jsx("textarea",{id:`task_${I(e==null?void 0:e.name)}`,required:!0,name:"task",rows:4,value:M,onChange:L}),s.jsxs("span",{className:"scr",children:[le[t]," ",Q((e==null?void 0:e.name)??G[t],t)]})]})]}),s.jsxs("button",{type:"submit",disabled:$,className:"modify",children:[Ce[t]," ",s.jsx(ts,{})]}),s.jsxs("button",{onClick:F,className:`reset ${c.cancel}`,type:"button",children:[$e[t]," ",s.jsx(as,{})]})]})]})}),document.getElementById("modal-root"))};function ws({todo:e,toggleTodo:t,deleteTodo:m,language:i,modifyTodo:O,isDragging:$,handleUpdate:W,handleDragging:z,sending:H,priorityOptions:V,categoryOptions:j,zin:q}){const[v,M]=d.useState((e==null?void 0:e.name)??""),[D,f]=d.useState(!1),[u,S]=d.useState((e==null?void 0:e.priority)||"low"),[E,x]=d.useState(e!=null&&e.deadline?new Date(e.deadline).getDate().toString().padStart(2,"0"):""),[y,k]=d.useState(e!=null&&e.deadline?(new Date(e.deadline).getMonth()+1).toString().padStart(2,"0"):""),[_,h]=d.useState(e!=null&&e.deadline?new Date(e.deadline).getFullYear().toString():""),L=E&&y&&_?`${_}-${y}-${E}`:"",[X,se]=d.useState((e==null?void 0:e.category)||"other"),[g,w]=d.useState(!1);function C(){t(e==null?void 0:e.key)}function F(){window.confirm(Ie[i]+' "'+(e==null?void 0:e.name)+'"?')&&(M(""),m(e==null?void 0:e.key),w(!1))}const Z=a=>{a.preventDefault(),O(e==null?void 0:e.key,v,u,L,X),w(!1)};d.useEffect(()=>{if((e==null?void 0:e.name)!==v&&M((e==null?void 0:e.name)||""),e!=null&&e.deadline){const a=new Date(e.deadline);x(a.getDate().toString().padStart(2,"0")),k((a.getMonth()+1).toString().padStart(2,"0")),h(a.getFullYear().toString())}},[e]);const[n,o]=d.useState(!0),[A,Y]=d.useState(!1),P=()=>{o(!0),Y(!1)},b=()=>{o(!0)},B=()=>{o(!1)},J=()=>{o(!1),Y(!0)},r=()=>{var a;(a=window.getSelection())!=null&&a.toString()?(o(!1),Y(!0)):(o(!0),Y(!1))},l=a=>{A&&a.preventDefault()};return s.jsx(s.Fragment,{children:s.jsxs("li",{style:{zIndex:`calc(${q} - ${e==null?void 0:e.order})`},className:`${$?"dragging":""} ${g?c.open:c.closed}`,draggable:n,onDragStart:a=>{var p;n?(a.dataTransfer.setData("application/my-app",(p=e==null?void 0:e.order)==null?void 0:p.toString()),z(!0)):a.preventDefault()},onDragEnd:()=>z(!1),children:[s.jsxs("span",{onMouseOver:b,onMouseDown:P,className:`${c["drag-handle"]} tooltip-wrap`,children:[s.jsx(ns,{}),s.jsx("span",{className:"tooltip narrow2 below right",children:Fe[i]})]}),s.jsxs("label",{onClick:l,children:[s.jsx("input",{type:"checkbox",id:`check_${I(e==null?void 0:e.name)}`,checked:(e==null?void 0:e.complete)??!1,onChange:C}),s.jsx("span",{onMouseOver:B,onMouseDown:J,onMouseUp:r,children:e==null?void 0:e.name}),s.jsxs("div",{className:`${c["more-info-wrap"]}`,children:[(e==null?void 0:e.category)&&s.jsxs("span",{children:[Me[i],":"," ",ue(pe,e==null?void 0:e.category,i)]}),(e==null?void 0:e.priority)&&(e==null?void 0:e.category)&&s.jsx("span",{"aria-hidden":"true",children:" | "}),(e==null?void 0:e.priority)&&s.jsxs("span",{children:[be[i],":"," ",ue(pe,e==null?void 0:e.priority,i)]}),(e==null?void 0:e.deadline)&&(e==null?void 0:e.deadline)!==""&&(e==null?void 0:e.priority)&&s.jsx("span",{"aria-hidden":"true",children:" | "}),(e==null?void 0:e.deadline)&&(e==null?void 0:e.deadline)!==""&&s.jsxs("span",{children:[Ne[i],":"," ",new Date(e.deadline).toLocaleDateString(i,{year:"numeric",month:"long",day:"numeric"})]})]})]}),s.jsxs("div",{className:`${c["btn-wrap"]}`,children:[s.jsx("button",{onClick:()=>w(!0),className:`${c.edit} tooltip-wrap`,disabled:(e==null?void 0:e.complete)??!1,children:le[i]}),s.jsxs("button",{className:`${c.delete} tooltip-wrap`,onClick:g?()=>w(!1):F,children:[s.jsx("span",{"aria-hidden":"true",children:g?s.jsx(is,{style:{fontSize:"0.8em"}}):s.jsx(s.Fragment,{children:"Ã—"})}),s.jsx("span",{className:"tooltip below left narrow2",children:g?ie[i]:Ae[i]})]})]}),g&&s.jsx(vs,{title:e==null?void 0:e.name,language:i,handleModify:Z,newName:v,setNewName:M,newPriority:u,setNewPriority:S,newDay:E,setNewDay:x,newMonth:y,setNewMonth:k,newYear:_,setNewYear:h,newCategory:X,setNewCategory:se,priorityOptions:V,categoryOptions:j,showDeadline:D,setShowDeadline:f,sending:H,todo:e,setIsOpen:w})]})})}function js({toggleTodo:e,deleteTodo:t,language:m,modifyTodo:i,modifyTodoOrder:O,todosWithIdAndStatus:$,sending:W,priorityOptions:z,categoryOptions:H}){var M,D;const{isDragging:V,listItemsByStatus:j,handleUpdate:q,handleDragging:v}=Oe($,["todos"]);return s.jsx("ul",{className:`${c["todo-ul"]} todo-ul`,onDragOver:f=>f.preventDefault(),onDrop:f=>{var y;f.preventDefault();const u=f.dataTransfer.getData("application/my-app"),S=(y=Array.from(f.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:y.reduce((k,_)=>{const h=_.getBoundingClientRect(),L=Math.abs(h.top-f.clientY);return L<k.offset?{offset:L,element:_}:k},{offset:Number.POSITIVE_INFINITY}),E=Array.from(f.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(S.element);if(Number(u)===E)return;const x=q(Number(u),"todos",E);if(Array.isArray(x)){const k=x==null?void 0:x.map((_,h)=>({key:_.key,order:h}));O(k)}else console.error("Order is not an array");v(!1)},children:(D=(M=j.todos)==null?void 0:M.items)==null?void 0:D.slice().sort((f,u)=>f.order??0>(u.order??0)?1:-1).sort((f,u)=>f.complete===u.complete?0:f.complete?1:-1).map(f=>{var u;return s.jsx(ws,{sending:W,toggleTodo:e,deleteTodo:t,todo:$==null?void 0:$.find(S=>S.key===f.key),language:m,modifyTodo:i,isDragging:V,handleUpdate:q,handleDragging:v,priorityOptions:z,categoryOptions:H,zin:(u=j.todos)==null?void 0:u.items.length},f==null?void 0:f.key)})})}function qs({language:e}){const t=Ye(),m=ae(r=>{var l;return(l=r.auth)==null?void 0:l.user});d.useEffect(()=>{t(Pe())},[]);const i=ae(r=>r.todos.todos),O=ae(r=>r.todos.status),$=ae(r=>r.todos.error),[W,z]=d.useState("low"),[H,V]=d.useState(""),[j,q]=d.useState("other"),[v,M]=d.useState("all"),[D,f]=d.useState("all"),u="ReactTodos",S=i==null?void 0:i.some(r=>r.complete);d.useEffect(()=>{if(i.length===0&&!m){const r=JSON.parse(window.localStorage.getItem(u)||"[]"),l=new Set(i.map(a=>a.key));r.forEach(a=>{l.has(a.key)||t(oe(a))})}},[t,i,m]),d.useEffect(()=>{window.localStorage.setItem(u,JSON.stringify(i))},[i]);const E=r=>{const l=new Set,a=[];return r.forEach(p=>{l.has(p.key)?a.push(p):l.add(p.key)}),a},x=r=>{if(!r){t(T("Error: no key",!0,8));return}if(m!=null&&m._id)t(xe(m._id,r));else{t(_e(r));const l=i.filter(a=>a.key!==r);window.localStorage.setItem(u,JSON.stringify(l))}};d.useEffect(()=>{const r=E(i),l=new Set;r.forEach(a=>{l.has(a.key)||(x(a.key),l.add(a.key))})},[i]);const[y,k]=d.useState([]),_=i.filter(r=>{const l=v==="all"||r.priority===v,a=D==="all"||r.category===D;return l&&a});d.useEffect(()=>{const r=_==null?void 0:_.slice().sort((l,a)=>(l.order??0)-(a.order??0)).map(l=>({...l,id:l.order,status:"todos"}));k(r)},[i,v,D]);const h=["all","low","medium","high"],L=["all","work","personal","shopping","other"],X=["low","medium","high"],se=["work","personal","shopping","other"],g=te(h,e),w=te(L,e),C=te(X,e),F=te(se,e);d.useEffect(()=>{O==="failed"&&t(T(`There was an error: ${$}`,!0,8))},[O,$,t]);const[Z,n]=d.useState(!1);d.useEffect(()=>{m!=null&&m._id&&t(Re(m._id)).then(()=>{t(he(m._id))}).catch(r=>{var l,a;console.error(r),(a=(l=r.response)==null?void 0:l.data)!=null&&a.message?t(T(r.response.data.message,!0,8)):t(T(`${r.message}`,!0,8))})},[m==null?void 0:m._id]);function o(r){const l=i.find(a=>a.key===r);if(l){const a={...l,complete:!l.complete};t(m?ve(m._id,r,a):we(a))}}const A=async(r,l,a,p,U)=>{if(n(!0),!r){t(T("Error: no key",!0,8)),n(!1);return}const K=i.find(N=>N.key===r);if(K){const N={...K,name:l,priority:a,deadline:p,category:U};if(m)await t(ve(m._id,r,N)).then(()=>{t(T(`${Ve[e]}`,!1,3)),n(!1)}).catch(R=>{var re,ce;console.error(R),(ce=(re=R.response)==null?void 0:re.data)!=null&&ce.message?t(T(R.response.data.message,!0,8)):t(T(`${R}`,!0,8)),n(!1)});else{t(we(N));const R=i.map(re=>re.key===r?N:re);window.localStorage.setItem(u,JSON.stringify(R)),n(!1)}}},Y=r=>{var l,a;if(m)t(async p=>{var U,K;try{await Xe(m._id,r).then(()=>{p(he(m._id))})}catch(N){console.error(N),(K=(U=N.response)==null?void 0:U.data)!=null&&K.message?p(T(N.response.data.message,!0,8)):p(T(`${N}`,!0,8))}});else try{t(Ze(r))}catch(p){console.error(p),(a=(l=p.response)==null?void 0:l.data)!=null&&a.message?t(T(p.response.data.message,!0,8)):t(T(`${p}`,!0,8))}finally{window.localStorage.setItem(u,JSON.stringify(i))}},P=d.useRef(null),b=r=>{var K;r.preventDefault(),n(!0);const l=((K=P.current)==null?void 0:K.value)??"";if(l===""){n(!1);return}const a=ms(),p=i.reduce((N,R)=>R.order>N?R.order:N,0),U={key:a,name:l,complete:!1,order:p+1,priority:W,deadline:H,category:j};m?(t(Qe(m._id,U)),n(!1)):(t(oe(U)),window.localStorage.setItem(u,JSON.stringify([...i,U])),n(!1)),P.current&&(P.current.value="")};async function B(r){if(r.preventDefault(),window.confirm(Ge[e]))if(m)await t(es(m._id));else{t(ss());const l=i.filter(a=>!a.complete);window.localStorage.setItem(u,JSON.stringify(l))}}function J(r){if(!r){t(T("Error: no key",!0,8));return}if(m!=null&&m._id)t(xe(m._id,r));else{t(_e(r));let l=i.filter(a=>a.key!==r);l=l.map((a,p)=>({...a,order:p+1})),t(rs(l)),window.localStorage.setItem(u,JSON.stringify(l))}}return s.jsxs(s.Fragment,{children:[s.jsx("form",{onSubmit:b,className:c.form,children:s.jsxs("fieldset",{children:[s.jsx("legend",{className:"scr",children:ze[e]}),s.jsxs("div",{className:c["todo-input-area"],children:[s.jsx("label",{htmlFor:"taskinput",children:ye[e]}),s.jsx("textarea",{ref:P,id:"taskinput",className:"bg",rows:3,name:"task",required:!0,autoComplete:"off",placeholder:`${G[e]}...`}),s.jsx(ee,{z:y.length+5,id:"category",className:`${c.select} ${c["category-select"]}`,hideDelete:!0,instructions:Se[e],value:F.find(r=>r.value===j)||F[0],onChange:r=>q(r==null?void 0:r.value),options:F,language:e}),s.jsx(ee,{id:"priority",className:c.select,hideDelete:!0,instructions:qe[e],value:C.find(r=>r.value===W)||C[0],onChange:r=>z(r==null?void 0:r.value),options:C,language:e,z:y.length+4}),s.jsxs("button",{id:c["submit-todo"],className:c["submit-todo"],type:"submit",disabled:Z,children:[ye[e]," ",s.jsx(ls,{})]})]})]})}),s.jsxs("div",{className:c["controls-wrap"],children:[s.jsx(ee,{id:"category-filter",className:`${c.select} ${c["category-select"]}`,hideDelete:!0,instructions:Le[e],value:w.find(r=>r.value===D)||w[0],onChange:r=>f(r==null?void 0:r.value),options:w,language:e,z:y.length+3}),s.jsx(ee,{id:"priority-filter",className:c.select,hideDelete:!0,instructions:Be[e],value:g.find(r=>r.value===v)||g[0],onChange:r=>M(r==null?void 0:r.value),options:g,language:e,z:y.length+2}),s.jsx("button",{className:`danger ${c["clear-completed"]}`,disabled:!S,onClick:r=>B(r),children:Je[e]})]}),s.jsxs("div",{className:c["list-wrap"],children:[s.jsxs("p",{className:c["left-to-do"],children:[i==null?void 0:i.filter(r=>!(r!=null&&r.complete)).length," ",Ue[e]]}),(v!=="all"||D!=="all")&&s.jsxs("p",{className:c["filter-notification"],children:[Ke[e]," ",We[e]]}),s.jsx(js,{sending:Z,todosWithIdAndStatus:y,toggleTodo:o,deleteTodo:J,language:e,modifyTodo:A,modifyTodoOrder:Y,priorityOptions:C,categoryOptions:F}),O==="loading"&&s.jsxs("p",{className:"flex center margin0auto textcenter",children:[He[e],"..."]})]})]})}export{qs as default};
