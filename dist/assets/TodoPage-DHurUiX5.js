import{r as m,j as e}from"./react-A9DAvxly.js";import{cu as Z,ax as G,bS as L,ei as V,ej as R,ek as Q,el as X,em as P,aZ as W,c6 as ee,en as H,b0 as S,eo as se,ep as re,eq as K,er as te,es as ne,b1 as ae,et as U,eu as q,ev as z,ew as Y,ex as ie,ey as oe,ez as ce,eA as le,eB as de,eC as me,eD as fe,eE as pe,H as ue,cr as he,cs as Te,eF as xe,eG as ye,eH as je,eI as we,eJ as _e,eK as Ee,d7 as Se,eL as ke,eM as Ne,K as be}from"./index-BWaKbtdG.js";import{J as ge}from"./react-icons-DJiaMApb.js";import{u as De}from"./useDragAndDrop-CFENP5_-.js";import{a as $}from"./react-redux-CHm9GgGE.js";import{v as Ae}from"./uuid-Dv1xt2bl.js";import"./hoist-non-react-statics-D5aJipOz.js";import"./react-dom-yh0erWL-.js";import"./scheduler-CzFDRTuY.js";import"./@reduxjs-DTZ4pglK.js";import"./immer-BNrqi0cU.js";import"./redux-CE3tqztX.js";import"./@babel-DF5_wy6Y.js";import"./redux-thunk-CY0Q9z1Q.js";import"./axios-BimPEqV4.js";import"./react-router-dom-j9Ns2JNj.js";import"./react-router-BoqxkIr7.js";import"./@remix-run-DTnHqtaE.js";import"./react-is-DUDD-a5e.js";import"./use-sync-external-store-DEc9BFqZ.js";const ve="_form_7mcgs_1",Ie="_closed_7mcgs_173",Ce="_open_7mcgs_189",Oe="_modify_7mcgs_173",f={form:ve,"list-wrap":"_list-wrap_7mcgs_31","todo-input-area":"_todo-input-area_7mcgs_37","todo-ul":"_todo-ul_7mcgs_49","drag-handle":"_drag-handle_7mcgs_83","btn-wrap":"_btn-wrap_7mcgs_139",closed:Ie,"modify-todo":"_modify-todo_7mcgs_173",open:Ce,delete:"_delete_7mcgs_243","left-to-do":"_left-to-do_7mcgs_291",modify:Oe};function Me({todo:s,toggleTodo:o,deleteTodo:i,language:r,modifyTodo:k,isDragging:y,handleUpdate:T,handleDragging:g}){const[N,j]=m.useState((s==null?void 0:s.name)??""),[E,w]=m.useState(!1);function D(){o(s==null?void 0:s.key)}function c(){window.confirm(Q[r]+' "'+(s==null?void 0:s.name)+'"?')&&(j(""),i(s==null?void 0:s.key),w(!1))}const u=l=>{l.preventDefault(),k(s==null?void 0:s.key,N),w(!1)},I=l=>{j(l.target.value)};m.useEffect(()=>{(s==null?void 0:s.name)!==N&&j((s==null?void 0:s.name)||"")},[s]);const A=l=>{const C="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";let B="";for(let J=0;J<l;J++){const F=Math.floor(Math.random()*C.length);B+=C.substring(F,F+1)}return B},h=(l=A(9))=>l.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"-"),v=(l=P[r])=>l.split(" ").length<=4?l:l.split(" ").slice(0,3).join(" ")+" "+X[r],[_,p]=m.useState(!0),[t,n]=m.useState(!1),a=()=>{p(!0),n(!1)},d=()=>{p(!0)},x=()=>{p(!1)},b=()=>{p(!1),n(!0)},O=()=>{var l;(l=window.getSelection())!=null&&l.toString()?(p(!1),n(!0)):(p(!0),n(!1))},M=l=>{t&&l.preventDefault()};return e.jsxs("li",{className:`${y?"dragging":""}`,draggable:_,onDragStart:l=>{var C;_?(l.dataTransfer.setData("application/my-app",(C=s==null?void 0:s.order)==null?void 0:C.toString()),g(!0)):l.preventDefault()},onDragEnd:()=>g(!1),children:[e.jsxs("span",{onMouseOver:d,onMouseDown:a,className:`${f["drag-handle"]} tooltip-wrap`,children:[e.jsx(ge,{}),e.jsx("span",{className:"tooltip narrow2 below right",children:Z[r]})]}),e.jsxs("label",{className:`${E?f.open:f.closed}`,onClick:M,children:[e.jsx("input",{type:"checkbox",id:`check_${h(s==null?void 0:s.name)}`,checked:(s==null?void 0:s.complete)??!1,onChange:D}),e.jsx("span",{onMouseOver:x,onMouseDown:b,onMouseUp:O,children:s==null?void 0:s.name})]}),e.jsxs("div",{className:`${E?f.open:f.closed} ${f["btn-wrap"]}`,children:[e.jsx(G,{language:r,className:`${f["modify-todo"]} modify-todo`,text:L[r],isOpen:E,setIsFormOpen:w,hideBrackets:!1,onClick:()=>{j((s==null?void 0:s.name)??"")},children:e.jsxs("form",{onSubmit:u,className:`${f.modify}`,children:[e.jsxs("label",{children:[e.jsx("textarea",{id:`task_${h(s==null?void 0:s.name)}`,required:!0,name:"task",value:N,onChange:I}),e.jsxs("span",{className:"scr",children:[L[r]," ",v(s==null?void 0:s.name)]})]}),e.jsx("button",{type:"submit",className:"modify",children:V[r]})]})}),e.jsxs("button",{className:`${f.delete}`,onClick:c,"data-label":R[r],children:[e.jsx("span",{children:"Ã—"}),e.jsx("span",{className:"scr",children:R[r]})]})]})]})}function $e({toggleTodo:s,deleteTodo:o,language:i,modifyTodo:r,modifyTodoOrder:k,todosWithIdAndStatus:y,setTodosWithIdAndStatus:T}){var w,D;const{isDragging:g,listItemsByStatus:N,handleUpdate:j,handleDragging:E}=De(y,["todos"]);return W(),e.jsx("ul",{className:`${f["todo-ul"]} todo-ul`,onDragOver:c=>c.preventDefault(),onDrop:c=>{var v;c.preventDefault();const u=c.dataTransfer.getData("application/my-app"),I=(v=Array.from(c.currentTarget.querySelectorAll(".todo-ul > li")))==null?void 0:v.reduce((_,p)=>{const t=p.getBoundingClientRect(),n=Math.abs(t.top-c.clientY);return n<_.offset?{offset:n,element:p}:_},{offset:Number.POSITIVE_INFINITY}),A=Array.from(c.currentTarget.querySelectorAll(".todo-ul > li")).indexOf(I.element);if(Number(u)===A)return;const h=j(Number(u),"todos",A);if(Array.isArray(h)){const _=h==null?void 0:h.map((p,t)=>({key:p.key,order:t}));k(_)}else console.error("Order is not an array");E(!1)},children:(D=(w=N.todos)==null?void 0:w.items)==null?void 0:D.slice().sort((c,u)=>c.order??0>(u.order??0)?1:-1).sort((c,u)=>c.complete===u.complete?0:c.complete?1:-1).map(c=>e.jsx(Me,{toggleTodo:s,deleteTodo:o,todo:y==null?void 0:y.find(u=>u.key===c.key),language:i,modifyTodo:r,isDragging:g,handleUpdate:j,handleDragging:E},c==null?void 0:c.key))})}function Be({language:s}){const o=W(),i=$(t=>{var n;return(n=t.auth)==null?void 0:n.user});m.useEffect(()=>{o(ee())},[]);const r=$(t=>t.todos.todos),k=$(t=>t.todos.status),y=$(t=>t.todos.error),T="ReactTodos",g=r==null?void 0:r.some(t=>t.complete);m.useEffect(()=>{if(r.length===0&&!i){const t=JSON.parse(window.localStorage.getItem(T)||"[]"),n=new Set(r.map(a=>a.key));t.forEach(a=>{n.has(a.key)||o(H(a))})}},[o,r,i]),m.useEffect(()=>{window.localStorage.setItem(T,JSON.stringify(r))},[r]);const N=t=>{const n=new Set,a=[];return t.forEach(d=>{n.has(d.key)?a.push(d):n.add(d.key)}),a},j=t=>{if(!t){o(S("Error: no key",!0,8));return}if(i!=null&&i._id)o(U(i._id,t));else{o(q(t));const n=r.filter(a=>a.key!==t);window.localStorage.setItem(T,JSON.stringify(n))}};m.useEffect(()=>{const t=N(r),n=new Set;t.forEach(a=>{n.has(a.key)||(j(a.key),n.add(a.key))})},[r]);const[E,w]=m.useState([]);m.useEffect(()=>{const t=r==null?void 0:r.slice().sort((n,a)=>(n.order??0)-(a.order??0)).map(n=>({...n,id:n.order,status:"todos"}));w(t)},[r]),m.useEffect(()=>{k==="failed"&&o(S(`There was an error: ${y}`,!0,8))},[k,y,o]);const[D,c]=m.useState(!1);m.useEffect(()=>{i!=null&&i._id&&!D&&o(se(i._id)).then(()=>{c(!0)})},[i==null?void 0:i._id]);function u(t){const n=r.find(a=>a.key===t);if(n){const a={...n,complete:!n.complete};o(i?z(i._id,t,a):Y(a))}}const I=async(t,n)=>{if(!t){o(S("Error: no key",!0,8));return}const a=r.find(d=>d.key===t);if(a){const d={...a,name:n};if(i)await o(z(i._id,t,d)).then(()=>{o(S("Todo updated",!1,3))}).catch(x=>{console.error(x),o(S(`${x}`,!0,8))});else{o(Y(d));const x=r.map(b=>b.key===t?d:b);window.localStorage.setItem(T,JSON.stringify(x))}}},A=t=>{if(i)o(async n=>{try{await ie(i._id,t).then(()=>{n(oe(i._id))})}catch(a){console.error(a),n(S(`${a}`,!0,8))}});else try{o(ce(t))}catch(n){console.error(n),o(S(`${n}`,!0,8))}finally{window.localStorage.setItem(T,JSON.stringify(r))}},h=m.useRef(null),v=t=>{var b;t.preventDefault();const n=((b=h.current)==null?void 0:b.value)??"";if(n==="")return;const a=Ae(),d=r.reduce((O,M)=>M.order>O?M.order:O,0),x={key:a,name:n,complete:!1,order:d+1};i?o(le(i._id,x)):(o(H(x)),window.localStorage.setItem(T,JSON.stringify([...r,x]))),h.current&&(h.current.value="")};async function _(t){if(t.preventDefault(),window.confirm(de[s]))if(i)await o(me(i._id));else{o(fe());const n=r.filter(a=>!a.complete);window.localStorage.setItem(T,JSON.stringify(n))}}function p(t){if(!t){o(S("Error: no key",!0,8));return}if(i!=null&&i._id)o(U(i._id,t));else{o(q(t));let n=r.filter(a=>a.key!==t);n=n.map((a,d)=>({...a,order:d+1})),o(pe(n)),window.localStorage.setItem(T,JSON.stringify(n))}}return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:v,className:f.form,children:e.jsxs("fieldset",{children:[e.jsx("legend",{className:"scr",children:re[s]}),e.jsxs("div",{className:f["todo-input-area"],children:[e.jsx("label",{htmlFor:"taskinput",children:K[s]}),e.jsx("textarea",{ref:h,id:"taskinput",className:"bg",name:"task",required:!0,autoComplete:"off",placeholder:`${P[s]}...`}),e.jsx("button",{id:f["submit-todo"],type:"submit",children:K[s]}),e.jsx("button",{className:"danger",disabled:!g,onClick:t=>_(t),children:te[s]})]})]})}),e.jsxs("div",{className:f["list-wrap"],children:[e.jsxs("p",{className:f["left-to-do"],children:[r==null?void 0:r.filter(t=>!(t!=null&&t.complete)).length," ",ne[s]]}),e.jsx($e,{todosWithIdAndStatus:E,setTodosWithIdAndStatus:w,toggleTodo:u,deleteTodo:p,language:s,modifyTodo:I,modifyTodoOrder:A}),k==="loading"&&e.jsxs("p",{children:[ae[s],"..."]})]})]})}function ts({heading:s,text:o,type:i,language:r}){return e.jsxs("div",{className:`todo ${i}`,children:[e.jsx(ue,{language:r,address:"todo",heading:s,text:o}),e.jsxs("div",{className:"inner-wrap",children:[e.jsx("section",{className:"card",children:e.jsx("div",{children:e.jsxs("div",{className:"medium flex column gap",children:[e.jsxs(G,{language:r,text:he[r],className:"features",children:[e.jsx("h2",{children:Te[r]}),e.jsxs("ul",{className:"ul",children:[e.jsx("li",{children:xe[r]}),e.jsx("li",{children:ye[r]}),e.jsx("li",{children:je[r]}),e.jsx("li",{children:we[r]}),e.jsx("li",{children:_e[r]}),e.jsx("li",{children:Ee[r]})]}),e.jsx("h3",{children:Se[r]}),e.jsxs("ul",{className:"ul",children:[e.jsx("li",{children:ke[r]}),e.jsx("li",{children:Ne[r]})]})]}),e.jsx("a",{href:"https://github.com/jenniina/react-sub-site/tree/main/src/components/Todo",children:"Github"})]})})}),e.jsx("section",{className:"card",children:e.jsx("div",{children:e.jsxs("div",{className:"medium",children:[e.jsx("h2",{children:be[r]}),e.jsx(Be,{language:r})]})})})]})]})}export{ts as default};
